import{f as m,a as p,c as Ve}from"../chunks/CdXyPVf1.js";import{z as gt,A as D,B as e,C as l,D as Ue,E as He,I as n,K as r,J as i,G as M,H as Ke,aH as Fe,aI as Ft,aJ as it,u as Te,F as Pe,aC as st,af as Nt}from"../chunks/CIcfCS9e.js";import{d as Xe}from"../chunks/CMrQpYvR.js";import{p as Oe,b as tt,i as R}from"../chunks/Bp05Fg2P.js";import{r as yt,a as It,s as lt}from"../chunks/DVberjZs.js";import{s as S}from"../chunks/BR9ubxrB.js";import{S as ot,s as Ne,e as qe,i as Ye,D as At,c as Rt,g as Dt,a as Ct,t as ft,T as Zt,b as Tt,d as Gt,C as et,p as kt,f as zt,h as Pt,j as Ot,k as Lt,l as Mt,m as Wt,n as jt,o as dt,q as Ut,r as rt,u as Vt,v as qt,w as Yt,Z as Bt,B as Ht,x as Kt,y as Xt,z as $t,U as Jt,A as Qt,E as ea}from"../chunks/D-_2V55U.js";import{b as ht,A as ta}from"../chunks/LF6JFb3L.js";import{a as aa,r as pt}from"../chunks/9oMDpJMq.js";import{g as sa}from"../chunks/BgGmC-Dq.js";const ia=!0,ws=Object.freeze(Object.defineProperty({__proto__:null,prerender:ia},Symbol.toStringTag,{value:"Module"}));var je=(E=>(E.SELECTING_ROOT_FOLDER="SELECTING_ROOT_FOLDER",E.SELECTING_MANGA_FOLDERS="SELECTING_MANGA_FOLDERS",E.PROCESSING_MANGA="PROCESSING_MANGA",E))(je||{}),ce=(E=>(E.PENDING="PENDING",E.PROCESSING="PROCESSING",E.COMPLETED="COMPLETED",E.ERROR="ERROR",E.WARNING="WARNING",E))(ce||{}),y=(E=>(E.LOADING="LOADING",E.EXTRACTING="EXTRACTING",E.READY="READY",E.SERIES_LOOKUP="SERIES_LOOKUP",E.READY_WARNING="READY_WARNING",E.UPLOADING="UPLOADING",E.COMPLETED="COMPLETED",E))(y||{});class na{#e=D(null);get rootFolderFiles(){return e(this.#e)}set rootFolderFiles(t){l(this.#e,t,!0)}#t=D(Ue([]));get zipFiles(){return e(this.#t)}set zipFiles(t){l(this.#t,t,!0)}#a=D(Ue([]));get selectedZipFiles(){return e(this.#a)}set selectedZipFiles(t){l(this.#a,t,!0)}#s=D(-1);get currentZipIndex(){return e(this.#s)}set currentZipIndex(t){l(this.#s,t,!0)}#i=D("SELECTING_ROOT_FOLDER");get workflowStep(){return e(this.#i)}set workflowStep(t){l(this.#i,t,!0)}get currentZip(){return this.currentZipIndex<0||this.currentZipIndex>=this.zipFiles.length?null:this.zipFiles[this.currentZipIndex]}get unprocessedZips(){return this.zipFiles.filter(t=>this.selectedZipFiles.includes(t.file)&&t.status!=="COMPLETED")}get pendingZips(){return this.zipFiles.filter(t=>this.selectedZipFiles.includes(t.file)&&t.status==="PENDING")}get warningZips(){return this.zipFiles.filter(t=>this.selectedZipFiles.includes(t.file)&&t.status==="WARNING")}get errorZips(){return this.zipFiles.filter(t=>this.selectedZipFiles.includes(t.file)&&t.status==="ERROR")}get completedZips(){return this.zipFiles.filter(t=>this.selectedZipFiles.includes(t.file)&&t.status==="COMPLETED")}get processingZips(){return this.zipFiles.filter(t=>this.selectedZipFiles.includes(t.file)&&t.status==="PROCESSING")}get nextZip(){const t=this.pendingZips;if(t.length===0)return null;const a=this.currentZip,s=a?t.filter(g=>g.file!==a.file):t;return s.length===0?null:s[0]}setZipStatus(t,a){const s=this.zipFiles.find(g=>g.file===t);s&&(s.status=a)}moveToNextZip(){const t=this.nextZip;if(!t)return!1;const a=this.zipFiles.findIndex(s=>s.file===t.file);return a>=0?(this.currentZipIndex=a,!0):!1}get zipFilesByMangaFolder(){const t=new ot;for(const a of this.zipFiles)t.has(a.mangaFolderName)||t.set(a.mangaFolderName,[]),t.get(a.mangaFolderName).push(a);return t}reset(){this.rootFolderFiles=null,this.zipFiles=[],this.selectedZipFiles=[],this.currentZipIndex=-1,this.workflowStep="SELECTING_ROOT_FOLDER"}}class ra{#e=D(!1);get enabled(){return e(this.#e)}set enabled(t){l(this.#e,t,!0)}get isActive(){return this.enabled}enable(){this.enabled=!0}disable(){this.enabled=!1}reset(){this.enabled=!1}}const oa=gt(),ut=gt();var la=m('<div class="uno-4maolu"><div class="uno-senp7v"></div> <p class="uno-l6h9uf">Scanning folder structure...</p></div>'),ua=m('<div class="uno-laclbo"><p class="uno-dl0t86"> </p></div>'),ca=m('<div class="uno-tm086o"><button><h1 class="uno-brv6u2">Select Root Folder</h1> <p class="uno-l6h9uf">Select the folder containing manga subfolders with .zip files</p> <input class="uno-qya2ty" type="file"/></button> <!> <!></div>');function da(E,t){He(t,!0);let a=Oe(t,"guidedState",7),s=Oe(t,"class",3,""),g=D(null),I=D(!1);async function d(N){l(I,!0);const k=N.target,$=Array.from(k.files??[]),W=[];for(const j of $){const X=(j.webkitRelativePath||j.name).split("/").filter(Boolean);if(X.length>=2){const q=X[0],C=X[0],U=j.name.split(".").pop()?.toLowerCase();(U==="zip"||U==="cbz")&&W.push({file:j,mangaFolderName:q,mangaFolderPath:C})}}a().rootFolderFiles=$,a().zipFiles=W.map(j=>({...j,status:ce.PENDING})),l(I,!1),t.onDone()}function te(N){e(g)?.click()}var G=ca(),P=n(G);P.__click=te;var O=r(n(P),4);O.webkitdirectory=!0,O.multiple=!0,O.__change=d,tt(O,N=>l(g,N),()=>e(g)),i(P);var K=r(P,2);{var ie=N=>{var k=la();p(N,k)};R(K,N=>{e(I)&&N(ie)})}var L=r(K,2);{var B=N=>{var k=ua(),$=n(k),W=n($);i($),i(k),M(()=>S(W,`Found ${a().zipFiles.length??""} zip file${a().zipFiles.length===1?"":"s"}`)),p(N,k)};R(L,N=>{a().zipFiles.length>0&&N(B)})}i(G),M(()=>{Ne(P,1,`uno-a4tqjo ${s()??""}`),P.disabled=e(I)}),p(E,G),Ke()}Xe(["click","change"]);var pa=m('<button type="button"><div class="uno-bpywdh"><p class="uno-98yf80"> </p> <p class="uno-42pivu"> </p></div> <input type="checkbox" class="uno-5onsv4"/></button>'),va=m('<div class="uno-o40niy"><div class="uno-iuhcpm"><h3 class="uno-0lb4rh"> </h3> <button type="button" class="uno-phh4jd"> </button></div> <div class="uno-fb55wk"></div></div>'),ga=m('<div><div class="uno-iuhcpm"><h2 class="uno-iyer7g">Select Zip Files to Process</h2> <button type="button" class="uno-f45w65"> </button></div> <p class="uno-ok9xip"> </p> <div class="uno-yjimjk"></div> <button type="button" class="uno-3s4o5e"> </button></div>');function fa(E,t){He(t,!0);let a=Oe(t,"guidedState",7),s=Oe(t,"class",3,"");function g(W){a().selectedZipFiles.indexOf(W)>=0?a().selectedZipFiles=a().selectedZipFiles.filter(ne=>ne!==W):a().selectedZipFiles=[...a().selectedZipFiles,W]}function I(W){const j=Array.from(a().zipFilesByMangaFolder.get(W)??[]);if(j.every(X=>a().selectedZipFiles.includes(X.file)))a().selectedZipFiles=a().selectedZipFiles.filter(X=>!j.some(q=>q.file===X));else{const X=j.map(q=>q.file).filter(q=>!a().selectedZipFiles.includes(q));a().selectedZipFiles=[...a().selectedZipFiles,...X]}}function d(){a().selectedZipFiles.length===a().zipFiles.length?a().selectedZipFiles=[]:a().selectedZipFiles=a().zipFiles.map(W=>W.file)}const te=Fe(()=>a().zipFiles.length>0&&a().selectedZipFiles.length===a().zipFiles.length),G=Fe(()=>a().zipFilesByMangaFolder);var P=ga(),O=n(P),K=r(n(O),2);K.__click=d;var ie=n(K,!0);i(K),i(O);var L=r(O,2),B=n(L);i(L);var N=r(L,2);qe(N,21,()=>Array.from(e(G).entries()),Ye,(W,j)=>{var ne=Fe(()=>Ft(e(j),2));let X=()=>e(ne)[0],q=()=>e(ne)[1];var C=va(),U=n(C),re=n(U),ye=n(re,!0);i(re);var Ie=r(re,2);Ie.__click=()=>I(X());var pe=n(Ie);i(Ie),i(U);var me=r(U,2);qe(me,21,q,Ye,(Ee,ve)=>{const oe=Fe(()=>a().selectedZipFiles.includes(e(ve).file));var ae=pa();ae.__click=()=>g(e(ve).file);var _e=n(ae),ge=n(_e),Ce=n(ge,!0);i(ge);var be=r(ge,2),xe=n(be);i(be),i(_e);var Re=r(_e,2);yt(Re),i(ae),M(ke=>{Ne(ae,1,`uno-ik4adi ${e(oe)?"uno-1k75dk":""}`),S(Ce,e(ve).file.name),S(xe,`Size: ${ke??""} MB`),It(Re,e(oe))},[()=>(e(ve).file.size/(1024*1024)).toFixed(2)]),p(Ee,ae)}),i(me),i(C),M(Ee=>{S(ye,X()),S(pe,`${Ee??""} (${q().length??""})`)},[()=>q().every(Ee=>a().selectedZipFiles.includes(Ee.file))?"Deselect All":"Select All"]),p(W,C)}),i(N);var k=r(N,2);k.__click=function(...W){t.onDone?.apply(this,W)};var $=n(k);i(k),i(P),M(()=>{Ne(P,1,`uno-grwdkw ${s()??""}`),S(ie,e(te)?"Deselect All":"Select All"),S(B,`${a().selectedZipFiles.length??""} of ${a().zipFiles.length??""} zip file${a().zipFiles.length===1?"":"s"} selected`),k.disabled=a().selectedZipFiles.length===0,S($,`Continue to Processing (${a().selectedZipFiles.length??""} selected)`)}),p(E,P),Ke()}Xe(["click"]);var ha=m('<p class="uno-a54tpo"> </p>'),ma=m('<div class="uno-cqccui"><p class="uno-nsysfu"> </p> <span> </span></div> <!>',1),_a=m('<p class="uno-b7m48p">No zip file selected</p>'),ba=m('<button type="button" class="uno-qm31yq"> </button>'),xa=m('<p class="uno-b7m48p">No more zip files to process</p>'),wa=m("<div><!></div>"),Ea=m('<p class="uno-b7m48p">All zip files have been completed</p>'),Sa=m('<button type="button" class="uno-4y4l6m"> </button>'),Fa=m('<div class="uno-2db0z0"><h3 class="uno-tniapq"> </h3> <div class="uno-ouywhe"></div></div>'),Na=m('<button type="button" class="uno-qy4bc0"> </button>'),ya=m('<div class="uno-2db0z0"><h3 class="uno-9iz2qs"> </h3> <div class="uno-ouywhe"></div></div>'),Ia=m('<div><div class="uno-0ia1w6 border-surface-hover"><h2 class="uno-1c2kr2">Zip Processing</h2> <div class="uno-cqccui"><span class="uno-d1zaof">Automation (experimental): <span> </span></span> <button type="button"> </button></div></div> <div class="uno-usvt4c"><div class="uno-cqccui"><span class="uno-4ezlml"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-1l1bmy"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-e545zy"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-mg1fk7"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-ip18dj"></span> <span class="uno-b7m48p"> </span></div></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Current Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Next Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Select Zip File</h3> <!></div> <!> <!></div>');function Aa(E,t){He(t,!0);let a=Oe(t,"guidedState",7),s=Oe(t,"class",3,"");const g=it(ut);if(!g)throw new Error("MangaProcessingTabs must be used within a component that provides AutomationState context");function I(){if(a().moveToNextZip()){const o=a().currentZip;o&&t.onZipSelected(o.file)}}function d(o){const f=a().zipFiles.find(T=>T.file.name===o);if(f){const T=a().zipFiles.findIndex(z=>z.file===f.file);T>=0&&(a().currentZipIndex=T,t.onZipSelected(f.file))}}function te(){g.enabled?g.disable():g.enable()}const G=Fe(()=>a().currentZip?.file.name??null),P=Fe(()=>a().warningZips.map(o=>o.file.name)),O=Fe(()=>a().errorZips.map(o=>o.file.name)),K=Fe(()=>a().unprocessedZips.map(o=>o.file.name)),ie=Fe(()=>a().nextZip?.file.name??null),L=Fe(()=>a().pendingZips.length===0&&(a().warningZips.length>0||a().errorZips.length>0));Te(()=>{e(L)&&g.isActive&&g.disable()});let B=D(null);Te(()=>{l(B,a().currentZip?.file.name??null,!0)}),Te(()=>{const o=e(B);if(o){const f=a().currentZip?.file.name??null;o!==f&&d(o)}});const N=Fe(()=>({pending:a().pendingZips.length,warning:a().warningZips.length,error:a().errorZips.length,completed:a().completedZips.length,processing:a().processingZips.length}));var k=Ia(),$=n(k),W=r(n($),2),j=n(W),ne=r(n(j)),X=n(ne,!0);i(ne),i(j);var q=r(j,2);q.__click=te;var C=n(q,!0);i(q),i(W),i($);var U=r($,2),re=n(U),ye=r(n(re),2),Ie=n(ye);i(ye),i(re);var pe=r(re,2),me=r(n(pe),2),Ee=n(me);i(me),i(pe);var ve=r(pe,2),oe=r(n(ve),2),ae=n(oe);i(oe),i(ve);var _e=r(ve,2),ge=r(n(_e),2),Ce=n(ge);i(ge),i(_e);var be=r(_e,2),xe=r(n(be),2),Re=n(xe);i(xe),i(be),i(U);var ke=r(U,2),u=r(n(ke),2);{var x=o=>{var f=ma(),T=Pe(f),z=n(T),fe=n(z,!0);i(z);var we=r(z,2),se=n(we,!0);i(we),i(T);var V=r(T,2);{var he=Y=>{var ee=ha(),Se=n(ee);i(ee),M(()=>S(Se,`Manga Folder: ${a().currentZip.mangaFolderName??""}`)),p(Y,ee)};R(V,Y=>{a().currentZip&&Y(he)})}M(()=>{S(fe,e(G)),Ne(we,1,`uno-ielryd ${a().currentZip?.status===ce.PROCESSING?"uno-kxa2ln":a().currentZip?.status===ce.COMPLETED?"uno-b1425w":a().currentZip?.status===ce.ERROR?"uno-isu16c":a().currentZip?.status===ce.WARNING?"uno-enplrj":"uno-jwlzg2"}`),S(se,a().currentZip?.status??"UNKNOWN")}),p(o,f)},w=o=>{var f=_a();p(o,f)};R(u,o=>{e(G)?o(x):o(w,!1)})}i(ke);var v=r(ke,2),F=r(n(v),2);{var _=o=>{var f=ba();f.__click=I;var T=n(f);i(f),M(()=>{f.disabled=g.enabled,S(T,`Process: ${e(ie)??""}`)}),p(o,f)},A=o=>{var f=xa();p(o,f)};R(F,o=>{e(ie)?o(_):o(A,!1)})}i(v);var b=r(v,2),H=r(n(b),2);{var le=o=>{var f=wa(),T=n(f);At(T,{get items(){return e(K)},class:"uno-qbg2l1",get selectedItem(){return e(B)},set selectedItem(z){l(B,z,!0)}}),i(f),M(()=>Ne(f,1,Rt(g.enabled?"opacity-50 pointer-events-none":""))),p(o,f)},J=o=>{var f=Ea();p(o,f)};R(H,o=>{e(K).length>0?o(le):o(J,!1)})}i(b);var Q=r(b,2);{var c=o=>{var f=Fa(),T=n(f),z=n(T);i(T);var fe=r(T,2);qe(fe,21,()=>e(P),Ye,(we,se)=>{var V=Sa();V.__click=()=>d(e(se));var he=n(V,!0);i(V),M(()=>{V.disabled=g.enabled,S(he,e(se))}),p(we,V)}),i(fe),i(f),M(()=>S(z,`‚ö†Ô∏è Warning Zips (${e(P).length??""})`)),p(o,f)};R(Q,o=>{e(P).length>0&&o(c)})}var h=r(Q,2);{var Z=o=>{var f=ya(),T=n(f),z=n(T);i(T);var fe=r(T,2);qe(fe,21,()=>e(O),Ye,(we,se)=>{var V=Na();V.__click=()=>d(e(se));var he=n(V,!0);i(V),M(()=>{V.disabled=g.enabled,S(he,e(se))}),p(we,V)}),i(fe),i(f),M(()=>S(z,`‚ùå Error Zips (${e(O).length??""})`)),p(o,f)};R(h,o=>{e(O).length>0&&o(Z)})}i(k),M(()=>{Ne(k,1,`uno-s0eao9 ${s()??""}`),Ne(ne,1,`uno-cvk0wv ${g.enabled?"uno-ikj4sb":"uno-je1lgh"}`),S(X,g.enabled?"ON":"OFF"),Ne(q,1,`uno-sv39f1 ${g.enabled?"uno-oxxvv6":"uno-dimr5c"}`),S(C,g.enabled?"üîÑ Turn OFF":"‚ñ∂Ô∏è Turn ON"),S(Ie,`Pending: ${e(N).pending??""}`),S(Ee,`Processing: ${e(N).processing??""}`),S(ae,`Warning: ${e(N).warning??""}`),S(Ce,`Error: ${e(N).error??""}`),S(Re,`Completed: ${e(N).completed??""}`)}),p(E,k),Ke()}Xe(["click"]);function Ra(E){const t=Dt(E,0);return Ct(E,t,0,[])}function Da(E,t="v(\\d+)"){const a=new RegExp(t,"i"),s=E.match(a);return s&&s[1]?s[1].replace(/^0+/,"")||"0":null}function Ca(E,t="c(\\d+(?:\\.\\d+){0,2})"){const a=new RegExp(t,"i"),s=E.match(a);if(s&&s[1]){const g=s[1];if(g.includes(".")){const I=g.split(".");return[I[0].replace(/^0+/,"")||"0",...I.slice(1)].join(".")}else return g.replace(/^0+/,"")||"0"}return null}function Za(E){const t=/MD-(\d+)/i,a=E.match(t);return a?a[1]:null}var Ta=m('<span class="uno-lzl9l3 svelte-m4i47p">Removed</span>'),Ga=m('<button type="button" class="uno-lj049g svelte-m4i47p" title="Edit volume and chapter" aria-label="Edit volume and chapter"><div class="uno-smkhzc svelte-m4i47p"></div></button>'),ka=m('<div class="uno-7qt2lg svelte-m4i47p"><div class="uno-m5mbjf svelte-m4i47p"></div> <span class="svelte-m4i47p">Restore</span></div>'),za=m('<div class="uno-7qt2lg svelte-m4i47p"><div class="uno-9z7ooq svelte-m4i47p"></div> <span class="svelte-m4i47p">Remove</span></div>'),Pa=m('<span class="uno-2et217 svelte-m4i47p"> </span>'),Oa=m('<div class="uno-58lieu svelte-m4i47p">Loading combinations...</div>'),La=m('<div class="uno-58lieu svelte-m4i47p">No volume/chapter combinations available</div>'),Ma=m('<button type="button"><div class="uno-l6o6ga svelte-m4i47p"><span class="svelte-m4i47p"> </span></div></button>'),Wa=m('<div class="uno-iqadiw svelte-m4i47p" role="presentation"><div class="uno-k7cjbm svelte-m4i47p"><!></div></div>'),ja=m('<div><div class="uno-rzokcw svelte-m4i47p"><div class="uno-n4d6p5 svelte-m4i47p"><span class="uno-upv063 svelte-m4i47p"> </span> <!> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Vol:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Ch:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div> <!> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Pages:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div></div> <button type="button"><!></button></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Title:</span> <div class="uno-aqzn48 svelte-m4i47p"><!> <!></div></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Groups:</span> <!></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Path:</span> <span class="uno-nggqeg svelte-m4i47p"> </span></div></div> <!>',1);function Ua(E,t){if(He(t,!0),!it(ft))throw new Error("GuidedChapterEditor must be used within a component that provides TargetingState context");let s=Oe(t,"chapter",7),g=Oe(t,"class",3,""),I=D(!1),d=D(Ue([])),te=D(!1),G=D(null),P=D(null),O=D(null),K=D(null);function ie(){s().isDeleted=!s().isDeleted}async function L(){if(!e(I)){e(G)&&l(K,e(G).getBoundingClientRect(),!0),l(I,!0),l(te,!0);try{const c=s().associatedSeries?.seriesId;if(!c){console.warn("No series ID available for chapter"),l(I,!1);return}await et.load(),l(d,await et.getUniqueVolumeChapterCombinations(c),!0)}catch(c){console.error("Failed to load volume/chapter combinations:",c)}finally{l(te,!1)}}}function B(){l(I,!1),l(O,null),l(K,null)}function N(c){s().manuallyEditedFields.has("volume")||(s().originalFieldValues.has("volume")||s().originalFieldValues.set("volume",s().chapterVolume),s().manuallyEditedFields.add("volume")),s().manuallyEditedFields.has("chapter")||(s().originalFieldValues.has("chapter")||s().originalFieldValues.set("chapter",s().chapterNumber),s().manuallyEditedFields.add("chapter")),s().manuallyEditedFields.has("title")||(s().originalFieldValues.has("title")||s().originalFieldValues.set("title",s().chapterTitle),s().manuallyEditedFields.add("title")),s().chapterVolume=c.volume||null,s().chapterNumber=c.chapter||null,s().chapterTitle=c.title||null,B()}function k(c){const h=c.volume||"N/A",Z=c.chapter||"N/A",o=c.title?` - ${c.title}`:"";return`Vol ${h}, Ch ${Z}${o}`}function $(){if(!e(K))return;const c=e(K),h=window.innerHeight,Z=window.innerWidth,o=4,f=256;let T=f;if(e(P)){const Se=e(P).getBoundingClientRect().height;T=Math.min(Se,f)}const z=h-c.bottom-o,fe=c.top-o,we=z<f&&fe>z;let se;we?(se=c.top-T-o,se<o&&(se=o)):(se=c.bottom+o,se+T>h&&(se=Math.max(o,h-T-o)));let V=c.left;const he=320,Y=Math.min(400,Z-o*2),ee=Math.max(he,Math.min(Y,c.width));V+ee>Z-o&&(V=Z-ee-o),V<o&&(V=o),l(O,{top:se,left:V,width:ee},!0)}Te(()=>{if(e(I)){if(!e(K)){l(O,null);return}requestAnimationFrame(()=>{requestAnimationFrame(()=>{$()})});const c=()=>$(),h=o=>{const f=o.target;e(P)&&!e(P).contains(f)&&e(G)&&!e(G).contains(f)&&B()},Z=setTimeout(()=>{window.addEventListener("resize",c),document.addEventListener("click",h,!0)},10);return()=>{clearTimeout(Z),window.removeEventListener("resize",c),document.removeEventListener("click",h,!0)}}else l(O,null)}),Te(()=>{e(I)&&e(P)&&requestAnimationFrame(()=>{$()})});var W=ja(),j=Pe(W),ne=n(j),X=n(ne),q=n(X),C=n(q);i(q);var U=r(q,2);{var re=c=>{var h=Ta();p(c,h)};R(U,c=>{s().isDeleted&&c(re)})}var ye=r(U,2),Ie=r(n(ye),2),pe=n(Ie,!0);i(Ie),i(ye);var me=r(ye,2),Ee=r(n(me),2),ve=n(Ee,!0);i(Ee),i(me);var oe=r(me,2);{var ae=c=>{var h=Ga();h.__click=Z=>{Z.stopPropagation(),L()},tt(h,Z=>l(G,Z),()=>e(G)),p(c,h)};R(oe,c=>{s().associatedSeries?.seriesId&&c(ae)})}var _e=r(oe,2),ge=r(n(_e),2),Ce=n(ge,!0);i(ge),i(_e),i(X);var be=r(X,2);be.__click=ie;var xe=n(be);{var Re=c=>{var h=ka();p(c,h)},ke=c=>{var h=za();p(c,h)};R(xe,c=>{s().isDeleted?c(Re):c(ke,!1)})}i(be),i(ne);var u=r(ne,2),x=r(n(u),2),w=n(x);Zt(w,{textClass:"text-sm text-app font-medium",fieldName:"title",get chapter(){return s()},get value(){return s().chapterTitle},set value(c){s().chapterTitle=c}});var v=r(w,2);{var F=c=>{var h=Pa(),Z=n(h);i(h),M(()=>S(Z,`(${(s().originalFolderPath||"Untitled")??""})`)),p(c,h)};R(v,c=>{s().chapterTitle||c(F)})}i(x),i(u);var _=r(u,2),A=r(n(_),2);Tt(A,{fieldName:"groups",get chapter(){return s()},get groups(){return s().associatedGroup},set groups(c){s().associatedGroup=c}}),i(_);var b=r(_,2),H=r(n(b),2),le=n(H,!0);i(H),i(b),i(j);var J=r(j,2);{var Q=c=>{var h=Wa();h.__click=z=>z.stopPropagation();var Z=n(h),o=n(Z);{var f=z=>{var fe=Oa();p(z,fe)},T=z=>{var fe=Ve(),we=Pe(fe);{var se=he=>{var Y=La();p(he,Y)},V=he=>{var Y=Ve(),ee=Pe(Y);qe(ee,17,()=>e(d),Ye,(Se,Ze)=>{var Ge=Ma();Ge.__click=()=>N(e(Ze));var Le=n(Ge),Be=n(Le),Me=n(Be,!0);i(Be),i(Le),i(Ge),M(We=>{Ne(Ge,1,`uno-ss9yjz ${s().chapterVolume===e(Ze).volume&&s().chapterNumber===e(Ze).chapter?"uno-eokg3r":""}`,"svelte-m4i47p"),S(Me,We)},[()=>k(e(Ze))]),p(Se,Ge)}),p(he,Y)};R(we,he=>{e(d).length===0?he(se):he(V,!1)},!0)}p(z,fe)};R(o,z=>{e(te)?z(f):z(T,!1)})}i(Z),i(h),tt(h,z=>l(P,z),()=>e(P)),M(()=>Gt(h,`top: ${e(O).top??""}px; left: ${e(O).left??""}px; width: ${e(O).width??""}px;`)),p(c,h)};R(J,c=>{e(I)&&e(O)&&c(Q)})}M(()=>{Ne(j,1,`uno-3rf4hu ${s().isDeleted?"uno-d3zfvr":""} ${g()??""}`,"svelte-m4i47p"),S(C,`#${t.index+1}`),S(pe,s().chapterVolume??"N/A"),S(ve,s().chapterNumber??"N/A"),S(Ce,s().pages.length),Ne(be,1,`uno-lto8ne ${s().isDeleted?"uno-ld06wt":"uno-far8pd"}`,"svelte-m4i47p"),lt(be,"title",s().isDeleted?"Restore chapter":"Mark as removed"),S(le,s().originalFolderPath)}),p(E,W),Ke()}Xe(["click"]);class Va{#e=D(null);get legacyToWeebdexMap(){return e(this.#e)}set legacyToWeebdexMap(t){l(this.#e,t,!0)}#t=D(null);get weebdexToLegacyMap(){return e(this.#t)}set weebdexToLegacyMap(t){l(this.#t,t,!0)}#a=D(!1);get isLoading(){return e(this.#a)}set isLoading(t){l(this.#a,t,!0)}#s=D(null);get loadError(){return e(this.#s)}set loadError(t){l(this.#s,t,!0)}loadPromise=null;async load(){if(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)return;if(this.loadPromise)return this.loadPromise;this.isLoading=!0,this.loadError=null;let t,a;this.loadPromise=new Promise((s,g)=>{t=s,a=g});try{const s=aa("/weebdex_lookup.csv"),g=await fetch(s);if(!g.ok)throw new Error(`Failed to fetch CSV: ${g.status} ${g.statusText}`);const I=await g.text(),{legacyToWeebdex:d,weebdexToLegacy:te}=this.parseCSV(I);this.legacyToWeebdexMap=d,this.weebdexToLegacyMap=te,t()}catch(s){this.loadError=s instanceof Error?s:new Error("Unknown error loading CSV"),a(this.loadError)}finally{this.isLoading=!1}return this.loadPromise}async ensureLoaded(){if(!(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)){if(this.loadPromise){await this.loadPromise;return}await this.load()}}parseCSV(t){const a=kt(t,{columns:!0,skip_empty_lines:!0,trim:!0}),s=new ot,g=new ot;for(const I of a){const d=I.weebdex_id?.trim()||"",te=I.legacy_id?.trim()||"";d&&te&&(s.set(te,d),g.set(d,te))}return{legacyToWeebdex:s,weebdexToLegacy:g}}async getWeebdexIdFromLegacyId(t){return await this.ensureLoaded(),this.legacyToWeebdexMap===null?null:this.legacyToWeebdexMap.get(t)||null}}const vt=new Va;var qa=m('<p class="uno-8520et"> </p>'),Ya=m('<div class="uno-vsugad"><div class="uno-pj4440"></div> <p class="uno-hw2z5w"> </p> <!></div>'),Ba=m('<div class="uno-f2o4wl"><p class="uno-hw2z5w">Loading chapter dump and applying groups/titles...</p></div>'),Ha=m("<p> </p>"),Ka=m("<p>‚Ä¢ Chapter dump lookup failed</p>"),Xa=m("<p> </p>"),$a=m("<p> </p>"),Ja=m('<div class="uno-hqujre"><p class="uno-stwt3u">‚ö†Ô∏è Ready with warnings - Automation will skip this zip. You can still upload manually.</p> <div class="uno-4ixn7j"><!> <!> <!> <!></div></div>'),Qa=m('<span class="uno-czmb1a">Removed</span>'),es=m('<div class="uno-2umhxz"></div>'),ts=m('<div class="uno-kp2ftc"></div>'),as=m('<div><div class="uno-py2y93"><div class="uno-nxlaaf"><p class="uno-39vbxq"> </p> <!></div> <p class="uno-dsgwse"> </p></div> <button type="button"><!></button></div>'),ss=m(`<div class="uno-bi16xf"><div class="uno-nnnwwl"><div class="uno-djaa0e"><p class="uno-apr5a0"> </p> <p class="uno-lp9tww">The following chapters already exist on WeebDex with matching groups. You can mark
								them as removed to skip uploading.</p></div> <button type="button" class="uno-3jkjwc" title="Mark all duplicate chapters as removed">Removed duplicate chapters</button></div> <div class="uno-56cpuz"></div></div>`),is=m('<div class="uno-hemz07"><div class="uno-ns83sq"><p class="uno-0zsd1s"> </p></div> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Series Selection (Required)</h3> <!> <!> <!></div> <!> <!> <!> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Detected Chapters</h3> <div class="uno-xqlxhl"></div></div> <button type="button" class="uno-d93lfx"> </button></div>'),ns=m('<div class="uno-6nb6x4"><p class="uno-dillda">‚úì Upload completed successfully!</p></div>'),rs=m('<div><h2 class="uno-67n1yz"> </h2> <!></div>');function os(E,t){He(t,!0),zt({useWebWorkers:!1});let a=Oe(t,"class",3,"");const s=new Pt;st(ft,s);const g=it(ht);if(!g)throw new Error("MangaProcessor must be used within a component that provides ApiAuthContext");const I=it(ut);let d=D(Ue(y.LOADING)),te=D(null),G=D(Ue([])),P=D(!1),O=D(null),K=D(null),ie=D(null),L=D(Ue([])),B=D(!1),N=D(Ue([])),k=D(0),$=D(null);const W=["jpg","jpeg","png","gif","webp","cbz","zip","xml"];Te(()=>{t.zipFile&&(l(ie,null),l(L,[],!0),l(B,!1),l(N,[],!0),l(k,0),l($,null),X())});async function j(u){const x=u.name.split(".").pop()?.toLowerCase();if(!(x==="cbz")&&!(x==="zip"))throw new Error(`Unsupported archive format: ${x}`);console.log(`Extracting ${x} file:`,u.name),l(O,u.name,!0);const F=new Bt(new Ht(u)),_=await F.getEntries(),A=[],b=u.name.replace(/\.(cbz|zip)$/i,""),H=u.webkitRelativePath||u.name;for(const le of _){if(!le.filename||le.directory)continue;const J=le.filename.split(".").pop()?.toLowerCase();if(!J||!W.includes(J))continue;const Q=new TransformStream,c=new Response(Q.readable).blob();await le.getData(Q.writable);let h=await c;if(!h.type){const z=ne(J);h=new Blob([h],{type:z})}const Z=le.filename,o=Z.split("/").pop()??Z,f=H.includes("/")?`${H.split("/").slice(0,-1).join("/")}/${b}/${Z}`:`${b}/${Z}`,T=new File([h],o,{type:h.type});Object.defineProperty(T,"webkitRelativePath",{value:f,writable:!1,enumerable:!0,configurable:!0}),A.push(T)}return await F.close(),l(O,null),A}function ne(u){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp"}[u]||"application/octet-stream"}async function X(){l(d,y.LOADING,!0),s.reset();const u=Za(t.zipFile.name);if(u)try{await vt.load();const v=await vt.getWeebdexIdFromLegacyId(u);v?(s.seriesId=v,console.log(`Auto-detected series ID from MD-####: ${u} -> ${v}`)):console.log(`No WeebDex ID found for MangaDex ID: ${u}`)}catch(v){console.warn(`Failed to lookup WeebDex ID for MangaDex ID ${u}:`,v)}l(d,y.EXTRACTING,!0);let x=[];try{x=await j(t.zipFile)}catch(v){console.error(`Error extracting ${t.zipFile.name}:`,v),l($,v instanceof Error?v.message:"Failed to extract archive",!0),t.guidedState.setZipStatus(t.zipFile,ce.ERROR),l(d,y.READY,!0),t.onProcessingComplete("error");return}l(te,Ot(x),!0);const w=Ra(e(te));l(d,y.EXTRACTING,!0),l(G,await Promise.all(w.map(async v=>{const F=Da(v.name),_=Ca(v.name),A=v.files.filter(b=>b.type===Lt.CHAPTER_PAGE).map((b,H)=>new Mt(b.file.name,H,b.file,Wt.NOT_STARTED,0,null,null,!1,b.type));return new jt(v.path,v.name,F,_,new dt,new Ut,A,rt.NOT_STARTED,0,null,null,v,!1,"en")})),!0),e(G).sort((v,F)=>{if(v.chapterVolume&&F.chapterVolume){const _=String(v.chapterVolume).localeCompare(String(F.chapterVolume),void 0,{numeric:!0,sensitivity:"base"});if(_!==0)return _}else{if(v.chapterVolume)return-1;if(F.chapterVolume)return 1}return v.chapterNumber&&F.chapterNumber?String(v.chapterNumber).localeCompare(String(F.chapterNumber),void 0,{numeric:!0,sensitivity:"base"}):v.chapterNumber?-1:F.chapterNumber?1:0}),s.chapterStates=e(G),l(d,y.READY,!0)}Te(()=>{s.seriesId!==null&&s.chapterStates.forEach(u=>{u.associatedSeries||(u.associatedSeries=new dt),u.associatedSeries.seriesId=s.seriesId??""})}),Te(()=>{s.seriesId&&(e(d)===y.READY||e(d)===y.READY_WARNING)&&s.seriesId!==e(ie)&&(l(ie,s.seriesId,!0),l(d,y.SERIES_LOOKUP,!0),q())});async function q(){if(s.seriesId)try{await et.load();const u=await et.getAllGroupNames(s.seriesId);if(u.length===0){console.warn("No groups found in chapter dump"),l(B,!0),l(d,y.READY_WARNING,!0);return}const x=[],w=[];for(const F of u)try{const _=await Vt(F);if(_.data){const A=_.data.find(b=>b.name===F);if(A){const b=new qt;b.groupId=A.id,b.groupName=A.name,x.push(b)}else w.push(F)}else w.push(F)}catch(_){console.warn(`Failed to lookup group "${F}":`,_),w.push(F)}l(N,w,!0),w.length>0&&l(B,!0),s.availableScanGroups=x,await C();const v=await U();l(k,v,!0),v>0&&l(B,!0),await re(),Ie()?l(d,y.READY_WARNING,!0):l(d,y.READY,!0)}catch(u){console.error("Error loading chapter dump:",u),l(B,!0),l(d,y.READY_WARNING,!0)}}async function C(){for(const u of s.chapterStates){if(!u.originalFolderPath)continue;const x=s.availableScanGroups.filter(w=>u.originalFolderPath?.includes(w.groupName)??!1);if(x.length>0){const w=u.associatedGroup.groupIds??[],v=new Set(w);for(const F of x)v.has(F.groupId)||v.add(F.groupId);u.associatedGroup.groupIds=Array.from(v)}}}async function U(){if(!s.seriesId)return 0;const u=new Map;for(const w of s.availableScanGroups)u.set(w.groupId,w.groupName);let x=0;for(const w of s.chapterStates){const v=w.associatedGroup.groupIds??[];if(v.length===0){x++;continue}const F=v.map(b=>u.get(b)).filter(b=>b!==void 0);if(F.length===0){x++;continue}const _=await et.getChapterInfo(s.seriesId,w.chapterVolume,w.chapterNumber);if(!_){x++;continue}F.some(b=>_.groupNames.includes(b))?w.chapterTitle=_.title:x++}return x}async function re(){if(s.seriesId)try{const u=await Yt(s.seriesId),x=[],w=new Map;for(const _ of u.chapters){const A=_.volume||"none",b=_.chapter,H=`${A}:${b}`;w.set(H,_)}const v=_=>{const A=new Set;if(u.groups)for(const b of _){const H=u.groups[b];H&&A.add(H.id)}return A},F=(_,A)=>{if(_.size!==A.size)return!1;for(const b of _)if(!A.has(b))return!1;return!0};for(const _ of s.chapterStates){const A=_.chapterVolume||"none",b=_.chapterNumber;if(!b)continue;const H=`${A}:${b}`,le=w.get(H);if(le&&le.entries&&Object.keys(le.entries).length>0){const J=new Set(_.associatedGroup.groupIds??[]);if(J.size===0)continue;let Q=null;for(const c of Object.values(le.entries)){const h=v(c.groups);if(F(J,h)){Q=c;break}}if(Q){const c=v(Q.groups),h=[];for(const Z of c){const o=u.groups?.find(f=>f.id===Z);o?h.push(`${o.name} (${o.id})`):h.push(`Unknown Group (${Z})`)}x.push({chapter:_,existingGroups:h.length>0?h:["Unknown groups"]})}}}l(L,x,!0)}catch(u){console.error("Error checking for duplicates:",u),l(L,[],!0)}}function ye(u){if(e(d)!==y.UPLOADING)return;l(d,y.COMPLETED,!0);const x=u?"success":"error";t.guidedState.setZipStatus(t.zipFile,u?ce.COMPLETED:ce.ERROR),t.onProcessingComplete(x)}function Ie(){return e(L).length>0||e(B)||e(N).length>0||e(k)>0}function pe(){return{hasDuplicates:e(L).length>0,duplicateCount:e(L).length,dumpLookupFailed:e(B),failedGroups:e(N).length,failedTitles:e(k)}}function me(){return e(d)===y.READY&&(e(ie)===s.seriesId||!s.seriesId)}Te(()=>{if(!I?.isActive)return;const x=e(d),w=s.seriesId,v=e(ie),F=x===y.READY&&(v===w||!w)||x===y.READY_WARNING;if(!F)return;console.log("Automation: Effect triggered, checking state",{step:x,seriesId:w,lastSeriesId:v,shouldCheck:F});const _=setTimeout(()=>{Ee()},500);return()=>clearTimeout(_)});async function Ee(){if(!I?.isActive){console.log("Automation: Not active");return}if(e(d)===y.READY_WARNING){console.log("Automation: READY_WARNING state detected, marking as warning and skipping"),t.guidedState.setZipStatus(t.zipFile,ce.WARNING),t.onProcessingComplete("warning");return}if(!me()){console.log("Automation: Not ready",{step:e(d),seriesId:s.seriesId,lastProcessedSeriesId:e(ie)});return}console.log("Automation: Checking zip file",t.zipFile.name);const u=t.guidedState.pendingZips,x=t.guidedState.warningZips.length>0||t.guidedState.errorZips.length>0;if(u.length===0&&x){console.log("Automation: Disabling - only warnings/errors remain"),I.disable();return}console.log("Automation: No issues, starting upload",{canStartUpload:e(oe),hasSeriesId:!!s.seriesId,nonDeletedChapters:e(ae).length}),e(oe)&&s.seriesId&&e(ae).length>0?ve()?console.log("Automation: Upload started successfully"):(console.warn("Automation: Failed to start upload, marking as error"),t.guidedState.setZipStatus(t.zipFile,ce.ERROR),t.onProcessingComplete("error")):(console.warn("Automation: Missing requirements for upload",{canStartUpload:e(oe),hasSeriesId:!!s.seriesId,nonDeletedChapters:e(ae).length}),t.guidedState.setZipStatus(t.zipFile,ce.WARNING),t.onProcessingComplete("warning"))}function ve(){return g.apiToken?s.seriesId?s.chapterStates.length===0?(alert("No chapters to upload"),!1):!e(oe)||e(ae).length===0?!1:(l(d,y.UPLOADING,!0),t.guidedState.setZipStatus(t.zipFile,ce.PROCESSING),!0):(alert("Please set a series ID first"),!1):(alert("Please set up API authentication first"),!1)}Te(()=>{if(e(d)===y.UPLOADING&&I?.isActive&&e(K)){const u=setTimeout(()=>{console.log("Automation: Triggering upload via UploaderOrchestrator"),e(K)?.startUpload()},200);return()=>clearTimeout(u)}});const oe=Fe(()=>e(d)===y.READY||e(d)===y.READY_WARNING||e(d)===y.SERIES_LOOKUP),ae=Fe(()=>e(G).filter(u=>!u.isDeleted));Te(()=>{if(e(d)===y.UPLOADING&&e(G).length>0){const u=e(G).every(w=>w.status===rt.COMPLETED||w.isDeleted),x=e(G).some(w=>!w.isDeleted);if(u&&x){const v=!e(G).some(F=>!F.isDeleted&&F.status===rt.FAILED);t.guidedState.setZipStatus(t.zipFile,v?ce.COMPLETED:ce.ERROR),ye(v)}}});var _e={hasIssues:Ie,getIssueDetails:pe,isReady:me,startUpload:ve},ge=rs(),Ce=n(ge),be=n(Ce);i(Ce);var xe=r(Ce,2);{var Re=u=>{var x=Ya(),w=r(n(x),2),v=n(w,!0);i(w);var F=r(w,2);{var _=A=>{var b=qa(),H=n(b);i(b),M(()=>S(H,`Processing: ${e(O)??""}`)),p(A,b)};R(F,A=>{e(O)&&A(_)})}i(x),M(()=>S(v,e(d)===y.LOADING?"Loading manga folder...":"Extracting zip files...")),p(u,x)},ke=u=>{var x=Ve(),w=Pe(x);{var v=_=>{var A=is(),b=n(A),H=n(b),le=n(H);i(H),i(b);var J=r(b,2),Q=r(n(J),2);Kt(Q,{});var c=r(Q,2);Xt(c,{});var h=r(c,2);$t(h,{}),i(J);var Z=r(J,2);{var o=Y=>{var ee=Ba();p(Y,ee)};R(Z,Y=>{e(d)===y.SERIES_LOOKUP&&Y(o)})}var f=r(Z,2);{var T=Y=>{var ee=Ja(),Se=r(n(ee),2),Ze=n(Se);{var Ge=de=>{var ue=Ha(),ze=n(ue);i(ue),M(()=>S(ze,`‚Ä¢ ${e(L).length??""} duplicate chapter${e(L).length===1?"":"s"} detected`)),p(de,ue)};R(Ze,de=>{e(L).length>0&&de(Ge)})}var Le=r(Ze,2);{var Be=de=>{var ue=Ka();p(de,ue)};R(Le,de=>{e(B)&&e(N).length===0&&e(k)===0&&de(Be)})}var Me=r(Le,2);{var We=de=>{var ue=Xa(),ze=n(ue);i(ue),M($e=>S(ze,`‚Ä¢ ${e(N).length??""} group${e(N).length===1?"":"s"} failed to lookup: ${$e??""}`),[()=>e(N).join(", ")]),p(de,ue)};R(Me,de=>{e(N).length>0&&de(We)})}var at=r(Me,2);{var Ae=de=>{var ue=$a(),ze=n(ue);i(ue),M(()=>S(ze,`‚Ä¢ ${e(k)??""} chapter title${e(k)===1?"":"s"} failed
								to resolve`)),p(de,ue)};R(at,de=>{e(k)>0&&de(Ae)})}i(Se),i(ee),p(Y,ee)};R(f,Y=>{e(d)===y.READY_WARNING&&Y(T)})}var z=r(f,2);{var fe=Y=>{var ee=ss(),Se=n(ee),Ze=n(Se),Ge=n(Ze),Le=n(Ge);i(Ge),Nt(2),i(Ze);var Be=r(Ze,2);Be.__click=()=>{for(const{chapter:We}of e(L))We.isDeleted=!0},i(Se);var Me=r(Se,2);qe(Me,21,()=>e(L),Ye,(We,at)=>{let Ae=()=>e(at).chapter,de=()=>e(at).existingGroups;var ue=as(),ze=n(ue),$e=n(ze),nt=n($e),mt=n(nt);i(nt);var _t=r(nt,2);{var bt=De=>{var Qe=Qa();p(De,Qe)};R(_t,De=>{Ae().isDeleted&&De(bt)})}i($e);var ct=r($e,2),xt=n(ct);i(ct),i(ze);var Je=r(ze,2);Je.__click=()=>{Ae().isDeleted=!Ae().isDeleted};var wt=n(Je);{var Et=De=>{var Qe=es();p(De,Qe)},St=De=>{var Qe=ts();p(De,Qe)};R(wt,De=>{Ae().isDeleted?De(Et):De(St,!1)})}i(Je),i(ue),M(De=>{Ne(ue,1,`uno-ecxsrr ${Ae().isDeleted?"uno-1ya9ju":""}`),S(mt,`Vol. ${Ae().chapterVolume??"N/A"??""} Ch. ${Ae().chapterNumber??"N/A"??""} - ${(Ae().chapterTitle||Ae().originalFolderPath||"Untitled")??""}`),S(xt,`Existing groups: ${De??""}`),Ne(Je,1,`uno-v1bdur ${Ae().isDeleted?"uno-uigj71":"uno-8ta9ap"}`),lt(Je,"title",Ae().isDeleted?"Restore chapter":"Mark as removed")},[()=>de().join(", ")]),p(We,ue)}),i(Me),i(ee),M(()=>S(Le,`‚ö†Ô∏è Warning: ${e(L).length??""} duplicate chapter${e(L).length===1?"":"s"} detected`)),p(Y,ee)};R(z,Y=>{e(L).length>0&&Y(fe)})}var we=r(z,2),se=r(n(we),2);qe(se,21,()=>e(G),Ye,(Y,ee,Se)=>{Ua(Y,{index:Se,get chapter(){return e(ee)}})}),i(se),i(we);var V=r(we,2);V.__click=ve;var he=n(V);i(V),i(A),M(()=>{S(le,`Found ${e(G).length??""} chapter${e(G).length===1?"":"s"} from deepest folders`),V.disabled=!e(oe)||!s.seriesId||e(ae).length===0,S(he,`Start Upload (${e(ae).length??""} of ${e(G).length??""} chapters)`)}),p(_,A)},F=_=>{var A=Ve(),b=Pe(A);{var H=J=>{tt(Jt(J,{onDone:ye,get busy(){return e(P)},set busy(Q){l(P,Q,!0)}}),Q=>l(K,Q,!0),()=>e(K))},le=J=>{var Q=Ve(),c=Pe(Q);{var h=Z=>{var o=ns();p(Z,o)};R(c,Z=>{e(d)===y.COMPLETED&&Z(h)},!0)}p(J,Q)};R(b,J=>{e(d)===y.UPLOADING?J(H):J(le,!1)},!0)}p(_,A)};R(w,_=>{e(d)===y.READY||e(d)===y.READY_WARNING||e(d)===y.SERIES_LOOKUP?_(v):_(F,!1)},!0)}p(u,x)};R(xe,u=>{e(d)===y.LOADING||e(d)===y.EXTRACTING?u(Re):u(ke,!1)})}return i(ge),M(()=>{Ne(ge,1,`uno-hemz07 ${a()??""}`),S(be,`Processing: ${t.zipFile.name??""}`)}),p(E,ge),Ke(_e)}Xe(["click"]);var ls=m('<div class="uno-j48514"><p class="uno-5v04yw">No zip file selected. Use the tabs above to select a zip file to process.</p></div>'),us=m('<div class="uno-eeu1av"><!> <!></div>'),cs=m('<div class="uno-pb4e2u"><div class="uno-k0pcvl"><h1 class="uno-kryzyj">Guided Zip Manga Uploader</h1> <div class="uno-skt2gn"><button type="button" class="uno-q7l7gr">Simple Mode</button> <!></div></div> <a target="_blank" class="uno-6zhxse">Tutorial & Docs</a> <!> <!></div>');function Es(E,t){He(t,!0);const a=new na,s=new ra;st(oa,a),st(ut,s),st(ht,new ta);let g=D(null),I=D(null);function d(){a.workflowStep=je.SELECTING_MANGA_FOLDERS}function te(){if(a.workflowStep=je.PROCESSING_MANGA,a.selectedZipFiles.length>0){const C=a.selectedZipFiles[0],U=a.zipFiles.findIndex(re=>re.file===C);U>=0&&(a.currentZipIndex=U,l(g,C,!0))}}function G(C){l(g,C,!0)}function P(C){const U=a.currentZip;if(U&&(C==="success"?a.setZipStatus(U.file,ce.COMPLETED):C==="warning"?a.setZipStatus(U.file,ce.WARNING):C==="error"&&a.setZipStatus(U.file,ce.ERROR)),a.moveToNextZip()){const re=a.currentZip;re&&l(g,re.file,!0)}else l(g,null)}function O(){e(I)&&e(I).startUpload()}const K=Fe(()=>a.workflowStep!==je.PROCESSING_MANGA);var ie=cs(),L=n(ie),B=r(n(L),2),N=n(B);N.__click=()=>sa(pt("/"));var k=r(N,2);Qt(k,{}),i(B),i(L);var $=r(L,2),W=r($,2);{var j=C=>{ea(C,{})};R(W,C=>{e(K)&&C(j)})}var ne=r(W,2);{var X=C=>{da(C,{get guidedState(){return a},onDone:d,class:"uno-zgouyr"})},q=C=>{var U=Ve(),re=Pe(U);{var ye=pe=>{fa(pe,{get guidedState(){return a},onDone:te,class:"uno-l0uum8"})},Ie=pe=>{var me=Ve(),Ee=Pe(me);{var ve=oe=>{var ae=us(),_e=n(ae);Aa(_e,{get guidedState(){return a},onZipSelected:G,onAutomationRequestUpload:O,get mangaProcessorRef(){return e(I)},class:"uno-wgeun8"});var ge=r(_e,2);{var Ce=xe=>{tt(os(xe,{get guidedState(){return a},get zipFile(){return e(g)},onProcessingComplete:P,class:"uno-wgeun8"}),Re=>l(I,Re,!0),()=>e(I))},be=xe=>{var Re=ls();p(xe,Re)};R(ge,xe=>{e(g)?xe(Ce):xe(be,!1)})}i(ae),p(oe,ae)};R(Ee,oe=>{a.workflowStep===je.PROCESSING_MANGA&&oe(ve)},!0)}p(pe,me)};R(re,pe=>{a.workflowStep===je.SELECTING_MANGA_FOLDERS?pe(ye):pe(Ie,!1)},!0)}p(C,U)};R(ne,C=>{a.workflowStep===je.SELECTING_ROOT_FOLDER?C(X):C(q,!1)})}i(ie),M(C=>lt($,"href",C),[()=>pt("/docs")]),p(E,ie),Ke()}Xe(["click"]);export{Es as component,ws as universal};
