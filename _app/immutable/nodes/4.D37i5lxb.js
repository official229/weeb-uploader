import{f as _,a as d,c as De}from"../chunks/CTHEc7mS.js";import{z as dt,A as P,B as t,C as p,D as Je,E as Ae,I as i,K as r,J as a,G as M,H as Oe,aH as re,aI as vt,u as ye,F as Ne,aC as tt,aJ as ft,af as gt}from"../chunks/DpPdw_ub.js";import{p as xe,b as ht,i as C}from"../chunks/DxCQtHkc.js";import{s as w}from"../chunks/CI280J2U.js";import{d as Ke}from"../chunks/D_Kb6Vk8.js";import{s as pe,e as Re,i as Te,D as mt,g as _t,a as St,c as xt,T as bt,t as Ft,b as wt,C as yt,d as Nt,f as Zt,h as Et,j as it,k as It,l as nt,m as et,n as Ct,S as zt,o as Gt,Z as kt,B as Pt,p as Dt,q as Rt,r as Tt,U as At,u as Ot,v as Mt}from"../chunks/ScWzwkCA.js";import{r as jt,a as Lt,s as Ut}from"../chunks/DofntP01.js";import{b as rt,A as Vt}from"../chunks/Cjq1WBUe.js";const qt=!0,ja=Object.freeze(Object.defineProperty({__proto__:null,prerender:qt},Symbol.toStringTag,{value:"Module"}));var Se=(x=>(x.SELECTING_ROOT_FOLDER="SELECTING_ROOT_FOLDER",x.SELECTING_MANGA_FOLDERS="SELECTING_MANGA_FOLDERS",x.PROCESSING_MANGA="PROCESSING_MANGA",x))(Se||{}),oe=(x=>(x.PENDING="PENDING",x.PROCESSING="PROCESSING",x.COMPLETED="COMPLETED",x.ERROR="ERROR",x))(oe||{});class Bt{#e=P(null);get rootFolderFiles(){return t(this.#e)}set rootFolderFiles(s){p(this.#e,s,!0)}#t=P(Je([]));get zipFiles(){return t(this.#t)}set zipFiles(s){p(this.#t,s,!0)}#a=P(Je([]));get selectedZipFiles(){return t(this.#a)}set selectedZipFiles(s){p(this.#a,s,!0)}#s=P(-1);get currentZipIndex(){return t(this.#s)}set currentZipIndex(s){p(this.#s,s,!0)}#i=P("SELECTING_ROOT_FOLDER");get workflowStep(){return t(this.#i)}set workflowStep(s){p(this.#i,s,!0)}get currentZip(){return this.currentZipIndex<0||this.currentZipIndex>=this.zipFiles.length?null:this.zipFiles[this.currentZipIndex]}get unprocessedZips(){return this.zipFiles.filter(s=>this.selectedZipFiles.includes(s.file)&&s.status==="PENDING")}get nextZip(){const s=this.unprocessedZips;return s.length===0?null:s[0]}setZipStatus(s,e){const o=this.zipFiles.find(D=>D.file===s);o&&(o.status=e)}moveToNextZip(){const s=this.nextZip;if(!s)return!1;const e=this.zipFiles.findIndex(o=>o.file===s.file);return e>=0?(this.currentZipIndex=e,!0):!1}get zipFilesByMangaFolder(){const s=new Map;for(const e of this.zipFiles)s.has(e.mangaFolderName)||s.set(e.mangaFolderName,[]),s.get(e.mangaFolderName).push(e);return s}reset(){this.rootFolderFiles=null,this.zipFiles=[],this.selectedZipFiles=[],this.currentZipIndex=-1,this.workflowStep="SELECTING_ROOT_FOLDER"}}const Ht=dt();var Wt=_('<div class="uno-4maolu"><div class="uno-senp7v"></div> <p class="uno-l6h9uf">Scanning folder structure...</p></div>'),Jt=_('<div class="uno-laclbo"><p class="uno-dl0t86"> </p></div>'),Kt=_('<div class="uno-tm086o"><button><h1 class="uno-brv6u2">Select Root Folder</h1> <p class="uno-l6h9uf">Select the folder containing manga subfolders with .zip files</p> <input class="uno-qya2ty" type="file"/></button> <!> <!></div>');function Xt(x,s){Ae(s,!0);let e=xe(s,"guidedState",7),o=xe(s,"class",3,""),D=P(null),f=P(!1);async function Y(y){p(f,!0);const R=y.target,g=Array.from(R.files??[]),b=[];for(const E of g){const T=(E.webkitRelativePath||E.name).split("/").filter(Boolean);if(T.length>=2){const I=T[0],u=T[0],h=E.name.split(".").pop()?.toLowerCase();(h==="zip"||h==="cbz")&&b.push({file:E,mangaFolderName:I,mangaFolderPath:u})}}e().rootFolderFiles=g,e().zipFiles=b.map(E=>({...E,status:oe.PENDING})),p(f,!1),s.onDone()}function G(y){t(D)?.click()}var B=Kt(),N=i(B);N.__click=G;var Z=r(i(N),4);Z.webkitdirectory=!0,Z.multiple=!0,Z.__change=Y,ht(Z,y=>p(D,y),()=>t(D)),a(N);var j=r(N,2);{var Q=y=>{var R=Wt();d(y,R)};C(j,y=>{t(f)&&y(Q)})}var K=r(j,2);{var L=y=>{var R=Jt(),g=i(R),b=i(g);a(g),a(R),M(()=>w(b,`Found ${e().zipFiles.length??""} zip file${e().zipFiles.length===1?"":"s"}`)),d(y,R)};C(K,y=>{e().zipFiles.length>0&&y(L)})}a(B),M(()=>{pe(N,1,`uno-a4tqjo ${o()??""}`),N.disabled=t(f)}),d(x,B),Oe()}Ke(["click","change"]);var Yt=_('<button type="button"><div class="uno-bpywdh"><p class="uno-98yf80"> </p> <p class="uno-42pivu"> </p></div> <input type="checkbox" class="uno-5onsv4"/></button>'),Qt=_('<div class="uno-o40niy"><div class="uno-iuhcpm"><h3 class="uno-0lb4rh"> </h3> <button type="button" class="uno-phh4jd"> </button></div> <div class="uno-fb55wk"></div></div>'),$t=_('<div><div class="uno-iuhcpm"><h2 class="uno-iyer7g">Select Zip Files to Process</h2> <button type="button" class="uno-f45w65"> </button></div> <p class="uno-ok9xip"> </p> <div class="uno-yjimjk"></div> <button type="button" class="uno-3s4o5e"> </button></div>');function ea(x,s){Ae(s,!0);let e=xe(s,"guidedState",7),o=xe(s,"class",3,"");function D(b){e().selectedZipFiles.indexOf(b)>=0?e().selectedZipFiles=e().selectedZipFiles.filter($=>$!==b):e().selectedZipFiles=[...e().selectedZipFiles,b]}function f(b){const E=Array.from(e().zipFilesByMangaFolder.get(b)??[]);if(E.every(T=>e().selectedZipFiles.includes(T.file)))e().selectedZipFiles=e().selectedZipFiles.filter(T=>!E.some(I=>I.file===T));else{const T=E.map(I=>I.file).filter(I=>!e().selectedZipFiles.includes(I));e().selectedZipFiles=[...e().selectedZipFiles,...T]}}function Y(){e().selectedZipFiles.length===e().zipFiles.length?e().selectedZipFiles=[]:e().selectedZipFiles=e().zipFiles.map(b=>b.file)}const G=re(()=>e().zipFiles.length>0&&e().selectedZipFiles.length===e().zipFiles.length),B=re(()=>e().zipFilesByMangaFolder);var N=$t(),Z=i(N),j=r(i(Z),2);j.__click=Y;var Q=i(j,!0);a(j),a(Z);var K=r(Z,2),L=i(K);a(K);var y=r(K,2);Re(y,21,()=>Array.from(t(B).entries()),Te,(b,E)=>{var $=re(()=>vt(t(E),2));let T=()=>t($)[0],I=()=>t($)[1];var u=Qt(),h=i(u),A=i(h),H=i(A,!0);a(A);var W=r(A,2);W.__click=()=>f(T());var ee=i(W);a(W),a(h);var de=r(h,2);Re(de,21,I,Te,(ae,le)=>{const V=re(()=>e().selectedZipFiles.includes(t(le).file));var n=Yt();n.__click=()=>D(t(le).file);var c=i(n),l=i(c),v=i(l,!0);a(l);var S=r(l,2),F=i(S);a(S),a(c);var m=r(c,2);jt(m),a(n),M(z=>{pe(n,1,`uno-ik4adi ${t(V)?"uno-1k75dk":""}`),w(v,t(le).file.name),w(F,`Size: ${z??""} MB`),Lt(m,t(V))},[()=>(t(le).file.size/(1024*1024)).toFixed(2)]),d(ae,n)}),a(de),a(u),M(ae=>{w(H,T()),w(ee,`${ae??""} (${I().length??""})`)},[()=>I().every(ae=>e().selectedZipFiles.includes(ae.file))?"Deselect All":"Select All"]),d(b,u)}),a(y);var R=r(y,2);R.__click=function(...b){s.onDone?.apply(this,b)};var g=i(R);a(R),a(N),M(()=>{pe(N,1,`uno-grwdkw ${o()??""}`),w(Q,t(G)?"Deselect All":"Select All"),w(L,`${e().selectedZipFiles.length??""} of ${e().zipFiles.length??""} zip file${e().zipFiles.length===1?"":"s"} selected`),R.disabled=e().selectedZipFiles.length===0,w(g,`Continue to Processing (${e().selectedZipFiles.length??""} selected)`)}),d(x,N),Oe()}Ke(["click"]);var ta=_('<p class="uno-a54tpo"> </p>'),aa=_('<div class="uno-cqccui"><p class="uno-nsysfu"> </p> <span> </span></div> <!>',1),sa=_('<p class="uno-b7m48p">No zip file selected</p>'),ia=_('<button type="button" class="uno-qm31yq"> </button>'),na=_('<p class="uno-b7m48p">No more zip files to process</p>'),ra=_('<p class="uno-b7m48p">All zip files have been processed</p>'),oa=_('<div><div class="uno-2db0z0"><h3 class="uno-py45hl">Current Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Next Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Unprocessed Zip Files</h3> <!></div></div>');function la(x,s){Ae(s,!0);let e=xe(s,"guidedState",7),o=xe(s,"class",3,"");function D(){if(e().moveToNextZip()){const u=e().currentZip;u&&s.onZipSelected(u.file)}}function f(u){const h=e().zipFiles.find(A=>A.file.name===u);if(h){const A=e().zipFiles.findIndex(H=>H.file===h.file);A>=0&&(e().currentZipIndex=A,s.onZipSelected(h.file))}}const Y=re(()=>e().currentZip?.file.name??null),G=re(()=>e().unprocessedZips.map(u=>u.file.name)),B=re(()=>e().nextZip?.file.name??null);let N=P(null);ye(()=>{p(N,e().currentZip?.file.name??null,!0)}),ye(()=>{const u=t(N);if(u){const h=e().currentZip?.file.name??null;u!==h&&f(u)}});var Z=oa(),j=i(Z),Q=r(i(j),2);{var K=u=>{var h=aa(),A=Ne(h),H=i(A),W=i(H,!0);a(H);var ee=r(H,2),de=i(ee,!0);a(ee),a(A);var ae=r(A,2);{var le=V=>{var n=ta(),c=i(n);a(n),M(()=>w(c,`Manga Folder: ${e().currentZip.mangaFolderName??""}`)),d(V,n)};C(ae,V=>{e().currentZip&&V(le)})}M(()=>{w(W,t(Y)),pe(ee,1,`uno-ielryd ${e().currentZip?.status===oe.PROCESSING?"uno-kxa2ln":e().currentZip?.status===oe.COMPLETED?"uno-b1425w":e().currentZip?.status===oe.ERROR?"uno-isu16c":"uno-jwlzg2"}`),w(de,e().currentZip?.status??"UNKNOWN")}),d(u,h)},L=u=>{var h=sa();d(u,h)};C(Q,u=>{t(Y)?u(K):u(L,!1)})}a(j);var y=r(j,2),R=r(i(y),2);{var g=u=>{var h=ia();h.__click=D;var A=i(h);a(h),M(()=>w(A,`Process: ${t(B)??""}`)),d(u,h)},b=u=>{var h=na();d(u,h)};C(R,u=>{t(B)?u(g):u(b,!1)})}a(y);var E=r(y,2),$=r(i(E),2);{var T=u=>{mt(u,{get items(){return t(G)},class:"uno-qbg2l1",get selectedItem(){return t(N)},set selectedItem(h){p(N,h,!0)}})},I=u=>{var h=ra();d(u,h)};C($,u=>{t(G).length>0?u(T):u(I,!1)})}a(E),a(Z),M(()=>pe(Z,1,`uno-s0eao9 ${o()??""}`)),d(x,Z),Oe()}Ke(["click"]);function ua(x){const s=_t(x,0);return St(x,s,0,[])}function ca(x,s="v(\\d+)"){const e=new RegExp(s,"i"),o=x.match(e);return o&&o[1]?o[1].replace(/^0+/,"")||"0":null}function pa(x,s="c(\\d+(?:\\.\\d+){0,2})"){const e=new RegExp(s,"i"),o=x.match(e);if(o&&o[1]){const D=o[1];if(D.includes(".")){const f=D.split(".");return[f[0].replace(/^0+/,"")||"0",...f.slice(1)].join(".")}else return D.replace(/^0+/,"")||"0"}return null}var da=_('<p class="uno-8520et"> </p>'),va=_('<div class="uno-vsugad"><div class="uno-pj4440"></div> <p class="uno-hw2z5w"> </p> <!></div>'),fa=_('<div class="uno-f2o4wl"><p class="uno-hw2z5w">Loading chapter dump and applying groups/titles...</p></div>'),ga=_('<span class="uno-czmb1a">Removed</span>'),ha=_('<div class="uno-2umhxz"></div>'),ma=_('<div class="uno-kp2ftc"></div>'),_a=_('<div><div class="uno-py2y93"><div class="uno-nxlaaf"><p class="uno-39vbxq"> </p> <!></div> <p class="uno-dsgwse"> </p></div> <button type="button"><!></button></div>'),Sa=_(`<div class="uno-bi16xf"><div class="uno-nnnwwl"><div class="uno-djaa0e"><p class="uno-apr5a0"> </p> <p class="uno-lp9tww">The following chapters already exist on WeebDex with matching groups. You can mark
								them as removed to skip uploading.</p></div> <button type="button" class="uno-3jkjwc" title="Mark all duplicate chapters as removed">Removed duplicate chapters</button></div> <div class="uno-56cpuz"></div></div>`),xa=_('<span class="uno-qrrfur">Removed</span>'),ba=_('<span class="uno-ibwmw2"> </span>'),Fa=_('<div class="uno-x44cwa"></div>'),wa=_('<span class="uno-abhiuv">No groups assigned</span>'),ya=_('<div><div class="uno-ee9b21"><span class="uno-l1962v"></span> <!> <div class="uno-nxlaaf"><span class="uno-8520et">Vol:</span> <span class="uno-0zsd1s"> </span></div> <div class="uno-nxlaaf"><span class="uno-8520et">Ch:</span> <span class="uno-0zsd1s"> </span></div> <div class="uno-nxlaaf"><span class="uno-8520et">Pages:</span> <span class="uno-0zsd1s"> </span></div></div> <div class="uno-nxlaaf"><span class="uno-8520et">Title:</span> <span class="uno-v9y1kd"> </span></div> <div class="uno-nxlaaf"><span class="uno-8520et">Groups:</span> <!></div> <div class="uno-nxlaaf"><span class="uno-8520et">Path:</span> <span class="uno-ujq36i"> </span></div></div>'),Na=_('<div class="uno-hemz07"><div class="uno-ns83sq"><p class="uno-0zsd1s"> </p></div> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Series Selection (Required)</h3> <!> <!> <!></div> <!> <!> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Detected Chapters</h3> <div class="uno-xqlxhl"></div></div> <button type="button" class="uno-d93lfx"> </button></div>'),Za=_('<div class="uno-6nb6x4"><p class="uno-dillda">✓ Upload completed successfully!</p></div>'),Ea=_('<div><h2 class="uno-67n1yz"> </h2> <!></div>');function Ia(x,s){Ae(s,!0),xt({useWebWorkers:!1});let e=xe(s,"class",3,"");const o=new bt;tt(Ft,o);const D=ft(rt);if(!D)throw new Error("MangaProcessor must be used within a component that provides ApiAuthContext");let f=P("loading"),Y=P(null),G=P(Je([])),B=P(!1),N=P(!1),Z=P(null),j=P(!1),Q=P(null),K=P(!1),L=P(Je([]));const y=["jpg","jpeg","png","gif","webp","cbz","zip","xml"];ye(()=>{s.zipFile&&(p(j,!1),p(Q,null),p(L,[],!0),b())});async function R(n){const c=n.name.split(".").pop()?.toLowerCase();if(!(c==="cbz")&&!(c==="zip"))throw new Error(`Unsupported archive format: ${c}`);console.log(`Extracting ${c} file:`,n.name),p(Z,n.name,!0);const S=new kt(new Pt(n)),F=await S.getEntries(),m=[],z=n.name.replace(/\.(cbz|zip)$/i,""),te=n.webkitRelativePath||n.name;for(const se of F){if(!se.filename||se.directory)continue;const k=se.filename.split(".").pop()?.toLowerCase();if(!k||!y.includes(k))continue;const ie=new TransformStream,J=new Response(ie.readable).blob();await se.getData(ie.writable);let U=await J;if(!U.type){const Ee=g(k);U=new Blob([U],{type:Ee})}const ne=se.filename,Ze=ne.split("/").pop()??ne,Me=te.includes("/")?`${te.split("/").slice(0,-1).join("/")}/${z}/${ne}`:`${z}/${ne}`,je=new File([U],Ze,{type:U.type});Object.defineProperty(je,"webkitRelativePath",{value:Me,writable:!1,enumerable:!0,configurable:!0}),m.push(je)}return await S.close(),p(Z,null),m}function g(n){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp"}[n]||"application/octet-stream"}async function b(){p(f,"loading"),o.reset(),p(f,"extracting");let n=[];try{n=await R(s.zipFile)}catch(l){console.error(`Error extracting ${s.zipFile.name}:`,l),s.guidedState.setZipStatus(s.zipFile,oe.ERROR);return}p(Y,wt(n),!0);const c=ua(t(Y));p(f,"extracting"),p(G,await Promise.all(c.map(async l=>{const v=ca(l.name),S=pa(l.name),F=l.files.filter(m=>m.type===yt.CHAPTER_PAGE).map((m,z)=>new Nt(m.file.name,z,m.file,Zt.NOT_STARTED,0,null,null,!1,m.type));return new Et(l.path,l.name,v,S,new it,new It,F,nt.NOT_STARTED,0,null,null,l,!1,"en")})),!0),t(G).sort((l,v)=>{if(l.chapterVolume&&v.chapterVolume){const S=String(l.chapterVolume).localeCompare(String(v.chapterVolume),void 0,{numeric:!0,sensitivity:"base"});if(S!==0)return S}else{if(l.chapterVolume)return-1;if(v.chapterVolume)return 1}return l.chapterNumber&&v.chapterNumber?String(l.chapterNumber).localeCompare(String(v.chapterNumber),void 0,{numeric:!0,sensitivity:"base"}):l.chapterNumber?-1:v.chapterNumber?1:0}),o.chapterStates=t(G),p(f,"ready")}ye(()=>{o.seriesId!==null&&o.chapterStates.forEach(n=>{n.associatedSeries||(n.associatedSeries=new it),n.associatedSeries.seriesId=o.seriesId??""})}),ye(()=>{o.seriesId&&t(f)==="ready"&&(!t(j)||o.seriesId!==t(Q))&&(p(j,!0),p(Q,o.seriesId,!0),p(f,"series_lookup"),E())});async function E(){if(o.seriesId)try{await et.load();const n=await et.getAllGroupNames(o.seriesId);if(n.length===0){console.warn("No groups found in chapter dump");return}const c=[];for(const l of n)try{const v=await Ct(l);if(v.data){const S=v.data.find(F=>F.name===l);if(S){const F=new zt;F.groupId=S.id,F.groupName=S.name,c.push(F)}}}catch(v){console.warn(`Failed to lookup group "${l}":`,v)}o.availableScanGroups=c,await $(),await T(),await I(),p(f,"ready")}catch(n){console.error("Error loading chapter dump:",n),p(f,"ready")}}async function $(){for(const n of o.chapterStates){if(!n.originalFolderPath)continue;const c=o.availableScanGroups.filter(l=>n.originalFolderPath?.includes(l.groupName)??!1);if(c.length>0){const l=n.associatedGroup.groupIds??[],v=new Set(l);for(const S of c)v.has(S.groupId)||v.add(S.groupId);n.associatedGroup.groupIds=Array.from(v)}}}async function T(){if(!o.seriesId)return;const n=new Map;for(const c of o.availableScanGroups)n.set(c.groupId,c.groupName);for(const c of o.chapterStates){const l=c.associatedGroup.groupIds??[];if(l.length===0)continue;const v=l.map(m=>n.get(m)).filter(m=>m!==void 0);if(v.length===0)continue;const S=await et.getChapterInfo(o.seriesId,c.chapterVolume,c.chapterNumber);if(!S||!S.title)continue;v.some(m=>S.groupNames.includes(m))&&(c.chapterTitle=S.title)}}async function I(){if(o.seriesId)try{const n=await Gt(o.seriesId),c=[],l=new Map;for(const v of n.chapters){const S=v.volume||"none",F=v.chapter,m=`${S}:${F}`;l.set(m,v)}for(const v of o.chapterStates){const S=v.chapterVolume||"none",F=v.chapterNumber;if(!F)continue;const m=`${S}:${F}`,z=l.get(m);if(z&&z.entries&&Object.keys(z.entries).length>0){const te=new Set;for(const J of Object.values(z.entries))for(const U of J.groups)te.add(U);const se=v.associatedGroup.groupIds??[],k=[];for(const J of te)if(n.groups&&n.groups[J]){const U=n.groups[J];k.push(`${U.name} (${U.id})`)}else k.push(`Unknown Group (index: ${J})`);const ie=se.some(J=>n.groups?.some(U=>U.id===J)??!1);c.push({chapter:v,existingGroups:k.length>0?k:["Unknown groups"]})}}p(L,c,!0)}catch(n){console.error("Error checking for duplicates:",n),p(L,[],!0)}}function u(){t(K)||(p(K,!0),p(B,!1),p(f,"completed"),s.guidedState.setZipStatus(s.zipFile,oe.COMPLETED),s.onProcessingComplete())}function h(){if(!D.apiToken){alert("Please set up API authentication first");return}if(!o.seriesId){alert("Please set a series ID first");return}if(o.chapterStates.length===0){alert("No chapters to upload");return}p(f,"uploading"),p(B,!0),p(K,!1),s.guidedState.setZipStatus(s.zipFile,oe.PROCESSING)}const A=re(()=>t(f)==="ready"||t(f)==="series_lookup"),H=re(()=>t(G).filter(n=>!n.isDeleted));ye(()=>{if(t(f)==="uploading"&&t(G).length>0){const n=t(G).every(l=>l.status===nt.COMPLETED||l.isDeleted),c=t(G).some(l=>!l.isDeleted);n&&c&&!t(B)&&(s.guidedState.setZipStatus(s.zipFile,oe.COMPLETED),u())}});var W=Ea(),ee=i(W),de=i(ee);a(ee);var ae=r(ee,2);{var le=n=>{var c=va(),l=r(i(c),2),v=i(l,!0);a(l);var S=r(l,2);{var F=m=>{var z=da(),te=i(z);a(z),M(()=>w(te,`Processing: ${t(Z)??""}`)),d(m,z)};C(S,m=>{t(Z)&&m(F)})}a(c),M(()=>w(v,t(f)==="loading"?"Loading manga folder...":"Extracting zip files...")),d(n,c)},V=n=>{var c=De(),l=Ne(c);{var v=F=>{var m=Na(),z=i(m),te=i(z),se=i(te);a(te),a(z);var k=r(z,2),ie=r(i(k),2);Dt(ie,{});var J=r(ie,2);Rt(J,{});var U=r(J,2);Tt(U,{}),a(k);var ne=r(k,2);{var Ze=ce=>{var O=fa();d(ce,O)};C(ne,ce=>{t(f)==="series_lookup"&&ce(Ze)})}var Me=r(ne,2);{var je=ce=>{var O=Sa(),Ie=i(O),ve=i(Ie),be=i(ve),Ue=i(be);a(be),gt(2),a(ve);var Ve=r(ve,2);Ve.__click=()=>{for(const{chapter:fe}of t(L))fe.isDeleted=!0},a(Ie);var qe=r(Ie,2);Re(qe,21,()=>t(L),Te,(fe,Ce)=>{let X=()=>t(Ce).chapter,ze=()=>t(Ce).existingGroups;var ge=_a(),Ge=i(ge),Fe=i(Ge),we=i(Fe),Xe=i(we);a(we);var ke=r(we,2);{var Be=q=>{var me=ga();d(q,me)};C(ke,q=>{X().isDeleted&&q(Be)})}a(Fe);var He=r(Fe,2),Pe=i(He);a(He),a(Ge);var he=r(Ge,2);he.__click=()=>{X().isDeleted=!X().isDeleted};var Ye=i(he);{var Qe=q=>{var me=ha();d(q,me)},We=q=>{var me=ma();d(q,me)};C(Ye,q=>{X().isDeleted?q(Qe):q(We,!1)})}a(he),a(ge),M(q=>{pe(ge,1,`uno-ecxsrr ${X().isDeleted?"uno-1ya9ju":""}`),w(Xe,`Vol. ${X().chapterVolume??"N/A"??""} Ch. ${X().chapterNumber??"N/A"??""} - ${(X().chapterTitle||X().originalFolderPath||"Untitled")??""}`),w(Pe,`Existing groups: ${q??""}`),pe(he,1,`uno-v1bdur ${X().isDeleted?"uno-uigj71":"uno-8ta9ap"}`),Ut(he,"title",X().isDeleted?"Restore chapter":"Mark as removed")},[()=>ze().join(", ")]),d(fe,ge)}),a(qe),a(O),M(()=>w(Ue,`⚠️ Warning: ${t(L).length??""} duplicate chapter${t(L).length===1?"":"s"} detected`)),d(ce,O)};C(Me,ce=>{t(L).length>0&&ce(je)})}var Ee=r(Me,2),at=r(i(Ee),2);Re(at,21,()=>t(G),Te,(ce,O,Ie)=>{var ve=ya(),be=i(ve),Ue=i(be);Ue.textContent=`#${Ie+1}`;var Ve=r(Ue,2);{var qe=ue=>{var _e=xa();d(ue,_e)};C(Ve,ue=>{t(O).isDeleted&&ue(qe)})}var fe=r(Ve,2),Ce=r(i(fe),2),X=i(Ce,!0);a(Ce),a(fe);var ze=r(fe,2),ge=r(i(ze),2),Ge=i(ge,!0);a(ge),a(ze);var Fe=r(ze,2),we=r(i(Fe),2),Xe=i(we,!0);a(we),a(Fe),a(be);var ke=r(be,2),Be=r(i(ke),2),He=i(Be,!0);a(Be),a(ke);var Pe=r(ke,2),he=r(i(Pe),2);{var Ye=ue=>{var _e=Fa();Re(_e,21,()=>t(O).associatedGroup.groupIds,Te,(lt,st)=>{const ut=re(()=>o.availableScanGroups.find(pt=>pt.groupId===t(st)));var $e=ba(),ct=i($e,!0);a($e),M(()=>w(ct,t(ut)?.groupName??t(st))),d(lt,$e)}),a(_e),d(ue,_e)},Qe=ue=>{var _e=wa();d(ue,_e)};C(he,ue=>{t(O).associatedGroup.groupIds&&t(O).associatedGroup.groupIds.length>0?ue(Ye):ue(Qe,!1)})}a(Pe);var We=r(Pe,2),q=r(i(We),2),me=i(q,!0);a(q),a(We),a(ve),M(()=>{pe(ve,1,`uno-28rvjc ${t(O).isDeleted?"uno-6dchlv":""}`),w(X,t(O).chapterVolume??"N/A"),w(Ge,t(O).chapterNumber??"N/A"),w(Xe,t(O).pages.length),w(He,t(O).chapterTitle||t(O).originalFolderPath||"Untitled"),w(me,t(O).originalFolderPath)}),d(ce,ve)}),a(at),a(Ee);var Le=r(Ee,2);Le.__click=h;var ot=i(Le);a(Le),a(m),M(()=>{w(se,`Found ${t(G).length??""} chapter${t(G).length===1?"":"s"} from deepest folders`),Le.disabled=!t(A)||!o.seriesId||t(H).length===0,w(ot,`Start Upload (${t(H).length??""} of ${t(G).length??""} chapters)`)}),d(F,m)},S=F=>{var m=De(),z=Ne(m);{var te=k=>{At(k,{onDone:u,get busy(){return t(N)},set busy(ie){p(N,ie,!0)}})},se=k=>{var ie=De(),J=Ne(ie);{var U=ne=>{var Ze=Za();d(ne,Ze)};C(J,ne=>{t(f)==="completed"&&ne(U)},!0)}d(k,ie)};C(z,k=>{t(f)==="uploading"?k(te):k(se,!1)},!0)}d(F,m)};C(l,F=>{t(f)==="ready"||t(f)==="series_lookup"?F(v):F(S,!1)},!0)}d(n,c)};C(ae,n=>{t(f)==="loading"||t(f)==="extracting"?n(le):n(V,!1)})}a(W),M(()=>{pe(W,1,`uno-hemz07 ${e()??""}`),w(de,`Processing: ${s.zipFile.name??""}`)}),d(x,W),Oe()}Ke(["click"]);var Ca=_('<div class="uno-j48514"><p class="uno-5v04yw">No zip file selected. Use the tabs above to select a zip file to process.</p></div>'),za=_('<div class="uno-eeu1av"><!> <!></div>'),Ga=_('<div class="uno-pb4e2u"><div class="uno-k0pcvl"><h1 class="uno-kryzyj">Guided Zip Manga Uploader</h1> <!></div> <!> <!></div>');function La(x,s){Ae(s,!0);const e=new Bt;tt(Ht,e),tt(rt,new Vt);let o=P(null);function D(){e.workflowStep=Se.SELECTING_MANGA_FOLDERS}function f(){if(e.workflowStep=Se.PROCESSING_MANGA,e.selectedZipFiles.length>0){const g=e.selectedZipFiles[0],b=e.zipFiles.findIndex(E=>E.file===g);b>=0&&(e.currentZipIndex=b,p(o,g,!0))}}function Y(g){p(o,g,!0),e.setZipStatus(g,oe.PROCESSING)}function G(){if(e.moveToNextZip()){const g=e.currentZip;g&&(p(o,g.file,!0),e.setZipStatus(g.file,oe.PROCESSING))}else p(o,null)}const B=re(()=>e.workflowStep!==Se.PROCESSING_MANGA);var N=Ga(),Z=i(N),j=r(i(Z),2);Ot(j,{}),a(Z);var Q=r(Z,2);{var K=g=>{Mt(g,{})};C(Q,g=>{t(B)&&g(K)})}var L=r(Q,2);{var y=g=>{Xt(g,{get guidedState(){return e},onDone:D,class:"uno-zgouyr"})},R=g=>{var b=De(),E=Ne(b);{var $=I=>{ea(I,{get guidedState(){return e},onDone:f,class:"uno-l0uum8"})},T=I=>{var u=De(),h=Ne(u);{var A=H=>{var W=za(),ee=i(W);la(ee,{get guidedState(){return e},onZipSelected:Y,class:"uno-wgeun8"});var de=r(ee,2);{var ae=V=>{Ia(V,{get guidedState(){return e},get zipFile(){return t(o)},onProcessingComplete:G,class:"uno-wgeun8"})},le=V=>{var n=Ca();d(V,n)};C(de,V=>{t(o)?V(ae):V(le,!1)})}a(W),d(H,W)};C(h,H=>{e.workflowStep===Se.PROCESSING_MANGA&&H(A)},!0)}d(I,u)};C(E,I=>{e.workflowStep===Se.SELECTING_MANGA_FOLDERS?I($):I(T,!1)},!0)}d(g,b)};C(L,g=>{e.workflowStep===Se.SELECTING_ROOT_FOLDER?g(y):g(R,!1)})}a(N),d(x,N),Oe()}export{La as component,ja as universal};
