import{f as x,a as h,c as Fe}from"../chunks/CTHEc7mS.js";import{z as ut,A as M,B as s,C as v,D as De,E as he,I as i,K as o,J as r,G as j,H as me,aH as ie,aI as dt,u as ge,F as fe,aJ as Ke,aC as Ae,af as pt}from"../chunks/DpPdw_ub.js";import{d as _e}from"../chunks/D_Kb6Vk8.js";import{p as ue,b as vt,i as P}from"../chunks/DxCQtHkc.js";import{r as gt,a as ft,s as Oe}from"../chunks/DofntP01.js";import{s as I}from"../chunks/CI280J2U.js";import{s as oe,e as Ne,i as Ee,D as ht,g as mt,a as _t,t as Ye,T as xt,p as bt,S as We,c as St,b as wt,d as yt,C as Ft,f as Nt,h as Et,j as It,k as Be,l as Zt,m as He,n as Me,o as Ct,q as zt,r as Dt,Z as Tt,B as kt,u as Pt,v as Gt,w as Rt,U as Mt,x as At,y as Ot}from"../chunks/CfalgjZT.js";import{b as Xe,A as Lt}from"../chunks/Cjq1WBUe.js";import{a as jt,r as $e}from"../chunks/BxNLRJF5.js";import{g as Vt}from"../chunks/n5zs9Xzy.js";const Ut=!0,Ha=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ut},Symbol.toStringTag,{value:"Module"}));var ve=(S=>(S.SELECTING_ROOT_FOLDER="SELECTING_ROOT_FOLDER",S.SELECTING_MANGA_FOLDERS="SELECTING_MANGA_FOLDERS",S.PROCESSING_MANGA="PROCESSING_MANGA",S))(ve||{}),ne=(S=>(S.PENDING="PENDING",S.PROCESSING="PROCESSING",S.COMPLETED="COMPLETED",S.ERROR="ERROR",S))(ne||{});class qt{#e=M(null);get rootFolderFiles(){return s(this.#e)}set rootFolderFiles(t){v(this.#e,t,!0)}#t=M(De([]));get zipFiles(){return s(this.#t)}set zipFiles(t){v(this.#t,t,!0)}#a=M(De([]));get selectedZipFiles(){return s(this.#a)}set selectedZipFiles(t){v(this.#a,t,!0)}#s=M(-1);get currentZipIndex(){return s(this.#s)}set currentZipIndex(t){v(this.#s,t,!0)}#r=M("SELECTING_ROOT_FOLDER");get workflowStep(){return s(this.#r)}set workflowStep(t){v(this.#r,t,!0)}get currentZip(){return this.currentZipIndex<0||this.currentZipIndex>=this.zipFiles.length?null:this.zipFiles[this.currentZipIndex]}get unprocessedZips(){return this.zipFiles.filter(t=>this.selectedZipFiles.includes(t.file)&&t.status==="PENDING")}get nextZip(){const t=this.unprocessedZips;return t.length===0?null:t[0]}setZipStatus(t,e){const a=this.zipFiles.find(w=>w.file===t);a&&(a.status=e)}moveToNextZip(){const t=this.nextZip;if(!t)return!1;const e=this.zipFiles.findIndex(a=>a.file===t.file);return e>=0?(this.currentZipIndex=e,!0):!1}get zipFilesByMangaFolder(){const t=new Map;for(const e of this.zipFiles)t.has(e.mangaFolderName)||t.set(e.mangaFolderName,[]),t.get(e.mangaFolderName).push(e);return t}reset(){this.rootFolderFiles=null,this.zipFiles=[],this.selectedZipFiles=[],this.currentZipIndex=-1,this.workflowStep="SELECTING_ROOT_FOLDER"}}const Wt=ut();var Bt=x('<div class="uno-4maolu"><div class="uno-senp7v"></div> <p class="uno-l6h9uf">Scanning folder structure...</p></div>'),Ht=x('<div class="uno-laclbo"><p class="uno-dl0t86"> </p></div>'),$t=x('<div class="uno-tm086o"><button><h1 class="uno-brv6u2">Select Root Folder</h1> <p class="uno-l6h9uf">Select the folder containing manga subfolders with .zip files</p> <input class="uno-qya2ty" type="file"/></button> <!> <!></div>');function Jt(S,t){he(t,!0);let e=ue(t,"guidedState",7),a=ue(t,"class",3,""),w=M(null),g=M(!1);async function G(E){v(g,!0);const A=E.target,H=Array.from(A.files??[]),D=[];for(const R of H){const T=(R.webkitRelativePath||R.name).split("/").filter(Boolean);if(T.length>=2){const Z=T[0],u=T[0],b=R.name.split(".").pop()?.toLowerCase();(b==="zip"||b==="cbz")&&D.push({file:R,mangaFolderName:Z,mangaFolderPath:u})}}e().rootFolderFiles=H,e().zipFiles=D.map(R=>({...R,status:ne.PENDING})),v(g,!1),t.onDone()}function y(E){s(w)?.click()}var V=$t(),N=i(V);N.__click=y;var z=o(i(N),4);z.webkitdirectory=!0,z.multiple=!0,z.__change=G,vt(z,E=>v(w,E),()=>s(w)),r(N);var O=o(N,2);{var X=E=>{var A=Bt();h(E,A)};P(O,E=>{s(g)&&E(X)})}var U=o(O,2);{var L=E=>{var A=Ht(),H=i(A),D=i(H);r(H),r(A),j(()=>I(D,`Found ${e().zipFiles.length??""} zip file${e().zipFiles.length===1?"":"s"}`)),h(E,A)};P(U,E=>{e().zipFiles.length>0&&E(L)})}r(V),j(()=>{oe(N,1,`uno-a4tqjo ${a()??""}`),N.disabled=s(g)}),h(S,V),me()}_e(["click","change"]);var Kt=x('<button type="button"><div class="uno-bpywdh"><p class="uno-98yf80"> </p> <p class="uno-42pivu"> </p></div> <input type="checkbox" class="uno-5onsv4"/></button>'),Yt=x('<div class="uno-o40niy"><div class="uno-iuhcpm"><h3 class="uno-0lb4rh"> </h3> <button type="button" class="uno-phh4jd"> </button></div> <div class="uno-fb55wk"></div></div>'),Xt=x('<div><div class="uno-iuhcpm"><h2 class="uno-iyer7g">Select Zip Files to Process</h2> <button type="button" class="uno-f45w65"> </button></div> <p class="uno-ok9xip"> </p> <div class="uno-yjimjk"></div> <button type="button" class="uno-3s4o5e"> </button></div>');function Qt(S,t){he(t,!0);let e=ue(t,"guidedState",7),a=ue(t,"class",3,"");function w(D){e().selectedZipFiles.indexOf(D)>=0?e().selectedZipFiles=e().selectedZipFiles.filter(m=>m!==D):e().selectedZipFiles=[...e().selectedZipFiles,D]}function g(D){const R=Array.from(e().zipFilesByMangaFolder.get(D)??[]);if(R.every(T=>e().selectedZipFiles.includes(T.file)))e().selectedZipFiles=e().selectedZipFiles.filter(T=>!R.some(Z=>Z.file===T));else{const T=R.map(Z=>Z.file).filter(Z=>!e().selectedZipFiles.includes(Z));e().selectedZipFiles=[...e().selectedZipFiles,...T]}}function G(){e().selectedZipFiles.length===e().zipFiles.length?e().selectedZipFiles=[]:e().selectedZipFiles=e().zipFiles.map(D=>D.file)}const y=ie(()=>e().zipFiles.length>0&&e().selectedZipFiles.length===e().zipFiles.length),V=ie(()=>e().zipFilesByMangaFolder);var N=Xt(),z=i(N),O=o(i(z),2);O.__click=G;var X=i(O,!0);r(O),r(z);var U=o(z,2),L=i(U);r(U);var E=o(U,2);Ne(E,21,()=>Array.from(s(V).entries()),Ee,(D,R)=>{var m=ie(()=>dt(s(R),2));let T=()=>s(m)[0],Z=()=>s(m)[1];var u=Yt(),b=i(u),C=i(b),q=i(C,!0);r(C);var J=o(C,2);J.__click=()=>g(T());var Q=i(J);r(J),r(b);var ee=o(b,2);Ne(ee,21,Z,Ee,(K,Y)=>{const te=ie(()=>e().selectedZipFiles.includes(s(Y).file));var n=Kt();n.__click=()=>w(s(Y).file);var d=i(n),f=i(d),l=i(f,!0);r(f);var _=o(f,2),c=i(_);r(_),r(d);var p=o(d,2);gt(p),r(n),j(F=>{oe(n,1,`uno-ik4adi ${s(te)?"uno-1k75dk":""}`),I(l,s(Y).file.name),I(c,`Size: ${F??""} MB`),ft(p,s(te))},[()=>(s(Y).file.size/(1024*1024)).toFixed(2)]),h(K,n)}),r(ee),r(u),j(K=>{I(q,T()),I(Q,`${K??""} (${Z().length??""})`)},[()=>Z().every(K=>e().selectedZipFiles.includes(K.file))?"Deselect All":"Select All"]),h(D,u)}),r(E);var A=o(E,2);A.__click=function(...D){t.onDone?.apply(this,D)};var H=i(A);r(A),r(N),j(()=>{oe(N,1,`uno-grwdkw ${a()??""}`),I(X,s(y)?"Deselect All":"Select All"),I(L,`${e().selectedZipFiles.length??""} of ${e().zipFiles.length??""} zip file${e().zipFiles.length===1?"":"s"} selected`),A.disabled=e().selectedZipFiles.length===0,I(H,`Continue to Processing (${e().selectedZipFiles.length??""} selected)`)}),h(S,N),me()}_e(["click"]);var ea=x('<p class="uno-a54tpo"> </p>'),ta=x('<div class="uno-cqccui"><p class="uno-nsysfu"> </p> <span> </span></div> <!>',1),aa=x('<p class="uno-b7m48p">No zip file selected</p>'),sa=x('<button type="button" class="uno-qm31yq"> </button>'),ra=x('<p class="uno-b7m48p">No more zip files to process</p>'),ia=x('<p class="uno-b7m48p">All zip files have been processed</p>'),na=x('<div><div class="uno-2db0z0"><h3 class="uno-py45hl">Current Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Next Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Unprocessed Zip Files</h3> <!></div></div>');function oa(S,t){he(t,!0);let e=ue(t,"guidedState",7),a=ue(t,"class",3,"");function w(){if(e().moveToNextZip()){const u=e().currentZip;u&&t.onZipSelected(u.file)}}function g(u){const b=e().zipFiles.find(C=>C.file.name===u);if(b){const C=e().zipFiles.findIndex(q=>q.file===b.file);C>=0&&(e().currentZipIndex=C,t.onZipSelected(b.file))}}const G=ie(()=>e().currentZip?.file.name??null),y=ie(()=>e().unprocessedZips.map(u=>u.file.name)),V=ie(()=>e().nextZip?.file.name??null);let N=M(null);ge(()=>{v(N,e().currentZip?.file.name??null,!0)}),ge(()=>{const u=s(N);if(u){const b=e().currentZip?.file.name??null;u!==b&&g(u)}});var z=na(),O=i(z),X=o(i(O),2);{var U=u=>{var b=ta(),C=fe(b),q=i(C),J=i(q,!0);r(q);var Q=o(q,2),ee=i(Q,!0);r(Q),r(C);var K=o(C,2);{var Y=te=>{var n=ea(),d=i(n);r(n),j(()=>I(d,`Manga Folder: ${e().currentZip.mangaFolderName??""}`)),h(te,n)};P(K,te=>{e().currentZip&&te(Y)})}j(()=>{I(J,s(G)),oe(Q,1,`uno-ielryd ${e().currentZip?.status===ne.PROCESSING?"uno-kxa2ln":e().currentZip?.status===ne.COMPLETED?"uno-b1425w":e().currentZip?.status===ne.ERROR?"uno-isu16c":"uno-jwlzg2"}`),I(ee,e().currentZip?.status??"UNKNOWN")}),h(u,b)},L=u=>{var b=aa();h(u,b)};P(X,u=>{s(G)?u(U):u(L,!1)})}r(O);var E=o(O,2),A=o(i(E),2);{var H=u=>{var b=sa();b.__click=w;var C=i(b);r(b),j(()=>I(C,`Process: ${s(V)??""}`)),h(u,b)},D=u=>{var b=ra();h(u,b)};P(A,u=>{s(V)?u(H):u(D,!1)})}r(E);var R=o(E,2),m=o(i(R),2);{var T=u=>{ht(u,{get items(){return s(y)},class:"uno-qbg2l1",get selectedItem(){return s(N)},set selectedItem(b){v(N,b,!0)}})},Z=u=>{var b=ia();h(u,b)};P(m,u=>{s(y).length>0?u(T):u(Z,!1)})}r(R),r(z),j(()=>oe(z,1,`uno-s0eao9 ${a()??""}`)),h(S,z),me()}_e(["click"]);function la(S){const t=mt(S,0);return _t(S,t,0,[])}function ca(S,t="v(\\d+)"){const e=new RegExp(t,"i"),a=S.match(e);return a&&a[1]?a[1].replace(/^0+/,"")||"0":null}function ua(S,t="c(\\d+(?:\\.\\d+){0,2})"){const e=new RegExp(t,"i"),a=S.match(e);if(a&&a[1]){const w=a[1];if(w.includes(".")){const g=w.split(".");return[g[0].replace(/^0+/,"")||"0",...g.slice(1)].join(".")}else return w.replace(/^0+/,"")||"0"}return null}function da(S){const t=/MD-(\d+)/i,e=S.match(t);return e?e[1]:null}var pa=x('<span class="uno-lzl9l3">Removed</span>'),va=x('<div class="uno-7qt2lg"><div class="uno-m5mbjf"></div> <span>Restore</span></div>'),ga=x('<div class="uno-7qt2lg"><div class="uno-9z7ooq"></div> <span>Remove</span></div>'),fa=x('<span class="uno-2et217"> </span>'),ha=x('<span class="uno-38wzts"> </span>'),ma=x('<div class="uno-zh7qvs"></div>'),_a=x('<span class="uno-2et217">No groups assigned</span>'),xa=x('<div><div class="uno-rzokcw"><div class="uno-n4d6p5"><span class="uno-upv063"> </span> <!> <div class="uno-0yx623"><span class="uno-7f6l2t">Vol:</span> <span class="uno-4g5bui"> </span></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Ch:</span> <span class="uno-4g5bui"> </span></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Pages:</span> <span class="uno-4g5bui"> </span></div></div> <button type="button"><!></button></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Title:</span> <div class="uno-aqzn48"><!> <!></div></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Groups:</span> <!></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Path:</span> <span class="uno-nggqeg"> </span></div></div>');function ba(S,t){he(t,!0);const e=Ke(Ye);if(!e)throw new Error("GuidedChapterEditor must be used within a component that provides TargetingState context");let a=ue(t,"chapter",7),w=ue(t,"class",3,"");function g(){a().isDeleted=!a().isDeleted}var G=xa(),y=i(G),V=i(y),N=i(V),z=i(N);r(N);var O=o(N,2);{var X=c=>{var p=pa();h(c,p)};P(O,c=>{a().isDeleted&&c(X)})}var U=o(O,2),L=o(i(U),2),E=i(L,!0);r(L),r(U);var A=o(U,2),H=o(i(A),2),D=i(H,!0);r(H),r(A);var R=o(A,2),m=o(i(R),2),T=i(m,!0);r(m),r(R),r(V);var Z=o(V,2);Z.__click=g;var u=i(Z);{var b=c=>{var p=va();h(c,p)},C=c=>{var p=ga();h(c,p)};P(u,c=>{a().isDeleted?c(b):c(C,!1)})}r(Z),r(y);var q=o(y,2),J=o(i(q),2),Q=i(J);xt(Q,{textClass:"text-sm text-app font-medium",fieldName:"title",get chapter(){return a()},get value(){return a().chapterTitle},set value(c){a().chapterTitle=c}});var ee=o(Q,2);{var K=c=>{var p=fa(),F=i(p);r(p),j(()=>I(F,`(${(a().originalFolderPath||"Untitled")??""})`)),h(c,p)};P(ee,c=>{a().chapterTitle||c(K)})}r(J),r(q);var Y=o(q,2),te=o(i(Y),2);{var n=c=>{var p=ma();Ne(p,21,()=>a().associatedGroup.groupIds,Ee,(F,W)=>{const $=ie(()=>e.availableScanGroups.find(de=>de.groupId===s(W)));var k=ha(),B=i(k,!0);r(k),j(()=>I(B,s($)?.groupName??s(W))),h(F,k)}),r(p),h(c,p)},d=c=>{var p=_a();h(c,p)};P(te,c=>{a().associatedGroup.groupIds&&a().associatedGroup.groupIds.length>0?c(n):c(d,!1)})}r(Y);var f=o(Y,2),l=o(i(f),2),_=i(l,!0);r(l),r(f),r(G),j(()=>{oe(G,1,`uno-3rf4hu ${a().isDeleted?"uno-d3zfvr":""} ${w()??""}`),I(z,`#${t.index+1}`),I(E,a().chapterVolume??"N/A"),I(D,a().chapterNumber??"N/A"),I(T,a().pages.length),oe(Z,1,`uno-lto8ne ${a().isDeleted?"uno-ld06wt":"uno-far8pd"}`),Oe(Z,"title",a().isDeleted?"Restore chapter":"Mark as removed"),I(_,a().originalFolderPath)}),h(S,G),me()}_e(["click"]);class Sa{#e=M(null);get legacyToWeebdexMap(){return s(this.#e)}set legacyToWeebdexMap(t){v(this.#e,t,!0)}#t=M(null);get weebdexToLegacyMap(){return s(this.#t)}set weebdexToLegacyMap(t){v(this.#t,t,!0)}#a=M(!1);get isLoading(){return s(this.#a)}set isLoading(t){v(this.#a,t,!0)}#s=M(null);get loadError(){return s(this.#s)}set loadError(t){v(this.#s,t,!0)}loadPromise=null;async load(){if(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)return;if(this.loadPromise)return this.loadPromise;this.isLoading=!0,this.loadError=null;let t,e;this.loadPromise=new Promise((a,w)=>{t=a,e=w});try{const a=jt("/weebdex_lookup.csv"),w=await fetch(a);if(!w.ok)throw new Error(`Failed to fetch CSV: ${w.status} ${w.statusText}`);const g=await w.text(),{legacyToWeebdex:G,weebdexToLegacy:y}=this.parseCSV(g);this.legacyToWeebdexMap=G,this.weebdexToLegacyMap=y,t()}catch(a){this.loadError=a instanceof Error?a:new Error("Unknown error loading CSV"),e(this.loadError)}finally{this.isLoading=!1}return this.loadPromise}async ensureLoaded(){if(!(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)){if(this.loadPromise){await this.loadPromise;return}await this.load()}}parseCSV(t){const e=bt(t,{columns:!0,skip_empty_lines:!0,trim:!0}),a=new We,w=new We;for(const g of e){const G=g.weebdex_id?.trim()||"",y=g.legacy_id?.trim()||"";G&&y&&(a.set(y,G),w.set(G,y))}return{legacyToWeebdex:a,weebdexToLegacy:w}}async getWeebdexIdFromLegacyId(t){return await this.ensureLoaded(),this.legacyToWeebdexMap===null?null:this.legacyToWeebdexMap.get(t)||null}}const Je=new Sa;var wa=x('<p class="uno-8520et"> </p>'),ya=x('<div class="uno-vsugad"><div class="uno-pj4440"></div> <p class="uno-hw2z5w"> </p> <!></div>'),Fa=x('<div class="uno-f2o4wl"><p class="uno-hw2z5w">Loading chapter dump and applying groups/titles...</p></div>'),Na=x('<span class="uno-czmb1a">Removed</span>'),Ea=x('<div class="uno-2umhxz"></div>'),Ia=x('<div class="uno-kp2ftc"></div>'),Za=x('<div><div class="uno-py2y93"><div class="uno-nxlaaf"><p class="uno-39vbxq"> </p> <!></div> <p class="uno-dsgwse"> </p></div> <button type="button"><!></button></div>'),Ca=x(`<div class="uno-bi16xf"><div class="uno-nnnwwl"><div class="uno-djaa0e"><p class="uno-apr5a0"> </p> <p class="uno-lp9tww">The following chapters already exist on WeebDex with matching groups. You can mark
								them as removed to skip uploading.</p></div> <button type="button" class="uno-3jkjwc" title="Mark all duplicate chapters as removed">Removed duplicate chapters</button></div> <div class="uno-56cpuz"></div></div>`),za=x('<div class="uno-hemz07"><div class="uno-ns83sq"><p class="uno-0zsd1s"> </p></div> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Series Selection (Required)</h3> <!> <!> <!></div> <!> <!> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Detected Chapters</h3> <div class="uno-xqlxhl"></div></div> <button type="button" class="uno-d93lfx"> </button></div>'),Da=x('<div class="uno-6nb6x4"><p class="uno-dillda">✓ Upload completed successfully!</p></div>'),Ta=x('<div><h2 class="uno-67n1yz"> </h2> <!></div>');function ka(S,t){he(t,!0),St({useWebWorkers:!1});let e=ue(t,"class",3,"");const a=new wt;Ae(Ye,a);const w=Ke(Xe);if(!w)throw new Error("MangaProcessor must be used within a component that provides ApiAuthContext");let g=M("loading"),G=M(null),y=M(De([])),V=M(!1),N=M(!1),z=M(null),O=M(!1),X=M(null),U=M(!1),L=M(De([]));const E=["jpg","jpeg","png","gif","webp","cbz","zip","xml"];ge(()=>{t.zipFile&&(v(O,!1),v(X,null),v(L,[],!0),D())});async function A(n){const d=n.name.split(".").pop()?.toLowerCase();if(!(d==="cbz")&&!(d==="zip"))throw new Error(`Unsupported archive format: ${d}`);console.log(`Extracting ${d} file:`,n.name),v(z,n.name,!0);const _=new Tt(new kt(n)),c=await _.getEntries(),p=[],F=n.name.replace(/\.(cbz|zip)$/i,""),W=n.webkitRelativePath||n.name;for(const $ of c){if(!$.filename||$.directory)continue;const k=$.filename.split(".").pop()?.toLowerCase();if(!k||!E.includes(k))continue;const B=new TransformStream,de=new Response(B.readable).blob();await $.getData(B.writable);let le=await de;if(!le.type){const be=H(k);le=new Blob([le],{type:be})}const se=$.filename,xe=se.split("/").pop()??se,Ie=W.includes("/")?`${W.split("/").slice(0,-1).join("/")}/${F}/${se}`:`${F}/${se}`,Ze=new File([le],xe,{type:le.type});Object.defineProperty(Ze,"webkitRelativePath",{value:Ie,writable:!1,enumerable:!0,configurable:!0}),p.push(Ze)}return await _.close(),v(z,null),p}function H(n){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp"}[n]||"application/octet-stream"}async function D(){v(g,"loading"),a.reset();const n=da(t.zipFile.name);if(n)try{await Je.load();const l=await Je.getWeebdexIdFromLegacyId(n);l?(a.seriesId=l,console.log(`Auto-detected series ID from MD-####: ${n} -> ${l}`)):console.log(`No WeebDex ID found for MangaDex ID: ${n}`)}catch(l){console.warn(`Failed to lookup WeebDex ID for MangaDex ID ${n}:`,l)}v(g,"extracting");let d=[];try{d=await A(t.zipFile)}catch(l){console.error(`Error extracting ${t.zipFile.name}:`,l),t.guidedState.setZipStatus(t.zipFile,ne.ERROR);return}v(G,yt(d),!0);const f=la(s(G));v(g,"extracting"),v(y,await Promise.all(f.map(async l=>{const _=ca(l.name),c=ua(l.name),p=l.files.filter(F=>F.type===Ft.CHAPTER_PAGE).map((F,W)=>new Nt(F.file.name,W,F.file,Et.NOT_STARTED,0,null,null,!1,F.type));return new It(l.path,l.name,_,c,new Be,new Zt,p,He.NOT_STARTED,0,null,null,l,!1,"en")})),!0),s(y).sort((l,_)=>{if(l.chapterVolume&&_.chapterVolume){const c=String(l.chapterVolume).localeCompare(String(_.chapterVolume),void 0,{numeric:!0,sensitivity:"base"});if(c!==0)return c}else{if(l.chapterVolume)return-1;if(_.chapterVolume)return 1}return l.chapterNumber&&_.chapterNumber?String(l.chapterNumber).localeCompare(String(_.chapterNumber),void 0,{numeric:!0,sensitivity:"base"}):l.chapterNumber?-1:_.chapterNumber?1:0}),a.chapterStates=s(y),v(g,"ready")}ge(()=>{a.seriesId!==null&&a.chapterStates.forEach(n=>{n.associatedSeries||(n.associatedSeries=new Be),n.associatedSeries.seriesId=a.seriesId??""})}),ge(()=>{a.seriesId&&s(g)==="ready"&&(!s(O)||a.seriesId!==s(X))&&(v(O,!0),v(X,a.seriesId,!0),v(g,"series_lookup"),R())});async function R(){if(a.seriesId)try{await Me.load();const n=await Me.getAllGroupNames(a.seriesId);if(n.length===0){console.warn("No groups found in chapter dump");return}const d=[];for(const f of n)try{const l=await Ct(f);if(l.data){const _=l.data.find(c=>c.name===f);if(_){const c=new zt;c.groupId=_.id,c.groupName=_.name,d.push(c)}}}catch(l){console.warn(`Failed to lookup group "${f}":`,l)}a.availableScanGroups=d,await m(),await T(),await Z(),v(g,"ready")}catch(n){console.error("Error loading chapter dump:",n),v(g,"ready")}}async function m(){for(const n of a.chapterStates){if(!n.originalFolderPath)continue;const d=a.availableScanGroups.filter(f=>n.originalFolderPath?.includes(f.groupName)??!1);if(d.length>0){const f=n.associatedGroup.groupIds??[],l=new Set(f);for(const _ of d)l.has(_.groupId)||l.add(_.groupId);n.associatedGroup.groupIds=Array.from(l)}}}async function T(){if(!a.seriesId)return;const n=new Map;for(const d of a.availableScanGroups)n.set(d.groupId,d.groupName);for(const d of a.chapterStates){const f=d.associatedGroup.groupIds??[];if(f.length===0)continue;const l=f.map(p=>n.get(p)).filter(p=>p!==void 0);if(l.length===0)continue;const _=await Me.getChapterInfo(a.seriesId,d.chapterVolume,d.chapterNumber);if(!_)continue;l.some(p=>_.groupNames.includes(p))&&(d.chapterTitle=_.title)}}async function Z(){if(a.seriesId)try{const n=await Dt(a.seriesId),d=[],f=new Map;for(const l of n.chapters){const _=l.volume||"none",c=l.chapter,p=`${_}:${c}`;f.set(p,l)}for(const l of a.chapterStates){const _=l.chapterVolume||"none",c=l.chapterNumber;if(!c)continue;const p=`${_}:${c}`,F=f.get(p);if(F&&F.entries&&Object.keys(F.entries).length>0){const W=new Set;for(const k of Object.values(F.entries))for(const B of k.groups)W.add(B);const $=[];for(const k of W)if(n.groups&&n.groups[k]){const B=n.groups[k];$.push(`${B.name} (${B.id})`)}else $.push(`Unknown Group (index: ${k})`);d.push({chapter:l,existingGroups:$.length>0?$:["Unknown groups"]})}}v(L,d,!0)}catch(n){console.error("Error checking for duplicates:",n),v(L,[],!0)}}function u(){s(U)||(v(U,!0),v(V,!1),v(g,"completed"),t.guidedState.setZipStatus(t.zipFile,ne.COMPLETED),t.onProcessingComplete())}function b(){if(!w.apiToken){alert("Please set up API authentication first");return}if(!a.seriesId){alert("Please set a series ID first");return}if(a.chapterStates.length===0){alert("No chapters to upload");return}v(g,"uploading"),v(V,!0),v(U,!1),t.guidedState.setZipStatus(t.zipFile,ne.PROCESSING)}const C=ie(()=>s(g)==="ready"||s(g)==="series_lookup"),q=ie(()=>s(y).filter(n=>!n.isDeleted));ge(()=>{if(s(g)==="uploading"&&s(y).length>0){const n=s(y).every(f=>f.status===He.COMPLETED||f.isDeleted),d=s(y).some(f=>!f.isDeleted);n&&d&&!s(V)&&(t.guidedState.setZipStatus(t.zipFile,ne.COMPLETED),u())}});var J=Ta(),Q=i(J),ee=i(Q);r(Q);var K=o(Q,2);{var Y=n=>{var d=ya(),f=o(i(d),2),l=i(f,!0);r(f);var _=o(f,2);{var c=p=>{var F=wa(),W=i(F);r(F),j(()=>I(W,`Processing: ${s(z)??""}`)),h(p,F)};P(_,p=>{s(z)&&p(c)})}r(d),j(()=>I(l,s(g)==="loading"?"Loading manga folder...":"Extracting zip files...")),h(n,d)},te=n=>{var d=Fe(),f=fe(d);{var l=c=>{var p=za(),F=i(p),W=i(F),$=i(W);r(W),r(F);var k=o(F,2),B=o(i(k),2);Pt(B,{});var de=o(B,2);Gt(de,{});var le=o(de,2);Rt(le,{}),r(k);var se=o(k,2);{var xe=ce=>{var pe=Fa();h(ce,pe)};P(se,ce=>{s(g)==="series_lookup"&&ce(xe)})}var Ie=o(se,2);{var Ze=ce=>{var pe=Ca(),Se=i(pe),Te=i(Se),je=i(Te),et=i(je);r(je),pt(2),r(Te);var tt=o(Te,2);tt.__click=()=>{for(const{chapter:ke}of s(L))ke.isDeleted=!0},r(Se);var Ve=o(Se,2);Ne(Ve,21,()=>s(L),Ee,(ke,Ue)=>{let re=()=>s(Ue).chapter,at=()=>s(Ue).existingGroups;var ze=Za(),Pe=i(ze),Ge=i(Pe),Re=i(Ge),st=i(Re);r(Re);var rt=o(Re,2);{var it=ae=>{var ye=Na();h(ae,ye)};P(rt,ae=>{re().isDeleted&&ae(it)})}r(Ge);var qe=o(Ge,2),nt=i(qe);r(qe),r(Pe);var we=o(Pe,2);we.__click=()=>{re().isDeleted=!re().isDeleted};var ot=i(we);{var lt=ae=>{var ye=Ea();h(ae,ye)},ct=ae=>{var ye=Ia();h(ae,ye)};P(ot,ae=>{re().isDeleted?ae(lt):ae(ct,!1)})}r(we),r(ze),j(ae=>{oe(ze,1,`uno-ecxsrr ${re().isDeleted?"uno-1ya9ju":""}`),I(st,`Vol. ${re().chapterVolume??"N/A"??""} Ch. ${re().chapterNumber??"N/A"??""} - ${(re().chapterTitle||re().originalFolderPath||"Untitled")??""}`),I(nt,`Existing groups: ${ae??""}`),oe(we,1,`uno-v1bdur ${re().isDeleted?"uno-uigj71":"uno-8ta9ap"}`),Oe(we,"title",re().isDeleted?"Restore chapter":"Mark as removed")},[()=>at().join(", ")]),h(ke,ze)}),r(Ve),r(pe),j(()=>I(et,`⚠️ Warning: ${s(L).length??""} duplicate chapter${s(L).length===1?"":"s"} detected`)),h(ce,pe)};P(Ie,ce=>{s(L).length>0&&ce(Ze)})}var be=o(Ie,2),Le=o(i(be),2);Ne(Le,21,()=>s(y),Ee,(ce,pe,Se)=>{ba(ce,{index:Se,get chapter(){return s(pe)}})}),r(Le),r(be);var Ce=o(be,2);Ce.__click=b;var Qe=i(Ce);r(Ce),r(p),j(()=>{I($,`Found ${s(y).length??""} chapter${s(y).length===1?"":"s"} from deepest folders`),Ce.disabled=!s(C)||!a.seriesId||s(q).length===0,I(Qe,`Start Upload (${s(q).length??""} of ${s(y).length??""} chapters)`)}),h(c,p)},_=c=>{var p=Fe(),F=fe(p);{var W=k=>{Mt(k,{onDone:u,get busy(){return s(N)},set busy(B){v(N,B,!0)}})},$=k=>{var B=Fe(),de=fe(B);{var le=se=>{var xe=Da();h(se,xe)};P(de,se=>{s(g)==="completed"&&se(le)},!0)}h(k,B)};P(F,k=>{s(g)==="uploading"?k(W):k($,!1)},!0)}h(c,p)};P(f,c=>{s(g)==="ready"||s(g)==="series_lookup"?c(l):c(_,!1)},!0)}h(n,d)};P(K,n=>{s(g)==="loading"||s(g)==="extracting"?n(Y):n(te,!1)})}r(J),j(()=>{oe(J,1,`uno-hemz07 ${e()??""}`),I(ee,`Processing: ${t.zipFile.name??""}`)}),h(S,J),me()}_e(["click"]);var Pa=x('<div class="uno-j48514"><p class="uno-5v04yw">No zip file selected. Use the tabs above to select a zip file to process.</p></div>'),Ga=x('<div class="uno-eeu1av"><!> <!></div>'),Ra=x('<div class="uno-pb4e2u"><div class="uno-k0pcvl"><h1 class="uno-kryzyj">Guided Zip Manga Uploader</h1> <div class="uno-skt2gn"><button type="button" class="uno-q7l7gr">Simple Mode</button> <!></div></div> <a target="_blank" class="uno-6zhxse">Tutorial & Docs</a> <!> <!></div>');function $a(S,t){he(t,!0);const e=new qt;Ae(Wt,e),Ae(Xe,new Lt);let a=M(null);function w(){e.workflowStep=ve.SELECTING_MANGA_FOLDERS}function g(){if(e.workflowStep=ve.PROCESSING_MANGA,e.selectedZipFiles.length>0){const m=e.selectedZipFiles[0],T=e.zipFiles.findIndex(Z=>Z.file===m);T>=0&&(e.currentZipIndex=T,v(a,m,!0))}}function G(m){v(a,m,!0),e.setZipStatus(m,ne.PROCESSING)}function y(){if(e.moveToNextZip()){const m=e.currentZip;m&&(v(a,m.file,!0),e.setZipStatus(m.file,ne.PROCESSING))}else v(a,null)}const V=ie(()=>e.workflowStep!==ve.PROCESSING_MANGA);var N=Ra(),z=i(N),O=o(i(z),2),X=i(O);X.__click=()=>Vt($e("/"));var U=o(X,2);At(U,{}),r(O),r(z);var L=o(z,2),E=o(L,2);{var A=m=>{Ot(m,{})};P(E,m=>{s(V)&&m(A)})}var H=o(E,2);{var D=m=>{Jt(m,{get guidedState(){return e},onDone:w,class:"uno-zgouyr"})},R=m=>{var T=Fe(),Z=fe(T);{var u=C=>{Qt(C,{get guidedState(){return e},onDone:g,class:"uno-l0uum8"})},b=C=>{var q=Fe(),J=fe(q);{var Q=ee=>{var K=Ga(),Y=i(K);oa(Y,{get guidedState(){return e},onZipSelected:G,class:"uno-wgeun8"});var te=o(Y,2);{var n=f=>{ka(f,{get guidedState(){return e},get zipFile(){return s(a)},onProcessingComplete:y,class:"uno-wgeun8"})},d=f=>{var l=Pa();h(f,l)};P(te,f=>{s(a)?f(n):f(d,!1)})}r(K),h(ee,K)};P(J,ee=>{e.workflowStep===ve.PROCESSING_MANGA&&ee(Q)},!0)}h(C,q)};P(Z,C=>{e.workflowStep===ve.SELECTING_MANGA_FOLDERS?C(u):C(b,!1)},!0)}h(m,T)};P(H,m=>{e.workflowStep===ve.SELECTING_ROOT_FOLDER?m(D):m(R,!1)})}r(N),j(m=>Oe(L,"href",m),[()=>$e("/docs")]),h(S,N),me()}_e(["click"]);export{$a as component,Ha as universal};
