import{f as _,a as h,c as Ee}from"../chunks/CTHEc7mS.js";import{z as ut,A as R,B as s,C as v,D as De,E as _e,I as i,K as l,J as r,G as V,H as xe,aH as oe,aI as dt,u as he,F as me,aJ as Ke,aC as Ae,af as pt}from"../chunks/DpPdw_ub.js";import{d as be}from"../chunks/D_Kb6Vk8.js";import{p as pe,b as vt,i as k}from"../chunks/DxCQtHkc.js";import{r as gt,a as ft,s as Oe}from"../chunks/DofntP01.js";import{s as N}from"../chunks/CI280J2U.js";import{s as ce,e as Ie,i as Ne,D as ht,g as mt,a as _t,t as Ye,T as xt,p as bt,S as We,c as St,b as wt,d as yt,C as Ft,f as Et,h as It,j as Nt,k as Be,l as Zt,m as He,n as Me,o as Ct,q as zt,r as Dt,Z as Tt,B as kt,u as Gt,v as Pt,w as Rt,U as Mt,x as At,y as Ot}from"../chunks/B0KXTkYT.js";import{b as Xe,A as Lt}from"../chunks/Cjq1WBUe.js";import{a as jt,r as $e}from"../chunks/TLffyemx.js";import{g as Vt}from"../chunks/BQRTbKKB.js";const Ut=!0,Ha=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ut},Symbol.toStringTag,{value:"Module"}));var ge=(b=>(b.SELECTING_ROOT_FOLDER="SELECTING_ROOT_FOLDER",b.SELECTING_MANGA_FOLDERS="SELECTING_MANGA_FOLDERS",b.PROCESSING_MANGA="PROCESSING_MANGA",b))(ge||{}),le=(b=>(b.PENDING="PENDING",b.PROCESSING="PROCESSING",b.COMPLETED="COMPLETED",b.ERROR="ERROR",b))(le||{});class qt{#e=R(null);get rootFolderFiles(){return s(this.#e)}set rootFolderFiles(t){v(this.#e,t,!0)}#t=R(De([]));get zipFiles(){return s(this.#t)}set zipFiles(t){v(this.#t,t,!0)}#a=R(De([]));get selectedZipFiles(){return s(this.#a)}set selectedZipFiles(t){v(this.#a,t,!0)}#s=R(-1);get currentZipIndex(){return s(this.#s)}set currentZipIndex(t){v(this.#s,t,!0)}#r=R("SELECTING_ROOT_FOLDER");get workflowStep(){return s(this.#r)}set workflowStep(t){v(this.#r,t,!0)}get currentZip(){return this.currentZipIndex<0||this.currentZipIndex>=this.zipFiles.length?null:this.zipFiles[this.currentZipIndex]}get unprocessedZips(){return this.zipFiles.filter(t=>this.selectedZipFiles.includes(t.file)&&t.status==="PENDING")}get nextZip(){const t=this.unprocessedZips;return t.length===0?null:t[0]}setZipStatus(t,e){const a=this.zipFiles.find(y=>y.file===t);a&&(a.status=e)}moveToNextZip(){const t=this.nextZip;if(!t)return!1;const e=this.zipFiles.findIndex(a=>a.file===t.file);return e>=0?(this.currentZipIndex=e,!0):!1}get zipFilesByMangaFolder(){const t=new Map;for(const e of this.zipFiles)t.has(e.mangaFolderName)||t.set(e.mangaFolderName,[]),t.get(e.mangaFolderName).push(e);return t}reset(){this.rootFolderFiles=null,this.zipFiles=[],this.selectedZipFiles=[],this.currentZipIndex=-1,this.workflowStep="SELECTING_ROOT_FOLDER"}}const Wt=ut();var Bt=_('<div class="uno-4maolu"><div class="uno-senp7v"></div> <p class="uno-l6h9uf">Scanning folder structure...</p></div>'),Ht=_('<div class="uno-laclbo"><p class="uno-dl0t86"> </p></div>'),$t=_('<div class="uno-tm086o"><button><h1 class="uno-brv6u2">Select Root Folder</h1> <p class="uno-l6h9uf">Select the folder containing manga subfolders with .zip files</p> <input class="uno-qya2ty" type="file"/></button> <!> <!></div>');function Jt(b,t){_e(t,!0);let e=pe(t,"guidedState",7),a=pe(t,"class",3,""),y=R(null),g=R(!1);async function G(I){v(g,!0);const M=I.target,B=Array.from(M.files??[]),D=[];for(const P of B){const T=(P.webkitRelativePath||P.name).split("/").filter(Boolean);if(T.length>=2){const Z=T[0],d=T[0],x=P.name.split(".").pop()?.toLowerCase();(x==="zip"||x==="cbz")&&D.push({file:P,mangaFolderName:Z,mangaFolderPath:d})}}e().rootFolderFiles=B,e().zipFiles=D.map(P=>({...P,status:le.PENDING})),v(g,!1),t.onDone()}function F(I){s(y)?.click()}var U=$t(),E=i(U);E.__click=F;var z=l(i(E),4);z.webkitdirectory=!0,z.multiple=!0,z.__change=G,vt(z,I=>v(y,I),()=>s(y)),r(E);var L=l(E,2);{var Q=I=>{var M=Bt();h(I,M)};k(L,I=>{s(g)&&I(Q)})}var q=l(L,2);{var j=I=>{var M=Ht(),B=i(M),D=i(B);r(B),r(M),V(()=>N(D,`Found ${e().zipFiles.length??""} zip file${e().zipFiles.length===1?"":"s"}`)),h(I,M)};k(q,I=>{e().zipFiles.length>0&&I(j)})}r(U),V(()=>{ce(E,1,`uno-a4tqjo ${a()??""}`),E.disabled=s(g)}),h(b,U),xe()}be(["click","change"]);var Kt=_('<button type="button"><div class="uno-bpywdh"><p class="uno-98yf80"> </p> <p class="uno-42pivu"> </p></div> <input type="checkbox" class="uno-5onsv4"/></button>'),Yt=_('<div class="uno-o40niy"><div class="uno-iuhcpm"><h3 class="uno-0lb4rh"> </h3> <button type="button" class="uno-phh4jd"> </button></div> <div class="uno-fb55wk"></div></div>'),Xt=_('<div><div class="uno-iuhcpm"><h2 class="uno-iyer7g">Select Zip Files to Process</h2> <button type="button" class="uno-f45w65"> </button></div> <p class="uno-ok9xip"> </p> <div class="uno-yjimjk"></div> <button type="button" class="uno-3s4o5e"> </button></div>');function Qt(b,t){_e(t,!0);let e=pe(t,"guidedState",7),a=pe(t,"class",3,"");function y(D){e().selectedZipFiles.indexOf(D)>=0?e().selectedZipFiles=e().selectedZipFiles.filter(m=>m!==D):e().selectedZipFiles=[...e().selectedZipFiles,D]}function g(D){const P=Array.from(e().zipFilesByMangaFolder.get(D)??[]);if(P.every(T=>e().selectedZipFiles.includes(T.file)))e().selectedZipFiles=e().selectedZipFiles.filter(T=>!P.some(Z=>Z.file===T));else{const T=P.map(Z=>Z.file).filter(Z=>!e().selectedZipFiles.includes(Z));e().selectedZipFiles=[...e().selectedZipFiles,...T]}}function G(){e().selectedZipFiles.length===e().zipFiles.length?e().selectedZipFiles=[]:e().selectedZipFiles=e().zipFiles.map(D=>D.file)}const F=oe(()=>e().zipFiles.length>0&&e().selectedZipFiles.length===e().zipFiles.length),U=oe(()=>e().zipFilesByMangaFolder);var E=Xt(),z=i(E),L=l(i(z),2);L.__click=G;var Q=i(L,!0);r(L),r(z);var q=l(z,2),j=i(q);r(q);var I=l(q,2);Ie(I,21,()=>Array.from(s(U).entries()),Ne,(D,P)=>{var m=oe(()=>dt(s(P),2));let T=()=>s(m)[0],Z=()=>s(m)[1];var d=Yt(),x=i(d),C=i(x),W=i(C,!0);r(C);var K=l(C,2);K.__click=()=>g(T());var ee=i(K);r(K),r(x);var se=l(x,2);Ie(se,21,Z,Ne,(Y,X)=>{const re=oe(()=>e().selectedZipFiles.includes(s(X).file));var n=Kt();n.__click=()=>y(s(X).file);var p=i(n),f=i(p),u=i(f,!0);r(f);var S=l(f,2),o=i(S);r(S),r(p);var c=l(p,2);gt(c),r(n),V(w=>{ce(n,1,`uno-ik4adi ${s(re)?"uno-1k75dk":""}`),N(u,s(X).file.name),N(o,`Size: ${w??""} MB`),ft(c,s(re))},[()=>(s(X).file.size/(1024*1024)).toFixed(2)]),h(Y,n)}),r(se),r(d),V(Y=>{N(W,T()),N(ee,`${Y??""} (${Z().length??""})`)},[()=>Z().every(Y=>e().selectedZipFiles.includes(Y.file))?"Deselect All":"Select All"]),h(D,d)}),r(I);var M=l(I,2);M.__click=function(...D){t.onDone?.apply(this,D)};var B=i(M);r(M),r(E),V(()=>{ce(E,1,`uno-grwdkw ${a()??""}`),N(Q,s(F)?"Deselect All":"Select All"),N(j,`${e().selectedZipFiles.length??""} of ${e().zipFiles.length??""} zip file${e().zipFiles.length===1?"":"s"} selected`),M.disabled=e().selectedZipFiles.length===0,N(B,`Continue to Processing (${e().selectedZipFiles.length??""} selected)`)}),h(b,E),xe()}be(["click"]);var ea=_('<p class="uno-a54tpo"> </p>'),ta=_('<div class="uno-cqccui"><p class="uno-nsysfu"> </p> <span> </span></div> <!>',1),aa=_('<p class="uno-b7m48p">No zip file selected</p>'),sa=_('<button type="button" class="uno-qm31yq"> </button>'),ra=_('<p class="uno-b7m48p">No more zip files to process</p>'),ia=_('<p class="uno-b7m48p">All zip files have been processed</p>'),na=_('<div><div class="uno-2db0z0"><h3 class="uno-py45hl">Current Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Next Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Unprocessed Zip Files</h3> <!></div></div>');function oa(b,t){_e(t,!0);let e=pe(t,"guidedState",7),a=pe(t,"class",3,"");function y(){if(e().moveToNextZip()){const d=e().currentZip;d&&t.onZipSelected(d.file)}}function g(d){const x=e().zipFiles.find(C=>C.file.name===d);if(x){const C=e().zipFiles.findIndex(W=>W.file===x.file);C>=0&&(e().currentZipIndex=C,t.onZipSelected(x.file))}}const G=oe(()=>e().currentZip?.file.name??null),F=oe(()=>e().unprocessedZips.map(d=>d.file.name)),U=oe(()=>e().nextZip?.file.name??null);let E=R(null);he(()=>{v(E,e().currentZip?.file.name??null,!0)}),he(()=>{const d=s(E);if(d){const x=e().currentZip?.file.name??null;d!==x&&g(d)}});var z=na(),L=i(z),Q=l(i(L),2);{var q=d=>{var x=ta(),C=me(x),W=i(C),K=i(W,!0);r(W);var ee=l(W,2),se=i(ee,!0);r(ee),r(C);var Y=l(C,2);{var X=re=>{var n=ea(),p=i(n);r(n),V(()=>N(p,`Manga Folder: ${e().currentZip.mangaFolderName??""}`)),h(re,n)};k(Y,re=>{e().currentZip&&re(X)})}V(()=>{N(K,s(G)),ce(ee,1,`uno-ielryd ${e().currentZip?.status===le.PROCESSING?"uno-kxa2ln":e().currentZip?.status===le.COMPLETED?"uno-b1425w":e().currentZip?.status===le.ERROR?"uno-isu16c":"uno-jwlzg2"}`),N(se,e().currentZip?.status??"UNKNOWN")}),h(d,x)},j=d=>{var x=aa();h(d,x)};k(Q,d=>{s(G)?d(q):d(j,!1)})}r(L);var I=l(L,2),M=l(i(I),2);{var B=d=>{var x=sa();x.__click=y;var C=i(x);r(x),V(()=>N(C,`Process: ${s(U)??""}`)),h(d,x)},D=d=>{var x=ra();h(d,x)};k(M,d=>{s(U)?d(B):d(D,!1)})}r(I);var P=l(I,2),m=l(i(P),2);{var T=d=>{ht(d,{get items(){return s(F)},class:"uno-qbg2l1",get selectedItem(){return s(E)},set selectedItem(x){v(E,x,!0)}})},Z=d=>{var x=ia();h(d,x)};k(m,d=>{s(F).length>0?d(T):d(Z,!1)})}r(P),r(z),V(()=>ce(z,1,`uno-s0eao9 ${a()??""}`)),h(b,z),xe()}be(["click"]);function la(b){const t=mt(b,0);return _t(b,t,0,[])}function ca(b,t="v(\\d+)"){const e=new RegExp(t,"i"),a=b.match(e);return a&&a[1]?a[1].replace(/^0+/,"")||"0":null}function ua(b,t="c(\\d+(?:\\.\\d+){0,2})"){const e=new RegExp(t,"i"),a=b.match(e);if(a&&a[1]){const y=a[1];if(y.includes(".")){const g=y.split(".");return[g[0].replace(/^0+/,"")||"0",...g.slice(1)].join(".")}else return y.replace(/^0+/,"")||"0"}return null}function da(b){const t=/MD-(\d+)/i,e=b.match(t);return e?e[1]:null}var pa=_('<span class="uno-lzl9l3">Removed</span>'),va=_('<div class="uno-7qt2lg"><div class="uno-m5mbjf"></div> <span>Restore</span></div>'),ga=_('<div class="uno-7qt2lg"><div class="uno-9z7ooq"></div> <span>Remove</span></div>'),fa=_('<span class="uno-2et217"> </span>'),ha=_('<span class="uno-38wzts"> </span>'),ma=_('<div class="uno-zh7qvs"></div>'),_a=_('<span class="uno-2et217">No groups assigned</span>'),xa=_('<div><div class="uno-rzokcw"><div class="uno-n4d6p5"><span class="uno-upv063"> </span> <!> <div class="uno-0yx623"><span class="uno-7f6l2t">Vol:</span> <span class="uno-4g5bui"> </span></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Ch:</span> <span class="uno-4g5bui"> </span></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Pages:</span> <span class="uno-4g5bui"> </span></div></div> <button type="button"><!></button></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Title:</span> <div class="uno-aqzn48"><!> <!></div></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Groups:</span> <!></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Path:</span> <span class="uno-nggqeg"> </span></div></div>');function ba(b,t){_e(t,!0);const e=Ke(Ye);if(!e)throw new Error("GuidedChapterEditor must be used within a component that provides TargetingState context");let a=pe(t,"chapter",7),y=pe(t,"class",3,"");function g(){a().isDeleted=!a().isDeleted}var G=xa(),F=i(G),U=i(F),E=i(U),z=i(E);r(E);var L=l(E,2);{var Q=o=>{var c=pa();h(o,c)};k(L,o=>{a().isDeleted&&o(Q)})}var q=l(L,2),j=l(i(q),2),I=i(j,!0);r(j),r(q);var M=l(q,2),B=l(i(M),2),D=i(B,!0);r(B),r(M);var P=l(M,2),m=l(i(P),2),T=i(m,!0);r(m),r(P),r(U);var Z=l(U,2);Z.__click=g;var d=i(Z);{var x=o=>{var c=va();h(o,c)},C=o=>{var c=ga();h(o,c)};k(d,o=>{a().isDeleted?o(x):o(C,!1)})}r(Z),r(F);var W=l(F,2),K=l(i(W),2),ee=i(K);xt(ee,{textClass:"text-sm text-app font-medium",fieldName:"title",get chapter(){return a()},get value(){return a().chapterTitle},set value(o){a().chapterTitle=o}});var se=l(ee,2);{var Y=o=>{var c=fa(),w=i(c);r(c),V(()=>N(w,`(${(a().originalFolderPath||"Untitled")??""})`)),h(o,c)};k(se,o=>{a().chapterTitle||o(Y)})}r(K),r(W);var X=l(W,2),re=l(i(X),2);{var n=o=>{var c=ma();Ie(c,21,()=>a().associatedGroup.groupIds,Ne,(w,A)=>{const H=oe(()=>e.availableScanGroups.find(ae=>ae.groupId===s(A)));var O=ha(),$=i(O,!0);r(O),V(()=>N($,s(H)?.groupName??s(A))),h(w,O)}),r(c),h(o,c)},p=o=>{var c=_a();h(o,c)};k(re,o=>{a().associatedGroup.groupIds&&a().associatedGroup.groupIds.length>0?o(n):o(p,!1)})}r(X);var f=l(X,2),u=l(i(f),2),S=i(u,!0);r(u),r(f),r(G),V(()=>{ce(G,1,`uno-3rf4hu ${a().isDeleted?"uno-d3zfvr":""} ${y()??""}`),N(z,`#${t.index+1}`),N(I,a().chapterVolume??"N/A"),N(D,a().chapterNumber??"N/A"),N(T,a().pages.length),ce(Z,1,`uno-lto8ne ${a().isDeleted?"uno-ld06wt":"uno-far8pd"}`),Oe(Z,"title",a().isDeleted?"Restore chapter":"Mark as removed"),N(S,a().originalFolderPath)}),h(b,G),xe()}be(["click"]);class Sa{#e=R(null);get legacyToWeebdexMap(){return s(this.#e)}set legacyToWeebdexMap(t){v(this.#e,t,!0)}#t=R(null);get weebdexToLegacyMap(){return s(this.#t)}set weebdexToLegacyMap(t){v(this.#t,t,!0)}#a=R(!1);get isLoading(){return s(this.#a)}set isLoading(t){v(this.#a,t,!0)}#s=R(null);get loadError(){return s(this.#s)}set loadError(t){v(this.#s,t,!0)}loadPromise=null;async load(){if(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)return;if(this.loadPromise)return this.loadPromise;this.isLoading=!0,this.loadError=null;let t,e;this.loadPromise=new Promise((a,y)=>{t=a,e=y});try{const a=jt("/weebdex_lookup.csv"),y=await fetch(a);if(!y.ok)throw new Error(`Failed to fetch CSV: ${y.status} ${y.statusText}`);const g=await y.text(),{legacyToWeebdex:G,weebdexToLegacy:F}=this.parseCSV(g);this.legacyToWeebdexMap=G,this.weebdexToLegacyMap=F,t()}catch(a){this.loadError=a instanceof Error?a:new Error("Unknown error loading CSV"),e(this.loadError)}finally{this.isLoading=!1}return this.loadPromise}async ensureLoaded(){if(!(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)){if(this.loadPromise){await this.loadPromise;return}await this.load()}}parseCSV(t){const e=bt(t,{columns:!0,skip_empty_lines:!0,trim:!0}),a=new We,y=new We;for(const g of e){const G=g.weebdex_id?.trim()||"",F=g.legacy_id?.trim()||"";G&&F&&(a.set(F,G),y.set(G,F))}return{legacyToWeebdex:a,weebdexToLegacy:y}}async getWeebdexIdFromLegacyId(t){return await this.ensureLoaded(),this.legacyToWeebdexMap===null?null:this.legacyToWeebdexMap.get(t)||null}}const Je=new Sa;var wa=_('<p class="uno-8520et"> </p>'),ya=_('<div class="uno-vsugad"><div class="uno-pj4440"></div> <p class="uno-hw2z5w"> </p> <!></div>'),Fa=_('<div class="uno-f2o4wl"><p class="uno-hw2z5w">Loading chapter dump and applying groups/titles...</p></div>'),Ea=_('<span class="uno-czmb1a">Removed</span>'),Ia=_('<div class="uno-2umhxz"></div>'),Na=_('<div class="uno-kp2ftc"></div>'),Za=_('<div><div class="uno-py2y93"><div class="uno-nxlaaf"><p class="uno-39vbxq"> </p> <!></div> <p class="uno-dsgwse"> </p></div> <button type="button"><!></button></div>'),Ca=_(`<div class="uno-bi16xf"><div class="uno-nnnwwl"><div class="uno-djaa0e"><p class="uno-apr5a0"> </p> <p class="uno-lp9tww">The following chapters already exist on WeebDex with matching groups. You can mark
								them as removed to skip uploading.</p></div> <button type="button" class="uno-3jkjwc" title="Mark all duplicate chapters as removed">Removed duplicate chapters</button></div> <div class="uno-56cpuz"></div></div>`),za=_('<div class="uno-hemz07"><div class="uno-ns83sq"><p class="uno-0zsd1s"> </p></div> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Series Selection (Required)</h3> <!> <!> <!></div> <!> <!> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Detected Chapters</h3> <div class="uno-xqlxhl"></div></div> <button type="button" class="uno-d93lfx"> </button></div>'),Da=_('<div class="uno-6nb6x4"><p class="uno-dillda">✓ Upload completed successfully!</p></div>'),Ta=_('<div><h2 class="uno-67n1yz"> </h2> <!></div>');function ka(b,t){_e(t,!0),St({useWebWorkers:!1});let e=pe(t,"class",3,"");const a=new wt;Ae(Ye,a);const y=Ke(Xe);if(!y)throw new Error("MangaProcessor must be used within a component that provides ApiAuthContext");let g=R("loading"),G=R(null),F=R(De([])),U=R(!1),E=R(!1),z=R(null),L=R(!1),Q=R(null),q=R(!1),j=R(De([]));const I=["jpg","jpeg","png","gif","webp","cbz","zip","xml"];he(()=>{t.zipFile&&(v(L,!1),v(Q,null),v(j,[],!0),D())});async function M(n){const p=n.name.split(".").pop()?.toLowerCase();if(!(p==="cbz")&&!(p==="zip"))throw new Error(`Unsupported archive format: ${p}`);console.log(`Extracting ${p} file:`,n.name),v(z,n.name,!0);const S=new Tt(new kt(n)),o=await S.getEntries(),c=[],w=n.name.replace(/\.(cbz|zip)$/i,""),A=n.webkitRelativePath||n.name;for(const H of o){if(!H.filename||H.directory)continue;const O=H.filename.split(".").pop()?.toLowerCase();if(!O||!I.includes(O))continue;const $=new TransformStream,ae=new Response($.readable).blob();await H.getData($.writable);let J=await ae;if(!J.type){const Se=B(O);J=new Blob([J],{type:Se})}const te=H.filename,ue=te.split("/").pop()??te,fe=A.includes("/")?`${A.split("/").slice(0,-1).join("/")}/${w}/${te}`:`${w}/${te}`,Ze=new File([J],ue,{type:J.type});Object.defineProperty(Ze,"webkitRelativePath",{value:fe,writable:!1,enumerable:!0,configurable:!0}),c.push(Ze)}return await S.close(),v(z,null),c}function B(n){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp"}[n]||"application/octet-stream"}async function D(){v(g,"loading"),a.reset();const n=da(t.zipFile.name);if(n)try{await Je.load();const u=await Je.getWeebdexIdFromLegacyId(n);u?(a.seriesId=u,console.log(`Auto-detected series ID from MD-####: ${n} -> ${u}`)):console.log(`No WeebDex ID found for MangaDex ID: ${n}`)}catch(u){console.warn(`Failed to lookup WeebDex ID for MangaDex ID ${n}:`,u)}v(g,"extracting");let p=[];try{p=await M(t.zipFile)}catch(u){console.error(`Error extracting ${t.zipFile.name}:`,u),t.guidedState.setZipStatus(t.zipFile,le.ERROR);return}v(G,yt(p),!0);const f=la(s(G));v(g,"extracting"),v(F,await Promise.all(f.map(async u=>{const S=ca(u.name),o=ua(u.name),c=u.files.filter(w=>w.type===Ft.CHAPTER_PAGE).map((w,A)=>new Et(w.file.name,A,w.file,It.NOT_STARTED,0,null,null,!1,w.type));return new Nt(u.path,u.name,S,o,new Be,new Zt,c,He.NOT_STARTED,0,null,null,u,!1,"en")})),!0),s(F).sort((u,S)=>{if(u.chapterVolume&&S.chapterVolume){const o=String(u.chapterVolume).localeCompare(String(S.chapterVolume),void 0,{numeric:!0,sensitivity:"base"});if(o!==0)return o}else{if(u.chapterVolume)return-1;if(S.chapterVolume)return 1}return u.chapterNumber&&S.chapterNumber?String(u.chapterNumber).localeCompare(String(S.chapterNumber),void 0,{numeric:!0,sensitivity:"base"}):u.chapterNumber?-1:S.chapterNumber?1:0}),a.chapterStates=s(F),v(g,"ready")}he(()=>{a.seriesId!==null&&a.chapterStates.forEach(n=>{n.associatedSeries||(n.associatedSeries=new Be),n.associatedSeries.seriesId=a.seriesId??""})}),he(()=>{a.seriesId&&s(g)==="ready"&&(!s(L)||a.seriesId!==s(Q))&&(v(L,!0),v(Q,a.seriesId,!0),v(g,"series_lookup"),P())});async function P(){if(a.seriesId)try{await Me.load();const n=await Me.getAllGroupNames(a.seriesId);if(n.length===0){console.warn("No groups found in chapter dump");return}const p=[];for(const f of n)try{const u=await Ct(f);if(u.data){const S=u.data.find(o=>o.name===f);if(S){const o=new zt;o.groupId=S.id,o.groupName=S.name,p.push(o)}}}catch(u){console.warn(`Failed to lookup group "${f}":`,u)}a.availableScanGroups=p,await m(),await T(),await Z(),v(g,"ready")}catch(n){console.error("Error loading chapter dump:",n),v(g,"ready")}}async function m(){for(const n of a.chapterStates){if(!n.originalFolderPath)continue;const p=a.availableScanGroups.filter(f=>n.originalFolderPath?.includes(f.groupName)??!1);if(p.length>0){const f=n.associatedGroup.groupIds??[],u=new Set(f);for(const S of p)u.has(S.groupId)||u.add(S.groupId);n.associatedGroup.groupIds=Array.from(u)}}}async function T(){if(!a.seriesId)return;const n=new Map;for(const p of a.availableScanGroups)n.set(p.groupId,p.groupName);for(const p of a.chapterStates){const f=p.associatedGroup.groupIds??[];if(f.length===0)continue;const u=f.map(c=>n.get(c)).filter(c=>c!==void 0);if(u.length===0)continue;const S=await Me.getChapterInfo(a.seriesId,p.chapterVolume,p.chapterNumber);if(!S)continue;u.some(c=>S.groupNames.includes(c))&&(p.chapterTitle=S.title)}}async function Z(){if(a.seriesId)try{const n=await Dt(a.seriesId),p=[],f=new Map;for(const o of n.chapters){const c=o.volume||"none",w=o.chapter,A=`${c}:${w}`;f.set(A,o)}const u=o=>{const c=new Set;if(n.groups)for(const w of o){const A=n.groups[w];A&&c.add(A.id)}return c},S=(o,c)=>{if(o.size!==c.size)return!1;for(const w of o)if(!c.has(w))return!1;return!0};for(const o of a.chapterStates){const c=o.chapterVolume||"none",w=o.chapterNumber;if(!w)continue;const A=`${c}:${w}`,H=f.get(A);if(H&&H.entries&&Object.keys(H.entries).length>0){const O=new Set(o.associatedGroup.groupIds??[]);if(O.size===0)continue;let $=null;for(const ae of Object.values(H.entries)){const J=u(ae.groups);if(S(O,J)){$=ae;break}}if($){const ae=u($.groups),J=[];for(const te of ae){const ue=n.groups?.find(fe=>fe.id===te);ue?J.push(`${ue.name} (${ue.id})`):J.push(`Unknown Group (${te})`)}p.push({chapter:o,existingGroups:J.length>0?J:["Unknown groups"]})}}}v(j,p,!0)}catch(n){console.error("Error checking for duplicates:",n),v(j,[],!0)}}function d(){s(q)||(v(q,!0),v(U,!1),v(g,"completed"),t.guidedState.setZipStatus(t.zipFile,le.COMPLETED),t.onProcessingComplete())}function x(){if(!y.apiToken){alert("Please set up API authentication first");return}if(!a.seriesId){alert("Please set a series ID first");return}if(a.chapterStates.length===0){alert("No chapters to upload");return}v(g,"uploading"),v(U,!0),v(q,!1),t.guidedState.setZipStatus(t.zipFile,le.PROCESSING)}const C=oe(()=>s(g)==="ready"||s(g)==="series_lookup"),W=oe(()=>s(F).filter(n=>!n.isDeleted));he(()=>{if(s(g)==="uploading"&&s(F).length>0){const n=s(F).every(f=>f.status===He.COMPLETED||f.isDeleted),p=s(F).some(f=>!f.isDeleted);n&&p&&!s(U)&&(t.guidedState.setZipStatus(t.zipFile,le.COMPLETED),d())}});var K=Ta(),ee=i(K),se=i(ee);r(ee);var Y=l(ee,2);{var X=n=>{var p=ya(),f=l(i(p),2),u=i(f,!0);r(f);var S=l(f,2);{var o=c=>{var w=wa(),A=i(w);r(w),V(()=>N(A,`Processing: ${s(z)??""}`)),h(c,w)};k(S,c=>{s(z)&&c(o)})}r(p),V(()=>N(u,s(g)==="loading"?"Loading manga folder...":"Extracting zip files...")),h(n,p)},re=n=>{var p=Ee(),f=me(p);{var u=o=>{var c=za(),w=i(c),A=i(w),H=i(A);r(A),r(w);var O=l(w,2),$=l(i(O),2);Gt($,{});var ae=l($,2);Pt(ae,{});var J=l(ae,2);Rt(J,{}),r(O);var te=l(O,2);{var ue=de=>{var ve=Fa();h(de,ve)};k(te,de=>{s(g)==="series_lookup"&&de(ue)})}var fe=l(te,2);{var Ze=de=>{var ve=Ca(),we=i(ve),Te=i(we),je=i(Te),et=i(je);r(je),pt(2),r(Te);var tt=l(Te,2);tt.__click=()=>{for(const{chapter:ke}of s(j))ke.isDeleted=!0},r(we);var Ve=l(we,2);Ie(Ve,21,()=>s(j),Ne,(ke,Ue)=>{let ne=()=>s(Ue).chapter,at=()=>s(Ue).existingGroups;var ze=Za(),Ge=i(ze),Pe=i(Ge),Re=i(Pe),st=i(Re);r(Re);var rt=l(Re,2);{var it=ie=>{var Fe=Ea();h(ie,Fe)};k(rt,ie=>{ne().isDeleted&&ie(it)})}r(Pe);var qe=l(Pe,2),nt=i(qe);r(qe),r(Ge);var ye=l(Ge,2);ye.__click=()=>{ne().isDeleted=!ne().isDeleted};var ot=i(ye);{var lt=ie=>{var Fe=Ia();h(ie,Fe)},ct=ie=>{var Fe=Na();h(ie,Fe)};k(ot,ie=>{ne().isDeleted?ie(lt):ie(ct,!1)})}r(ye),r(ze),V(ie=>{ce(ze,1,`uno-ecxsrr ${ne().isDeleted?"uno-1ya9ju":""}`),N(st,`Vol. ${ne().chapterVolume??"N/A"??""} Ch. ${ne().chapterNumber??"N/A"??""} - ${(ne().chapterTitle||ne().originalFolderPath||"Untitled")??""}`),N(nt,`Existing groups: ${ie??""}`),ce(ye,1,`uno-v1bdur ${ne().isDeleted?"uno-uigj71":"uno-8ta9ap"}`),Oe(ye,"title",ne().isDeleted?"Restore chapter":"Mark as removed")},[()=>at().join(", ")]),h(ke,ze)}),r(Ve),r(ve),V(()=>N(et,`⚠️ Warning: ${s(j).length??""} duplicate chapter${s(j).length===1?"":"s"} detected`)),h(de,ve)};k(fe,de=>{s(j).length>0&&de(Ze)})}var Se=l(fe,2),Le=l(i(Se),2);Ie(Le,21,()=>s(F),Ne,(de,ve,we)=>{ba(de,{index:we,get chapter(){return s(ve)}})}),r(Le),r(Se);var Ce=l(Se,2);Ce.__click=x;var Qe=i(Ce);r(Ce),r(c),V(()=>{N(H,`Found ${s(F).length??""} chapter${s(F).length===1?"":"s"} from deepest folders`),Ce.disabled=!s(C)||!a.seriesId||s(W).length===0,N(Qe,`Start Upload (${s(W).length??""} of ${s(F).length??""} chapters)`)}),h(o,c)},S=o=>{var c=Ee(),w=me(c);{var A=O=>{Mt(O,{onDone:d,get busy(){return s(E)},set busy($){v(E,$,!0)}})},H=O=>{var $=Ee(),ae=me($);{var J=te=>{var ue=Da();h(te,ue)};k(ae,te=>{s(g)==="completed"&&te(J)},!0)}h(O,$)};k(w,O=>{s(g)==="uploading"?O(A):O(H,!1)},!0)}h(o,c)};k(f,o=>{s(g)==="ready"||s(g)==="series_lookup"?o(u):o(S,!1)},!0)}h(n,p)};k(Y,n=>{s(g)==="loading"||s(g)==="extracting"?n(X):n(re,!1)})}r(K),V(()=>{ce(K,1,`uno-hemz07 ${e()??""}`),N(se,`Processing: ${t.zipFile.name??""}`)}),h(b,K),xe()}be(["click"]);var Ga=_('<div class="uno-j48514"><p class="uno-5v04yw">No zip file selected. Use the tabs above to select a zip file to process.</p></div>'),Pa=_('<div class="uno-eeu1av"><!> <!></div>'),Ra=_('<div class="uno-pb4e2u"><div class="uno-k0pcvl"><h1 class="uno-kryzyj">Guided Zip Manga Uploader</h1> <div class="uno-skt2gn"><button type="button" class="uno-q7l7gr">Simple Mode</button> <!></div></div> <a target="_blank" class="uno-6zhxse">Tutorial & Docs</a> <!> <!></div>');function $a(b,t){_e(t,!0);const e=new qt;Ae(Wt,e),Ae(Xe,new Lt);let a=R(null);function y(){e.workflowStep=ge.SELECTING_MANGA_FOLDERS}function g(){if(e.workflowStep=ge.PROCESSING_MANGA,e.selectedZipFiles.length>0){const m=e.selectedZipFiles[0],T=e.zipFiles.findIndex(Z=>Z.file===m);T>=0&&(e.currentZipIndex=T,v(a,m,!0))}}function G(m){v(a,m,!0),e.setZipStatus(m,le.PROCESSING)}function F(){if(e.moveToNextZip()){const m=e.currentZip;m&&(v(a,m.file,!0),e.setZipStatus(m.file,le.PROCESSING))}else v(a,null)}const U=oe(()=>e.workflowStep!==ge.PROCESSING_MANGA);var E=Ra(),z=i(E),L=l(i(z),2),Q=i(L);Q.__click=()=>Vt($e("/"));var q=l(Q,2);At(q,{}),r(L),r(z);var j=l(z,2),I=l(j,2);{var M=m=>{Ot(m,{})};k(I,m=>{s(U)&&m(M)})}var B=l(I,2);{var D=m=>{Jt(m,{get guidedState(){return e},onDone:y,class:"uno-zgouyr"})},P=m=>{var T=Ee(),Z=me(T);{var d=C=>{Qt(C,{get guidedState(){return e},onDone:g,class:"uno-l0uum8"})},x=C=>{var W=Ee(),K=me(W);{var ee=se=>{var Y=Pa(),X=i(Y);oa(X,{get guidedState(){return e},onZipSelected:G,class:"uno-wgeun8"});var re=l(X,2);{var n=f=>{ka(f,{get guidedState(){return e},get zipFile(){return s(a)},onProcessingComplete:F,class:"uno-wgeun8"})},p=f=>{var u=Ga();h(f,u)};k(re,f=>{s(a)?f(n):f(p,!1)})}r(Y),h(se,Y)};k(K,se=>{e.workflowStep===ge.PROCESSING_MANGA&&se(ee)},!0)}h(C,W)};k(Z,C=>{e.workflowStep===ge.SELECTING_MANGA_FOLDERS?C(d):C(x,!1)},!0)}h(m,T)};k(B,m=>{e.workflowStep===ge.SELECTING_ROOT_FOLDER?m(D):m(P,!1)})}r(E),V(m=>Oe(j,"href",m),[()=>$e("/docs")]),h(b,E),xe()}be(["click"]);export{$a as component,Ha as universal};
