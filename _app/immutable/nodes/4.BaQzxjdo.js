import{f,a as g,c as Xe}from"../chunks/CdXyPVf1.js";import{o as Rt}from"../chunks/Bm5TXEI0.js";import{z as Tt,A as F,B as e,C as l,D as Ze,E as it,I as s,K as o,J as t,G as O,H as nt,aH as Ae,aI as Zt,aJ as bt,u as We,F as Le,aC as _t,af as It}from"../chunks/CIcfCS9e.js";import{d as ot}from"../chunks/CMrQpYvR.js";import{p as ke,b as mt,i as A}from"../chunks/Bp05Fg2P.js";import{r as kt,a as Lt,s as Nt}from"../chunks/DVberjZs.js";import{s as E}from"../chunks/BR9ubxrB.js";import{S as Et,s as Fe,e as je,i as Ue,D as zt,c as Mt,g as Wt,a as jt,t as Gt,T as Ut,b as qt,d as Yt,C as pt,p as Vt,f as $t,h as Bt,j as Ht,k as Kt,l as Xt,m as Jt,n as Qt,o as yt,q as ea,r as xt,u as ta,v as aa,w as sa,Z as ra,B as ia,x as na,y as oa,z as la,U as ua,A as ca,E as da}from"../chunks/BOjRdvEi.js";import{b as Dt,A as pa}from"../chunks/LF6JFb3L.js";import{a as va,r as At}from"../chunks/D0yQdhp0.js";import{g as ga}from"../chunks/BxviQutx.js";const fa=!0,Hs=Object.freeze(Object.defineProperty({__proto__:null,prerender:fa},Symbol.toStringTag,{value:"Module"}));var rt=(x=>(x.SELECTING_ROOT_FOLDER="SELECTING_ROOT_FOLDER",x.SELECTING_MANGA_FOLDERS="SELECTING_MANGA_FOLDERS",x.PROCESSING_MANGA="PROCESSING_MANGA",x))(rt||{}),me=(x=>(x.PENDING="PENDING",x.PROCESSING="PROCESSING",x.COMPLETED="COMPLETED",x.ERROR="ERROR",x.WARNING="WARNING",x))(me||{}),I=(x=>(x.LOADING="LOADING",x.EXTRACTING="EXTRACTING",x.SERIES_LOOKUP="SERIES_LOOKUP",x.APPLYING_REGEX="APPLYING_REGEX",x.CHAPTER_LOOKUP="CHAPTER_LOOKUP",x.LOADING_GROUPS="LOADING_GROUPS",x.APPLYING_GROUPS="APPLYING_GROUPS",x.APPLYING_TITLES="APPLYING_TITLES",x.READY="READY",x.READY_WARNING="READY_WARNING",x.UPLOADING="UPLOADING",x.COMPLETED="COMPLETED",x))(I||{});class ha{#e=F(null);get rootFolderFiles(){return e(this.#e)}set rootFolderFiles(r){l(this.#e,r,!0)}#t=F(Ze([]));get zipFiles(){return e(this.#t)}set zipFiles(r){l(this.#t,r,!0)}#a=F(Ze([]));get selectedZipFiles(){return e(this.#a)}set selectedZipFiles(r){l(this.#a,r,!0)}#s=F(-1);get currentZipIndex(){return e(this.#s)}set currentZipIndex(r){l(this.#s,r,!0)}#r=F("SELECTING_ROOT_FOLDER");get workflowStep(){return e(this.#r)}set workflowStep(r){l(this.#r,r,!0)}get currentZip(){return this.currentZipIndex<0||this.currentZipIndex>=this.zipFiles.length?null:this.zipFiles[this.currentZipIndex]}get unprocessedZips(){return this.zipFiles.filter(r=>this.selectedZipFiles.includes(r.file)&&r.status!=="COMPLETED")}get pendingZips(){return this.zipFiles.filter(r=>this.selectedZipFiles.includes(r.file)&&r.status==="PENDING")}get warningZips(){return this.zipFiles.filter(r=>this.selectedZipFiles.includes(r.file)&&r.status==="WARNING")}get errorZips(){return this.zipFiles.filter(r=>this.selectedZipFiles.includes(r.file)&&r.status==="ERROR")}get completedZips(){return this.zipFiles.filter(r=>this.selectedZipFiles.includes(r.file)&&r.status==="COMPLETED")}get processingZips(){return this.zipFiles.filter(r=>this.selectedZipFiles.includes(r.file)&&r.status==="PROCESSING")}get nextZip(){const r=this.pendingZips;if(r.length===0)return null;const n=this.currentZip,a=n?r.filter(h=>h.file!==n.file):r;return a.length===0?null:a[0]}setZipStatus(r,n){const a=this.zipFiles.find(h=>h.file===r);a&&(a.status=n)}moveToNextZip(){const r=this.nextZip;if(!r)return!1;const n=this.zipFiles.findIndex(a=>a.file===r.file);return n>=0?(this.currentZipIndex=n,!0):!1}get zipFilesByMangaFolder(){const r=new Et;for(const n of this.zipFiles)r.has(n.mangaFolderName)||r.set(n.mangaFolderName,[]),r.get(n.mangaFolderName).push(n);return r}reset(){this.rootFolderFiles=null,this.zipFiles=[],this.selectedZipFiles=[],this.currentZipIndex=-1,this.workflowStep="SELECTING_ROOT_FOLDER"}}class ma{#e=F(!1);get enabled(){return e(this.#e)}set enabled(r){l(this.#e,r,!0)}get isActive(){return this.enabled}enable(){this.enabled=!0}disable(){this.enabled=!1}reset(){this.enabled=!1}}const _a=Tt(),St=Tt();var ba=f('<div class="uno-4maolu"><div class="uno-senp7v"></div> <p class="uno-l6h9uf">Scanning folder structure...</p></div>'),wa=f('<div class="uno-laclbo"><p class="uno-dl0t86"> </p></div>'),xa=f('<div class="uno-tm086o"><button><h1 class="uno-brv6u2">Select Root Folder</h1> <p class="uno-l6h9uf">Select the folder containing manga subfolders with .zip files</p> <input class="uno-qya2ty" type="file"/></button> <!> <!></div>');function Ia(x,r){it(r,!0);let n=ke(r,"guidedState",7),a=ke(r,"class",3,""),h=F(null),Z=F(!1);async function d(R){l(Z,!0);const z=R.target,U=Array.from(z.files??[]),W=[];for(const $ of U){const N=($.webkitRelativePath||$.name).split("/").filter(Boolean);if(N.length>=2){const S=N[0],ae=N[0],B=$.name.split(".").pop()?.toLowerCase();(B==="zip"||B==="cbz")&&W.push({file:$,mangaFolderName:S,mangaFolderPath:ae})}}n().rootFolderFiles=U,n().zipFiles=W.map($=>({...$,status:me.PENDING})),l(Z,!1),r.onDone()}function k(R){e(h)?.click()}var j=xa(),K=s(j);K.__click=k;var Y=o(s(K),4);Y.webkitdirectory=!0,Y.multiple=!0,Y.__change=d,mt(Y,R=>l(h,R),()=>e(h)),t(K);var V=o(K,2);{var te=R=>{var z=ba();g(R,z)};A(V,R=>{e(Z)&&R(te)})}var L=o(V,2);{var X=R=>{var z=wa(),U=s(z),W=s(U);t(U),t(z),O(()=>E(W,`Found ${n().zipFiles.length??""} zip file${n().zipFiles.length===1?"":"s"}`)),g(R,z)};A(L,R=>{n().zipFiles.length>0&&R(X)})}t(j),O(()=>{Fe(K,1,`uno-a4tqjo ${a()??""}`),K.disabled=e(Z)}),g(x,j),nt()}ot(["click","change"]);var Ea=f('<button type="button"><div class="uno-bpywdh"><p class="uno-98yf80"> </p> <p class="uno-42pivu"> </p></div> <input type="checkbox" class="uno-5onsv4"/></button>'),Na=f('<div class="uno-o40niy"><div class="uno-iuhcpm"><h3 class="uno-0lb4rh"> </h3> <button type="button" class="uno-phh4jd"> </button></div> <div class="uno-fb55wk"></div></div>'),Sa=f('<div><div class="uno-iuhcpm"><h2 class="uno-iyer7g">Select Zip Files to Process</h2> <button type="button" class="uno-f45w65"> </button></div> <p class="uno-ok9xip"> </p> <div class="uno-yjimjk"></div> <button type="button" class="uno-3s4o5e"> </button></div>');function ya(x,r){it(r,!0);let n=ke(r,"guidedState",7),a=ke(r,"class",3,"");function h(W){n().selectedZipFiles.indexOf(W)>=0?n().selectedZipFiles=n().selectedZipFiles.filter(ve=>ve!==W):n().selectedZipFiles=[...n().selectedZipFiles,W]}function Z(W){const $=Array.from(n().zipFilesByMangaFolder.get(W)??[]);if($.every(N=>n().selectedZipFiles.includes(N.file)))n().selectedZipFiles=n().selectedZipFiles.filter(N=>!$.some(S=>S.file===N));else{const N=$.map(S=>S.file).filter(S=>!n().selectedZipFiles.includes(S));n().selectedZipFiles=[...n().selectedZipFiles,...N]}}function d(){n().selectedZipFiles.length===n().zipFiles.length?n().selectedZipFiles=[]:n().selectedZipFiles=n().zipFiles.map(W=>W.file)}const k=Ae(()=>n().zipFiles.length>0&&n().selectedZipFiles.length===n().zipFiles.length),j=Ae(()=>n().zipFilesByMangaFolder);var K=Sa(),Y=s(K),V=o(s(Y),2);V.__click=d;var te=s(V,!0);t(V),t(Y);var L=o(Y,2),X=s(L);t(L);var R=o(L,2);je(R,21,()=>Array.from(e(j).entries()),Ue,(W,$)=>{var ve=Ae(()=>Zt(e($),2));let N=()=>e(ve)[0],S=()=>e(ve)[1];var ae=Na(),B=s(ae),fe=s(B),M=s(fe,!0);t(fe);var oe=o(fe,2);oe.__click=()=>Z(N());var ue=s(oe);t(oe),t(B);var J=o(B,2);je(J,21,S,Ue,(Ie,ce)=>{const _e=Ae(()=>n().selectedZipFiles.includes(e(ce).file));var be=Ea();be.__click=()=>h(e(ce).file);var se=s(be),H=s(se),de=s(H,!0);t(H);var ie=o(H,2),we=s(ie);t(ie),t(se);var ne=o(se,2);kt(ne),t(be),O(Q=>{Fe(be,1,`uno-ik4adi ${e(_e)?"uno-1k75dk":""}`),E(de,e(ce).file.name),E(we,`Size: ${Q??""} MB`),Lt(ne,e(_e))},[()=>(e(ce).file.size/(1024*1024)).toFixed(2)]),g(Ie,be)}),t(J),t(ae),O(Ie=>{E(M,N()),E(ue,`${Ie??""} (${S().length??""})`)},[()=>S().every(Ie=>n().selectedZipFiles.includes(Ie.file))?"Deselect All":"Select All"]),g(W,ae)}),t(R);var z=o(R,2);z.__click=function(...W){r.onDone?.apply(this,W)};var U=s(z);t(z),t(K),O(()=>{Fe(K,1,`uno-grwdkw ${a()??""}`),E(te,e(k)?"Deselect All":"Select All"),E(X,`${n().selectedZipFiles.length??""} of ${n().zipFiles.length??""} zip file${n().zipFiles.length===1?"":"s"} selected`),z.disabled=n().selectedZipFiles.length===0,E(U,`Continue to Processing (${n().selectedZipFiles.length??""} selected)`)}),g(x,K),nt()}ot(["click"]);var Aa=f('<p class="uno-a54tpo"> </p>'),Fa=f('<div class="uno-cqccui"><p class="uno-nsysfu"> </p> <span> </span></div> <!>',1),Ra=f('<p class="uno-b7m48p">No zip file selected</p>'),Ta=f('<button type="button" class="uno-qm31yq"> </button>'),Ga=f('<p class="uno-b7m48p">No more zip files to process</p>'),Da=f("<div><!></div>"),Pa=f('<p class="uno-b7m48p">All zip files have been completed</p>'),Ca=f('<button type="button" class="uno-4y4l6m"> </button>'),Oa=f('<div class="uno-2db0z0"><h3 class="uno-tniapq"> </h3> <div class="uno-ouywhe"></div></div>'),Za=f('<button type="button" class="uno-qy4bc0"> </button>'),ka=f('<div class="uno-2db0z0"><h3 class="uno-9iz2qs"> </h3> <div class="uno-ouywhe"></div></div>'),La=f('<div><div class="uno-0ia1w6 border-surface-hover"><h2 class="uno-1c2kr2">Zip Processing</h2> <div class="uno-cqccui"><span class="uno-d1zaof">Automation (experimental): <span> </span></span> <button type="button"> </button></div></div> <div class="uno-usvt4c"><div class="uno-cqccui"><span class="uno-4ezlml"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-1l1bmy"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-e545zy"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-mg1fk7"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-ip18dj"></span> <span class="uno-b7m48p"> </span></div></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Current Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Next Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Select Zip File</h3> <!></div> <!> <!></div>');function za(x,r){it(r,!0);let n=ke(r,"guidedState",7),a=ke(r,"class",3,"");const h=bt(St);if(!h)throw new Error("MangaProcessingTabs must be used within a component that provides AutomationState context");function Z(){if(n().moveToNextZip()){const c=n().currentZip;c&&r.onZipSelected(c.file)}}function d(c){const u=n().zipFiles.find(i=>i.file.name===c);if(u){const i=n().zipFiles.findIndex(p=>p.file===u.file);i>=0&&(n().currentZipIndex=i,r.onZipSelected(u.file))}}function k(){h.enabled?h.disable():h.enable()}const j=Ae(()=>n().currentZip?.file.name??null),K=Ae(()=>n().warningZips.map(c=>c.file.name)),Y=Ae(()=>n().errorZips.map(c=>c.file.name)),V=Ae(()=>n().unprocessedZips.map(c=>c.file.name)),te=Ae(()=>n().nextZip?.file.name??null),L=Ae(()=>n().pendingZips.length===0&&(n().warningZips.length>0||n().errorZips.length>0));We(()=>{e(L)&&h.isActive&&h.disable()});let X=F(null);We(()=>{l(X,n().currentZip?.file.name??null,!0)}),We(()=>{const c=e(X);if(c){const u=n().currentZip?.file.name??null;c!==u&&d(c)}});const R=Ae(()=>({pending:n().pendingZips.length,warning:n().warningZips.length,error:n().errorZips.length,completed:n().completedZips.length,processing:n().processingZips.length}));var z=La(),U=s(z),W=o(s(U),2),$=s(W),ve=o(s($)),N=s(ve,!0);t(ve),t($);var S=o($,2);S.__click=k;var ae=s(S,!0);t(S),t(W),t(U);var B=o(U,2),fe=s(B),M=o(s(fe),2),oe=s(M);t(M),t(fe);var ue=o(fe,2),J=o(s(ue),2),Ie=s(J);t(J),t(ue);var ce=o(ue,2),_e=o(s(ce),2),be=s(_e);t(_e),t(ce);var se=o(ce,2),H=o(s(se),2),de=s(H);t(H),t(se);var ie=o(se,2),we=o(s(ie),2),ne=s(we);t(we),t(ie),t(B);var Q=o(B,2),le=o(s(Q),2);{var he=c=>{var u=Fa(),i=Le(u),p=s(i),w=s(p,!0);t(p);var m=o(p,2),y=s(m,!0);t(m),t(i);var G=o(i,2);{var D=P=>{var re=Aa(),pe=s(re);t(re),O(()=>E(pe,`Manga Folder: ${n().currentZip.mangaFolderName??""}`)),g(P,re)};A(G,P=>{n().currentZip&&P(D)})}O(()=>{E(w,e(j)),Fe(m,1,`uno-ielryd ${n().currentZip?.status===me.PROCESSING?"uno-kxa2ln":n().currentZip?.status===me.COMPLETED?"uno-b1425w":n().currentZip?.status===me.ERROR?"uno-isu16c":n().currentZip?.status===me.WARNING?"uno-enplrj":"uno-jwlzg2"}`),E(y,n().currentZip?.status??"UNKNOWN")}),g(c,u)},Re=c=>{var u=Ra();g(c,u)};A(le,c=>{e(j)?c(he):c(Re,!1)})}t(Q);var Te=o(Q,2),Pe=o(s(Te),2);{var $e=c=>{var u=Ta();u.__click=Z;var i=s(u);t(u),O(()=>{u.disabled=h.enabled,E(i,`Process: ${e(te)??""}`)}),g(c,u)},vt=c=>{var u=Ga();g(c,u)};A(Pe,c=>{e(te)?c($e):c(vt,!1)})}t(Te);var Je=o(Te,2),Qe=o(s(Je),2);{var gt=c=>{var u=Da(),i=s(u);zt(i,{get items(){return e(V)},class:"uno-qbg2l1",get selectedItem(){return e(X)},set selectedItem(p){l(X,p,!0)}}),t(u),O(()=>Fe(u,1,Mt(h.enabled?"opacity-50 pointer-events-none":""))),g(c,u)},v=c=>{var u=Pa();g(c,u)};A(Qe,c=>{e(V).length>0?c(gt):c(v,!1)})}t(Je);var _=o(Je,2);{var b=c=>{var u=Oa(),i=s(u),p=s(i);t(i);var w=o(i,2);je(w,21,()=>e(K),Ue,(m,y)=>{var G=Ca();G.__click=()=>d(e(y));var D=s(G,!0);t(G),O(()=>{G.disabled=h.enabled,E(D,e(y))}),g(m,G)}),t(w),t(u),O(()=>E(p,`‚ö†Ô∏è Warning Zips (${e(K).length??""})`)),g(c,u)};A(_,c=>{e(K).length>0&&c(b)})}var C=o(_,2);{var T=c=>{var u=ka(),i=s(u),p=s(i);t(i);var w=o(i,2);je(w,21,()=>e(Y),Ue,(m,y)=>{var G=Za();G.__click=()=>d(e(y));var D=s(G,!0);t(G),O(()=>{G.disabled=h.enabled,E(D,e(y))}),g(m,G)}),t(w),t(u),O(()=>E(p,`‚ùå Error Zips (${e(Y).length??""})`)),g(c,u)};A(C,c=>{e(Y).length>0&&c(T)})}t(z),O(()=>{Fe(z,1,`uno-s0eao9 ${a()??""}`),Fe(ve,1,`uno-cvk0wv ${h.enabled?"uno-ikj4sb":"uno-je1lgh"}`),E(N,h.enabled?"ON":"OFF"),Fe(S,1,`uno-sv39f1 ${h.enabled?"uno-oxxvv6":"uno-dimr5c"}`),E(ae,h.enabled?"üîÑ Turn OFF":"‚ñ∂Ô∏è Turn ON"),E(oe,`Pending: ${e(R).pending??""}`),E(Ie,`Processing: ${e(R).processing??""}`),E(be,`Warning: ${e(R).warning??""}`),E(de,`Error: ${e(R).error??""}`),E(ne,`Completed: ${e(R).completed??""}`)}),g(x,z),nt()}ot(["click"]);function Ma(x){const r=Wt(x,0);return jt(x,r,0,[])}function Wa(x,r="v(\\d+)"){const n=new RegExp(r,"i"),a=x.match(n);return a&&a[1]?a[1].replace(/^0+/,"")||"0":null}function ja(x,r="c(\\d+(?:\\.\\d+){0,2})"){const n=new RegExp(r,"i"),a=x.match(n);if(a&&a[1]){const h=a[1];if(h.includes(".")){const Z=h.split(".");return[Z[0].replace(/^0+/,"")||"0",...Z.slice(1)].join(".")}else return h.replace(/^0+/,"")||"0"}return null}function Ua(x){const r=/MD-(\d+)/i,n=x.match(r);return n?n[1]:null}var qa=f('<span class="uno-lzl9l3 svelte-m4i47p">Removed</span>'),Ya=f('<button type="button" class="uno-lj049g svelte-m4i47p" title="Edit volume and chapter" aria-label="Edit volume and chapter"><div class="uno-smkhzc svelte-m4i47p"></div></button>'),Va=f('<div class="uno-7qt2lg svelte-m4i47p"><div class="uno-m5mbjf svelte-m4i47p"></div> <span class="svelte-m4i47p">Restore</span></div>'),$a=f('<div class="uno-7qt2lg svelte-m4i47p"><div class="uno-9z7ooq svelte-m4i47p"></div> <span class="svelte-m4i47p">Remove</span></div>'),Ba=f('<span class="uno-2et217 svelte-m4i47p"> </span>'),Ha=f('<div class="uno-v66o3i svelte-m4i47p"><span class="uno-bwkz4u svelte-m4i47p">‚ö†Ô∏è</span> <span class="uno-bwkz4u svelte-m4i47p"> </span></div>'),Ka=f('<div class="uno-58lieu svelte-m4i47p">Loading combinations...</div>'),Xa=f('<div class="uno-58lieu svelte-m4i47p">No volume/chapter combinations available</div>'),Ja=f('<button type="button"><div class="uno-l6o6ga svelte-m4i47p"><span class="svelte-m4i47p"> </span></div></button>'),Qa=f('<div class="uno-iqadiw svelte-m4i47p" role="presentation"><div class="uno-k7cjbm svelte-m4i47p"><!></div></div>'),es=f('<div><div class="uno-rzokcw svelte-m4i47p"><div class="uno-n4d6p5 svelte-m4i47p"><span class="uno-upv063 svelte-m4i47p"> </span> <!> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Vol:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Ch:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div> <!> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Pages:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div></div> <button type="button"><!></button></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Title:</span> <div class="uno-aqzn48 svelte-m4i47p"><!> <!></div></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Groups:</span> <!></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Path:</span> <span class="uno-nggqeg svelte-m4i47p"> </span></div> <!></div> <!>',1);function ts(x,r){if(it(r,!0),!bt(Gt))throw new Error("GuidedChapterEditor must be used within a component that provides TargetingState context");let a=ke(r,"chapter",7),h=ke(r,"class",3,""),Z=ke(r,"hasWarning",3,!1),d=ke(r,"warningText",3,null),k=F(!1),j=F(Ze([])),K=F(!1),Y=F(null),V=F(null),te=F(null),L=F(null);function X(){a().isDeleted=!a().isDeleted}async function R(){if(!e(k)){e(Y)&&l(L,e(Y).getBoundingClientRect(),!0),l(k,!0),l(K,!0);try{const i=a().associatedSeries?.seriesId;if(!i){console.warn("No series ID available for chapter"),l(k,!1);return}await pt.load(),l(j,await pt.getUniqueVolumeChapterCombinations(i),!0)}catch(i){console.error("Failed to load volume/chapter combinations:",i)}finally{l(K,!1)}}}function z(){l(k,!1),l(te,null),l(L,null)}function U(i,p){const w=p?.includes("[no group]")??!1;if(p&&!w){for(const y of Object.keys(i.groupTitles))if(p.includes(y)){const G=i.groupTitles[y];if(G&&G.trim()!=="")return G}}if(w&&i.ungroupedTitles.length>0||i.ungroupedTitles.length>0)return i.ungroupedTitles[0];const m=Object.keys(i.groupTitles);return m.length>0?i.groupTitles[m[0]]:null}function W(i){a().manuallyEditedFields.has("volume")||(a().originalFieldValues.has("volume")||a().originalFieldValues.set("volume",a().chapterVolume),a().manuallyEditedFields.add("volume")),a().manuallyEditedFields.has("chapter")||(a().originalFieldValues.has("chapter")||a().originalFieldValues.set("chapter",a().chapterNumber),a().manuallyEditedFields.add("chapter")),a().manuallyEditedFields.has("title")||(a().originalFieldValues.has("title")||a().originalFieldValues.set("title",a().chapterTitle),a().manuallyEditedFields.add("title")),a().chapterVolume=i.volume||null,a().chapterNumber=i.chapter||null,a().chapterTitle=U(i.info,a().originalFolderPath),z()}function $(i){const p=i.volume||"N/A",w=i.chapter||"N/A",m=U(i.info,a().originalFolderPath),y=m?` - ${m}`:"";return`Vol ${p}, Ch ${w}${y}`}function ve(){if(!e(L))return;const i=e(L),p=window.innerHeight,w=window.innerWidth,m=4,y=256;let G=y;if(e(V)){const lt=e(V).getBoundingClientRect().height;G=Math.min(lt,y)}const D=p-i.bottom-m,P=i.top-m,re=D<y&&P>D;let pe;re?(pe=i.top-G-m,pe<m&&(pe=m)):(pe=i.bottom+m,pe+G>p&&(pe=Math.max(m,p-G-m)));let ge=i.left;const xe=320,ze=Math.min(400,w-m*2),qe=Math.max(xe,Math.min(ze,i.width));ge+qe>w-m&&(ge=w-qe-m),ge<m&&(ge=m),l(te,{top:pe,left:ge,width:qe},!0)}We(()=>{if(e(k)){if(!e(L)){l(te,null);return}requestAnimationFrame(()=>{requestAnimationFrame(()=>{ve()})});const i=()=>ve(),p=m=>{const y=m.target;e(V)&&!e(V).contains(y)&&e(Y)&&!e(Y).contains(y)&&z()},w=setTimeout(()=>{window.addEventListener("resize",i),document.addEventListener("click",p,!0)},10);return()=>{clearTimeout(w),window.removeEventListener("resize",i),document.removeEventListener("click",p,!0)}}else l(te,null)}),We(()=>{e(k)&&e(V)&&requestAnimationFrame(()=>{ve()})});var N=es(),S=Le(N),ae=s(S),B=s(ae),fe=s(B),M=s(fe);t(fe);var oe=o(fe,2);{var ue=i=>{var p=qa();g(i,p)};A(oe,i=>{a().isDeleted&&i(ue)})}var J=o(oe,2),Ie=o(s(J),2),ce=s(Ie,!0);t(Ie),t(J);var _e=o(J,2),be=o(s(_e),2),se=s(be,!0);t(be),t(_e);var H=o(_e,2);{var de=i=>{var p=Ya();p.__click=w=>{w.stopPropagation(),R()},mt(p,w=>l(Y,w),()=>e(Y)),g(i,p)};A(H,i=>{a().associatedSeries?.seriesId&&i(de)})}var ie=o(H,2),we=o(s(ie),2),ne=s(we,!0);t(we),t(ie),t(B);var Q=o(B,2);Q.__click=X;var le=s(Q);{var he=i=>{var p=Va();g(i,p)},Re=i=>{var p=$a();g(i,p)};A(le,i=>{a().isDeleted?i(he):i(Re,!1)})}t(Q),t(ae);var Te=o(ae,2),Pe=o(s(Te),2),$e=s(Pe);Ut($e,{textClass:"text-sm text-app font-medium",fieldName:"title",get chapter(){return a()},get value(){return a().chapterTitle},set value(i){a().chapterTitle=i}});var vt=o($e,2);{var Je=i=>{var p=Ba(),w=s(p);t(p),O(()=>E(w,`(${(a().originalFolderPath||"Untitled")??""})`)),g(i,p)};A(vt,i=>{a().chapterTitle||i(Je)})}t(Pe),t(Te);var Qe=o(Te,2),gt=o(s(Qe),2);qt(gt,{fieldName:"groups",get chapter(){return a()},get groups(){return a().associatedGroup},set groups(i){a().associatedGroup=i}}),t(Qe);var v=o(Qe,2),_=o(s(v),2),b=s(_,!0);t(_),t(v);var C=o(v,2);{var T=i=>{var p=Ha(),w=o(s(p),2),m=s(w,!0);t(w),t(p),O(()=>E(m,d())),g(i,p)};A(C,i=>{Z()&&d()&&i(T)})}t(S);var c=o(S,2);{var u=i=>{var p=Qa();p.__click=D=>D.stopPropagation();var w=s(p),m=s(w);{var y=D=>{var P=Ka();g(D,P)},G=D=>{var P=Xe(),re=Le(P);{var pe=xe=>{var ze=Xa();g(xe,ze)},ge=xe=>{var ze=Xe(),qe=Le(ze);je(qe,17,()=>e(j),Ue,(lt,Ye)=>{var et=Ja();et.__click=()=>W(e(Ye));var Ee=s(et),Ne=s(Ee),Se=s(Ne,!0);t(Ne),t(Ee),t(et),O(Ge=>{Fe(et,1,`uno-ss9yjz ${a().chapterVolume===e(Ye).volume&&a().chapterNumber===e(Ye).chapter?"uno-eokg3r":""}`,"svelte-m4i47p"),E(Se,Ge)},[()=>$(e(Ye))]),g(lt,et)}),g(xe,ze)};A(re,xe=>{e(j).length===0?xe(pe):xe(ge,!1)},!0)}g(D,P)};A(m,D=>{e(K)?D(y):D(G,!1)})}t(w),t(p),mt(p,D=>l(V,D),()=>e(V)),O(()=>Yt(p,`top: ${e(te).top??""}px; left: ${e(te).left??""}px; width: ${e(te).width??""}px;`)),g(i,p)};A(c,i=>{e(k)&&e(te)&&i(u)})}O(()=>{Fe(S,1,`uno-3rf4hu ${a().isDeleted?"uno-d3zfvr":Z()?"uno-ctlglj":""} ${h()??""}`,"svelte-m4i47p"),E(M,`#${r.index+1}`),E(ce,a().chapterVolume??"N/A"),E(se,a().chapterNumber??"N/A"),E(ne,a().pages.length),Fe(Q,1,`uno-lto8ne ${a().isDeleted?"uno-ld06wt":"uno-far8pd"}`,"svelte-m4i47p"),Nt(Q,"title",a().isDeleted?"Restore chapter":"Mark as removed"),E(b,a().originalFolderPath)}),g(x,N),nt()}ot(["click"]);class as{#e=F(null);get legacyToWeebdexMap(){return e(this.#e)}set legacyToWeebdexMap(r){l(this.#e,r,!0)}#t=F(null);get weebdexToLegacyMap(){return e(this.#t)}set weebdexToLegacyMap(r){l(this.#t,r,!0)}#a=F(!1);get isLoading(){return e(this.#a)}set isLoading(r){l(this.#a,r,!0)}#s=F(null);get loadError(){return e(this.#s)}set loadError(r){l(this.#s,r,!0)}loadPromise=null;async load(){if(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)return;if(this.loadPromise)return this.loadPromise;this.isLoading=!0,this.loadError=null;let r,n;this.loadPromise=new Promise((a,h)=>{r=a,n=h});try{const a=va("/weebdex_lookup.csv"),h=await fetch(a);if(!h.ok)throw new Error(`Failed to fetch CSV: ${h.status} ${h.statusText}`);const Z=await h.text(),{legacyToWeebdex:d,weebdexToLegacy:k}=this.parseCSV(Z);this.legacyToWeebdexMap=d,this.weebdexToLegacyMap=k,r()}catch(a){this.loadError=a instanceof Error?a:new Error("Unknown error loading CSV"),n(this.loadError)}finally{this.isLoading=!1}return this.loadPromise}async ensureLoaded(){if(!(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)){if(this.loadPromise){await this.loadPromise;return}await this.load()}}parseCSV(r){const n=Vt(r,{columns:!0,skip_empty_lines:!0,trim:!0}),a=new Et,h=new Et;for(const Z of n){const d=Z.weebdex_id?.trim()||"",k=Z.legacy_id?.trim()||"";d&&k&&(a.set(k,d),h.set(d,k))}return{legacyToWeebdex:a,weebdexToLegacy:h}}async getWeebdexIdFromLegacyId(r){return await this.ensureLoaded(),this.legacyToWeebdexMap===null?null:this.legacyToWeebdexMap.get(r)||null}}const Ft=new as;var ss=f('<p class="uno-8520et"> </p>'),rs=f('<div class="uno-vsugad"><div class="uno-pj4440"></div> <p class="uno-hw2z5w"> </p> <!></div>'),is=f(`<p class="uno-stwt3u">‚ö†Ô∏è Waiting for series ID - Automation will skip this zip. Please select a series
							above.</p>`),ns=f('<p class="uno-stwt3u">‚ö†Ô∏è Ready with warnings - Automation will skip this zip. You can still upload manually.</p>'),os=f("<p> </p>"),ls=f("<p>‚Ä¢ Chapter dump lookup failed</p>"),us=f("<p> </p>"),cs=f("<p> </p>"),ds=f("<p> </p>"),ps=f('<div class="uno-hqujre"><!> <div class="uno-4ixn7j"><!> <!> <!> <!> <!></div></div>'),vs=f('<div class="uno-ecxsrr"><div class="uno-py2y93"><div class="uno-nxlaaf"><p class="uno-39vbxq"> </p></div> <p class="uno-dsgwse">Matched group: <span class="uno-wnothw"> </span> </p></div></div>'),gs=f(`<div class="uno-bi16xf"><div class="uno-djaa0e"><p class="uno-apr5a0"> </p> <p class="uno-lp9tww">The following chapters matched only 1 group from the source, but the release has
							multiple groups. All groups for the release have been assigned automatically.</p></div> <div class="uno-56cpuz"></div></div>`),fs=f('<span class="uno-czmb1a">Removed</span>'),hs=f('<div class="uno-2umhxz"></div>'),ms=f('<div class="uno-kp2ftc"></div>'),_s=f('<div><div class="uno-py2y93"><div class="uno-nxlaaf"><p class="uno-39vbxq"> </p> <!></div> <p class="uno-dsgwse"> </p></div> <button type="button"><!></button></div>'),bs=f(`<div class="uno-bi16xf"><div class="uno-nnnwwl"><div class="uno-djaa0e"><p class="uno-apr5a0"> </p> <p class="uno-lp9tww">The following chapters already exist on WeebDex with matching groups. You can mark
								them as removed to skip uploading.</p></div> <button type="button" class="uno-3jkjwc" title="Mark all duplicate chapters as removed">Removed duplicate chapters</button></div> <div class="uno-56cpuz"></div></div>`),ws=f('<div class="uno-hemz07"><div class="uno-ns83sq"><p class="uno-0zsd1s"> </p></div> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Series Selection (Required)</h3> <!> <!> <!></div> <!> <!> <!> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Detected Chapters</h3> <div class="uno-xqlxhl"></div></div> <button type="button" class="uno-d93lfx"> </button></div>'),xs=f('<div class="uno-6nb6x4"><p class="uno-dillda">‚úì Upload completed successfully!</p></div>'),Is=f('<div><h2 class="uno-67n1yz"> </h2> <!></div>');function Es(x,r){it(r,!0),$t({useWebWorkers:!1});let n=ke(r,"class",3,"");const a=new Bt;_t(Gt,a);const h=bt(Dt);if(!h)throw new Error("MangaProcessor must be used within a component that provides ApiAuthContext");const Z=bt(St);let d=F(Ze(I.LOADING)),k=F(null),j=F(Ze([])),K=F(!1),Y=F(null),V=F(null),te=F(null),L=F(Ze([])),X=F(!1),R=F(Ze([])),z=F(0),U=F(Ze([])),W=F(Ze([])),$=F(null);const ve=["jpg","jpeg","png","gif","webp","cbz","zip","xml"];We(()=>{r.zipFile&&(l(te,null),l(L,[],!0),l(X,!1),l(R,[],!0),l(z,0),l(U,[],!0),l(W,[],!0),l($,null),N())});async function N(){try{if(await B(),await fe(),!a.seriesId){l(d,I.READY_WARNING,!0);return}l(d,I.APPLYING_REGEX,!0),await M(),await oe(),await ue(),await J(),await be(),H()?l(d,I.READY_WARNING,!0):l(d,I.READY,!0)}catch(v){console.error("Error in processing pipeline:",v),l($,v instanceof Error?v.message:"Processing failed",!0),r.guidedState.setZipStatus(r.zipFile,me.ERROR),l(d,I.READY_WARNING,!0),r.onProcessingComplete("error")}}async function S(v){const _=v.name.split(".").pop()?.toLowerCase();if(!(_==="cbz")&&!(_==="zip"))throw new Error(`Unsupported archive format: ${_}`);console.log(`Extracting ${_} file:`,v.name),l(Y,v.name,!0);const T=new ra(new ia(v)),c=await T.getEntries(),u=[],i=v.name.replace(/\.(cbz|zip)$/i,""),p=v.webkitRelativePath||v.name;for(const w of c){if(!w.filename||w.directory)continue;const m=w.filename.split(".").pop()?.toLowerCase();if(!m||!ve.includes(m))continue;const y=new TransformStream,G=new Response(y.readable).blob();await w.getData(y.writable);let D=await G;if(!D.type){const xe=ae(m);D=new Blob([D],{type:xe})}const P=w.filename,re=P.split("/").pop()??P,pe=p.includes("/")?`${p.split("/").slice(0,-1).join("/")}/${i}/${P}`:`${i}/${P}`,ge=new File([D],re,{type:D.type});Object.defineProperty(ge,"webkitRelativePath",{value:pe,writable:!1,enumerable:!0,configurable:!0}),u.push(ge)}return await T.close(),l(Y,null),u}function ae(v){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp"}[v]||"application/octet-stream"}async function B(){l(d,I.LOADING,!0),a.reset(),l(d,I.EXTRACTING,!0);let v=[];try{v=await S(r.zipFile)}catch(b){throw console.error(`Error extracting ${r.zipFile.name}:`,b),l($,b instanceof Error?b.message:"Failed to extract archive",!0),b}l(k,Ht(v),!0);const _=Ma(e(k));l(j,await Promise.all(_.map(async b=>{const C=Wa(b.name),T=ja(b.name),c=b.files.filter(u=>u.type===Kt.CHAPTER_PAGE).map((u,i)=>new Xt(u.file.name,i,u.file,Jt.NOT_STARTED,0,null,null,!1,u.type));return new Qt(b.path,b.name,C,T,new yt,new ea,c,xt.NOT_STARTED,0,null,null,b,!1,"en")})),!0),e(j).sort((b,C)=>{if(b.chapterVolume&&C.chapterVolume){const T=String(b.chapterVolume).localeCompare(String(C.chapterVolume),void 0,{numeric:!0,sensitivity:"base"});if(T!==0)return T}else{if(b.chapterVolume)return-1;if(C.chapterVolume)return 1}return b.chapterNumber&&C.chapterNumber?String(b.chapterNumber).localeCompare(String(C.chapterNumber),void 0,{numeric:!0,sensitivity:"base"}):b.chapterNumber?-1:C.chapterNumber?1:0}),a.chapterStates=e(j)}async function fe(){l(d,I.SERIES_LOOKUP,!0);const v=Ua(r.zipFile.name);if(v)try{await Ft.load();const _=await Ft.getWeebdexIdFromLegacyId(v);_?(a.seriesId=_,console.log(`Auto-detected series ID from MD-####: ${v} -> ${_}`)):console.log(`No WeebDex ID found for MangaDex ID: ${v}`)}catch(_){console.warn(`Failed to lookup WeebDex ID for MangaDex ID ${v}:`,_)}a.seriesId&&a.chapterStates.forEach(_=>{_.associatedSeries||(_.associatedSeries=new yt),_.associatedSeries.seriesId=a.seriesId??""})}async function M(){l(d,I.CHAPTER_LOOKUP,!0),a.seriesId&&await pt.load()}async function oe(){if(l(d,I.LOADING_GROUPS,!0),!a.seriesId)return;if(!await pt.hasSeriesEntries(a.seriesId)){console.warn("No entries found in chapter dump for this series"),l(X,!0);return}const _=await pt.getAllGroupNames(a.seriesId);if(_.length===0){console.log("No groups found in chapter dump, but series has entries (likely all ungrouped)"),a.availableScanGroups=[];return}const b=[],C=[];for(const T of _)try{const c=await ta(T);if(c.data){const u=c.data.find(i=>i.name===T);if(u){const i=new aa;i.groupId=u.id,i.groupName=u.name,b.push(i)}else C.push(T)}else C.push(T)}catch(c){console.warn(`Failed to lookup group "${T}":`,c),C.push(T)}l(R,C,!0),C.length>0&&l(X,!0),a.availableScanGroups=b}async function ue(){l(d,I.APPLYING_GROUPS,!0),await ce()}async function J(){if(l(d,I.APPLYING_TITLES,!0),!a.seriesId)return;const v=await _e();l(z,v,!0),v>0&&l(X,!0)}We(()=>{a.seriesId&&(e(d)===I.READY||e(d)===I.READY_WARNING)&&a.seriesId!==e(te)&&(l(te,a.seriesId,!0),Ie())});async function Ie(){try{if(await fe(),!a.seriesId)return;l(d,I.APPLYING_REGEX,!0),await M(),await oe(),await ue(),await J(),await be(),H()?l(d,I.READY_WARNING,!0):l(d,I.READY,!0)}catch(v){console.error("Error in processing pipeline:",v),l(d,I.READY_WARNING,!0)}}async function ce(){for(const v of a.chapterStates){if(!v.originalFolderPath)continue;const _=a.availableScanGroups.filter(b=>v.originalFolderPath?.includes(b.groupName)??!1);if(_.length>0){const b=v.associatedGroup.groupIds??[],C=new Set(b);for(const T of _)C.has(T.groupId)||C.add(T.groupId);v.associatedGroup.groupIds=Array.from(C)}}}async function _e(){if(!a.seriesId)return 0;const v=new Map,_=new Map;for(const c of a.availableScanGroups)v.set(c.groupId,c.groupName),_.set(c.groupName,c.groupId);let b=0;const C=[],T=[];for(let c=0;c<a.chapterStates.length;c++){const u=a.chapterStates[c],i=u.originalFolderPath?.includes("[no group]")??!1,p=u.associatedGroup.groupIds??[];if(p.length===0&&!i){b++,T.push({chapterIndex:c,warningText:"Failed to resolve chapter title: No groups assigned"});continue}const w=p.map(P=>v.get(P)).filter(P=>P!==void 0);if(w.length===0&&!i){b++,T.push({chapterIndex:c,warningText:"Failed to resolve chapter title: No valid groups found"});continue}const m=await pt.getChapterInfo(a.seriesId,u.chapterVolume,u.chapterNumber);if(!m){b++,T.push({chapterIndex:c,warningText:"Failed to resolve chapter title: Chapter info not found"});continue}let y=null,G=!1,D=null;for(const P of w)if(P in m.groupTitles){y=m.groupTitles[P],G=!0,D=P,console.log(`found group name match for group: ${P} with title: ${y??"null"}`);break}if(!G&&i&&m.ungroupedTitles.length>0&&(y=m.ungroupedTitles[0],G=!0,console.log(`found ungrouped title match for chapter: ${u.originalFolderPath} with title: ${y}`)),G){if(u.chapterTitle=y,D){const P=Object.keys(m.groupTitles);if(P.length>1){const re=P.map(ge=>_.get(ge)).filter(ge=>ge!==void 0),pe=new Set(u.associatedGroup.groupIds??[]);for(const ge of re)pe.add(ge);u.associatedGroup.groupIds=Array.from(pe),C.push({chapter:u,matchedGroup:D,allGroups:P}),T.push({chapterIndex:c,warningText:`Partial group match: matched ${D}, assigned all groups: ${P.join(", ")}`}),console.log(`Partial group match: matched ${D}, assigned all groups: ${P.join(", ")}`)}}}else b++,T.push({chapterIndex:c,warningText:"Failed to resolve chapter title: No matching group or ungrouped title found"})}return l(U,C,!0),l(W,[...e(W),...T],!0),b}async function be(){if(a.seriesId)try{const v=await sa(a.seriesId),_=[],b=new Map;for(const u of v.chapters){const i=u.volume||"none",p=u.chapter,w=`${i}:${p}`;b.set(w,u)}const C=u=>{if(!v.groups)return!1;for(const i of u){const p=v.groups[i];if(p&&p.name==="No Group"&&!p.id)return!0}return!1},T=u=>{const i=new Set;if(v.groups)for(const p of u){const w=v.groups[p];w&&w.id&&i.add(w.id)}return i},c=(u,i,p)=>{if(u.size===0)return p&&i.size===0;if(p||u.size!==i.size)return!1;for(const w of u)if(!i.has(w))return!1;return!0};for(const u of a.chapterStates){const i=u.chapterVolume||"none",p=u.chapterNumber;if(!p)continue;const w=`${i}:${p}`,m=b.get(w);if(m&&m.entries&&Object.keys(m.entries).length>0){const y=new Set(u.associatedGroup.groupIds??[]);let G=null;for(const D of Object.values(m.entries)){const P=T(D.groups),re=C(D.groups);if(c(y,P,re)){G=D;break}}if(G){const D=T(G.groups),P=C(G.groups),re=[];P&&re.push("No Group");for(const ge of D){const xe=v.groups?.find(ze=>ze.id===ge);xe?re.push(`${xe.name} (${xe.id})`):re.push(`Unknown Group (${ge})`)}const pe=a.chapterStates.indexOf(u);pe!==-1&&e(W).push({chapterIndex:pe,warningText:`Duplicate chapter: Already exists with groups: ${re.length>0?re.join(", "):"Unknown groups"}`}),_.push({chapter:u,existingGroups:re.length>0?re:["Unknown groups"]})}}}l(L,_,!0)}catch(v){console.error("Error checking for duplicates:",v),l(L,[],!0)}}function se(v){if(e(d)!==I.UPLOADING)return;l(d,I.COMPLETED,!0);const _=v?"success":"error";r.guidedState.setZipStatus(r.zipFile,v?me.COMPLETED:me.ERROR),v&&a.seriesId?r.onProcessingComplete(_,a.seriesId):r.onProcessingComplete(_)}function H(){return e(W).length>0||e(L).length>0||e(X)||e(R).length>0||e(z)>0||e(U).length>0}function de(v){return e(W).some(_=>_.chapterIndex===v)}function ie(v){const _=e(W).find(b=>b.chapterIndex===v);return _?_.warningText:null}function we(){return{hasDuplicates:e(L).length>0,duplicateCount:e(L).length,dumpLookupFailed:e(X),failedGroups:e(R).length,failedTitles:e(z),partialGroupMatches:e(U).length}}function ne(){return e(d)===I.READY&&(e(te)===a.seriesId||!a.seriesId)}We(()=>{if(!Z?.isActive)return;const _=e(d),b=a.seriesId,C=e(te),T=_===I.READY||_===I.READY_WARNING;if(!T)return;console.log("Automation: Effect triggered, checking state",{step:_,seriesId:b,lastSeriesId:C,shouldCheck:T});const c=setTimeout(()=>{Q()},500);return()=>clearTimeout(c)});async function Q(){if(!Z?.isActive){console.log("Automation: Not active");return}if(e(d)===I.READY_WARNING){console.log("Automation: READY_WARNING state detected, marking as warning and skipping"),r.guidedState.setZipStatus(r.zipFile,me.WARNING),r.onProcessingComplete("warning");return}if(!ne()){console.log("Automation: Not ready",{step:e(d),seriesId:a.seriesId,lastProcessedSeriesId:e(te)});return}console.log("Automation: Checking zip file",r.zipFile.name);const v=r.guidedState.pendingZips,_=r.guidedState.warningZips.length>0||r.guidedState.errorZips.length>0;if(v.length===0&&_){console.log("Automation: Disabling - only warnings/errors remain"),Z.disable();return}console.log("Automation: No issues, starting upload",{canStartUpload:e(he),hasSeriesId:!!a.seriesId,nonDeletedChapters:e(Re).length}),e(he)&&a.seriesId&&e(Re).length>0?le()?console.log("Automation: Upload started successfully"):(console.warn("Automation: Failed to start upload, marking as error"),r.guidedState.setZipStatus(r.zipFile,me.ERROR),r.onProcessingComplete("error")):(console.warn("Automation: Missing requirements for upload",{canStartUpload:e(he),hasSeriesId:!!a.seriesId,nonDeletedChapters:e(Re).length}),r.guidedState.setZipStatus(r.zipFile,me.WARNING),r.onProcessingComplete("warning"))}function le(){return h.apiToken?a.seriesId?a.chapterStates.length===0?(alert("No chapters to upload"),!1):!e(he)||e(Re).length===0?!1:(l(d,I.UPLOADING,!0),r.guidedState.setZipStatus(r.zipFile,me.PROCESSING),!0):(alert("Please set a series ID first"),!1):(alert("Please set up API authentication first"),!1)}We(()=>{if(e(d)===I.UPLOADING&&Z?.isActive&&e(V)){const v=setTimeout(()=>{console.log("Automation: Triggering upload via UploaderOrchestrator"),e(V)?.startUpload()},200);return()=>clearTimeout(v)}});const he=Ae(()=>e(d)===I.READY||e(d)===I.READY_WARNING),Re=Ae(()=>e(j).filter(v=>!v.isDeleted));We(()=>{if(e(d)===I.UPLOADING&&e(j).length>0){const v=e(j).every(b=>b.status===xt.COMPLETED||b.isDeleted),_=e(j).some(b=>!b.isDeleted);if(v&&_){const C=!e(j).some(T=>!T.isDeleted&&T.status===xt.FAILED);r.guidedState.setZipStatus(r.zipFile,C?me.COMPLETED:me.ERROR),se(C)}}});var Te={hasIssues:H,chapterHasWarning:de,getChapterWarningText:ie,getIssueDetails:we,isReady:ne,startUpload:le},Pe=Is(),$e=s(Pe),vt=s($e);t($e);var Je=o($e,2);{var Qe=v=>{var _=rs(),b=o(s(_),2),C=s(b,!0);t(b);var T=o(b,2);{var c=u=>{var i=ss(),p=s(i);t(i),O(()=>E(p,`Processing: ${e(Y)??""}`)),g(u,i)};A(T,u=>{e(Y)&&u(c)})}t(_),O(()=>E(C,e(d)===I.LOADING?"Loading manga folder...":e(d)===I.EXTRACTING?"Extracting zip files...":e(d)===I.SERIES_LOOKUP?"Looking up series ID...":e(d)===I.APPLYING_REGEX?"Applying regex patterns...":e(d)===I.CHAPTER_LOOKUP?"Loading chapter dump...":e(d)===I.LOADING_GROUPS?"Loading groups...":e(d)===I.APPLYING_GROUPS?"Applying groups to chapters...":"Applying titles to chapters...")),g(v,_)},gt=v=>{var _=Xe(),b=Le(_);{var C=c=>{var u=ws(),i=s(u),p=s(i),w=s(p);t(p),t(i);var m=o(i,2),y=o(s(m),2);na(y,{});var G=o(y,2);oa(G,{});var D=o(G,2);la(D,{}),t(m);var P=o(m,2);{var re=Ee=>{var Ne=ps(),Se=s(Ne);{var Ge=q=>{var ee=is();g(q,ee)},Be=q=>{var ee=ns();g(q,ee)};A(Se,q=>{a.seriesId?q(Be,!1):q(Ge)})}var tt=o(Se,2),ut=s(tt);{var He=q=>{var ee=os(),Oe=s(ee);t(ee),O(()=>E(Oe,`‚Ä¢ ${e(L).length??""} duplicate chapter${e(L).length===1?"":"s"} detected`)),g(q,ee)};A(ut,q=>{e(L).length>0&&q(He)})}var Ce=o(ut,2);{var ct=q=>{var ee=ls();g(q,ee)};A(Ce,q=>{e(X)&&e(R).length===0&&e(z)===0&&q(ct)})}var ye=o(Ce,2);{var at=q=>{var ee=us(),Oe=s(ee);t(ee),O(dt=>E(Oe,`‚Ä¢ ${e(R).length??""} group${e(R).length===1?"":"s"} failed to lookup: ${dt??""}`),[()=>e(R).join(", ")]),g(q,ee)};A(ye,q=>{e(R).length>0&&q(at)})}var Me=o(ye,2);{var Ve=q=>{var ee=cs(),Oe=s(ee);t(ee),O(()=>E(Oe,`‚Ä¢ ${e(z)??""} chapter title${e(z)===1?"":"s"} failed
								to resolve`)),g(q,ee)};A(Me,q=>{e(z)>0&&q(Ve)})}var Ke=o(Me,2);{var st=q=>{var ee=ds(),Oe=s(ee);t(ee),O(()=>E(Oe,`‚Ä¢ ${e(U).length??""} chapter${e(U).length===1?"":"s"} with
								partial group match (matched 1 group, assigned all groups for release)`)),g(q,ee)};A(Ke,q=>{e(U).length>0&&q(st)})}t(tt),t(Ne),g(Ee,Ne)};A(P,Ee=>{e(d)===I.READY_WARNING&&Ee(re)})}var pe=o(P,2);{var ge=Ee=>{var Ne=gs(),Se=s(Ne),Ge=s(Se),Be=s(Ge);t(Ge),It(2),t(Se);var tt=o(Se,2);je(tt,21,()=>e(U),Ue,(ut,He)=>{let Ce=()=>e(He).chapter,ct=()=>e(He).matchedGroup,ye=()=>e(He).allGroups;var at=vs(),Me=s(at),Ve=s(Me),Ke=s(Ve),st=s(Ke);t(Ke),t(Ve);var q=o(Ve,2),ee=o(s(q)),Oe=s(ee,!0);t(ee);var dt=o(ee);t(q),t(Me),t(at),O(wt=>{E(st,`Vol. ${Ce().chapterVolume??"N/A"??""} Ch. ${Ce().chapterNumber??"N/A"??""} - ${(Ce().chapterTitle||Ce().originalFolderPath||"Untitled")??""}`),E(Oe,ct()),E(dt,` | Assigned all
										groups: ${wt??""}`)},[()=>ye().join(", ")]),g(ut,at)}),t(tt),t(Ne),O(()=>E(Be,`‚ö†Ô∏è Warning: ${e(U).length??""} chapter${e(U).length===1?"":"s"} with partial group match`)),g(Ee,Ne)};A(pe,Ee=>{e(U).length>0&&Ee(ge)})}var xe=o(pe,2);{var ze=Ee=>{var Ne=bs(),Se=s(Ne),Ge=s(Se),Be=s(Ge),tt=s(Be);t(Be),It(2),t(Ge);var ut=o(Ge,2);ut.__click=()=>{for(const{chapter:Ce}of e(L))Ce.isDeleted=!0},t(Se);var He=o(Se,2);je(He,21,()=>e(L),Ue,(Ce,ct)=>{let ye=()=>e(ct).chapter,at=()=>e(ct).existingGroups;var Me=_s(),Ve=s(Me),Ke=s(Ve),st=s(Ke),q=s(st);t(st);var ee=o(st,2);{var Oe=De=>{var ht=fs();g(De,ht)};A(ee,De=>{ye().isDeleted&&De(Oe)})}t(Ke);var dt=o(Ke,2),wt=s(dt);t(dt),t(Ve);var ft=o(Ve,2);ft.__click=()=>{ye().isDeleted=!ye().isDeleted};var Pt=s(ft);{var Ct=De=>{var ht=hs();g(De,ht)},Ot=De=>{var ht=ms();g(De,ht)};A(Pt,De=>{ye().isDeleted?De(Ct):De(Ot,!1)})}t(ft),t(Me),O(De=>{Fe(Me,1,`uno-ecxsrr ${ye().isDeleted?"uno-1ya9ju":""}`),E(q,`Vol. ${ye().chapterVolume??"N/A"??""} Ch. ${ye().chapterNumber??"N/A"??""} - ${(ye().chapterTitle||ye().originalFolderPath||"Untitled")??""}`),E(wt,`Existing groups: ${De??""}`),Fe(ft,1,`uno-v1bdur ${ye().isDeleted?"uno-uigj71":"uno-8ta9ap"}`),Nt(ft,"title",ye().isDeleted?"Restore chapter":"Mark as removed")},[()=>at().join(", ")]),g(Ce,Me)}),t(He),t(Ne),O(()=>E(tt,`‚ö†Ô∏è Warning: ${e(L).length??""} duplicate chapter${e(L).length===1?"":"s"} detected`)),g(Ee,Ne)};A(xe,Ee=>{e(L).length>0&&Ee(ze)})}var qe=o(xe,2),lt=o(s(qe),2);je(lt,21,()=>e(j),Ue,(Ee,Ne,Se)=>{{let Ge=Ae(()=>de(Se)),Be=Ae(()=>ie(Se));ts(Ee,{index:Se,get chapter(){return e(Ne)},get hasWarning(){return e(Ge)},get warningText(){return e(Be)}})}}),t(lt),t(qe);var Ye=o(qe,2);Ye.__click=le;var et=s(Ye);t(Ye),t(u),O(()=>{E(w,`Found ${e(j).length??""} chapter${e(j).length===1?"":"s"} from deepest folders`),Ye.disabled=!e(he)||!a.seriesId||e(Re).length===0,E(et,`Start Upload (${e(Re).length??""} of ${e(j).length??""} chapters)`)}),g(c,u)},T=c=>{var u=Xe(),i=Le(u);{var p=m=>{mt(ua(m,{onDone:se,get busy(){return e(K)},set busy(y){l(K,y,!0)}}),y=>l(V,y,!0),()=>e(V))},w=m=>{var y=Xe(),G=Le(y);{var D=P=>{var re=xs();g(P,re)};A(G,P=>{e(d)===I.COMPLETED&&P(D)},!0)}g(m,y)};A(i,m=>{e(d)===I.UPLOADING?m(p):m(w,!1)},!0)}g(c,u)};A(b,c=>{e(d)===I.READY||e(d)===I.READY_WARNING?c(C):c(T,!1)},!0)}g(v,_)};A(Je,v=>{e(d)===I.LOADING||e(d)===I.EXTRACTING||e(d)===I.SERIES_LOOKUP||e(d)===I.APPLYING_REGEX||e(d)===I.CHAPTER_LOOKUP||e(d)===I.LOADING_GROUPS||e(d)===I.APPLYING_GROUPS||e(d)===I.APPLYING_TITLES?v(Qe):v(gt,!1)})}return t(Pe),O(()=>{Fe(Pe,1,`uno-hemz07 ${n()??""}`),E(vt,`Processing: ${r.zipFile.name??""}`)}),g(x,Pe),nt(Te)}ot(["click"]);var Ns=f('<span class="uno-eibvyk"></span>'),Ss=f('<span class="uno-wwd276"></span>'),ys=f("<option> </option>"),As=f('<div class="uno-4n7jiu"><label for="session-selector" class="uno-q52u3c">Select Session:</label> <select class="uno-ggu5iv"><option>-- Select a session --</option><!></select></div>'),Fs=f('<div class="uno-18xidu"> </div>'),Rs=f('<div class="uno-4n7jiu"><div class="uno-y8jeae"><p class="uno-q52u3c"> </p> <button type="button" class="uno-m5t56d" title="Copy all IDs to clipboard">Copy IDs</button></div> <div class="uno-ky3e2b"><div class="uno-twa61r"></div></div></div>'),Ts=f('<p class="uno-q4g9cd">Please select a session to view IDs</p>'),Gs=f('<p class="uno-q4g9cd">No completed IDs found</p>'),Ds=f('<div class="uno-pnwugo"><label for="view-mode" class="uno-q4g9cd">View Mode:</label> <button type="button">Per Session</button> <button type="button">All Combined</button></div> <!> <!> <div class="uno-w2kq3w"><button type="button" class="uno-m5t56d">Refresh</button> <button type="button" class="uno-ecwkht">Clear All</button></div>',1),Ps=f('<div class="uno-5pp2az"><button type="button" class="uno-vyqybb"><span class="uno-hus6d6"><!></span> <h3 class="uno-mg3nnt">Completed WeebDex IDs</h3></button> <!></div>');function Cs(x,r){it(r,!0);const n="completedWeebdexIds";let a=F("per-session"),h=F(null),Z=F(!1),d=F(Ze([])),k=F(Ze([]));function j(){if(!(typeof window>"u"))try{const N=JSON.parse(localStorage.getItem(n)||"{}");l(d,Object.entries(N).map(([ae,B])=>({timestamp:ae,ids:[...B]})).sort((ae,B)=>B.timestamp.localeCompare(ae.timestamp)),!0);const S=new Set;for(const ae of e(d))for(const B of ae.ids)S.add(B);l(k,Array.from(S).sort(),!0)}catch(N){console.error("Failed to load completed IDs from localStorage:",N),l(d,[],!0),l(k,[],!0)}}function K(N){try{return new Date(N).toLocaleString()}catch{return N}}function Y(N){typeof navigator>"u"||!navigator.clipboard||navigator.clipboard.writeText(N).catch(S=>{console.error("Failed to copy to clipboard:",S)})}function V(){return e(a)==="all-combined"?e(k):e(h)?e(d).find(S=>S.timestamp===e(h))?.ids||[]:[]}function te(){if(e(a)==="all-combined")return`All Combined IDs (${e(k).length} unique)`;if(e(h)){const N=e(d).find(S=>S.timestamp===e(h));return N?`${K(e(h))} (${N.ids.length} IDs)`:"No session selected"}return"Select a session"}Rt(()=>{j()});var L=Ps(),X=s(L);X.__click=()=>{l(Z,!e(Z))};var R=s(X),z=s(R);{var U=N=>{var S=Ns();g(N,S)},W=N=>{var S=Ss();g(N,S)};A(z,N=>{e(Z)?N(U):N(W,!1)})}t(R),It(2),t(X);var $=o(X,2);{var ve=N=>{var S=Ds(),ae=Le(S),B=o(s(ae),2);B.__click=()=>{l(a,"per-session"),l(h,null)};var fe=o(B,2);fe.__click=()=>{l(a,"all-combined"),l(h,null)},t(ae);var M=o(ae,2);{var oe=se=>{var H=As(),de=o(s(H),2);de.__change=ne=>{l(h,ne.target.value||null,!0)};var ie=s(de);ie.value=ie.__value="";var we=o(ie);je(we,17,()=>e(d),Ue,(ne,Q)=>{var le=ys(),he=s(le);t(le);var Re={};O(Te=>{E(he,`${Te??""} (${e(Q).ids.length??""} IDs)`),Re!==(Re=e(Q).timestamp)&&(le.value=(le.__value=e(Q).timestamp)??"")},[()=>K(e(Q).timestamp)]),g(ne,le)}),t(de),t(H),g(se,H)};A(M,se=>{e(a)==="per-session"&&se(oe)})}var ue=o(M,2);{var J=se=>{var H=Rs(),de=s(H),ie=s(de),we=s(ie,!0);t(ie);var ne=o(ie,2);ne.__click=()=>Y(V().join(`
`)),t(de);var Q=o(de,2),le=s(Q);je(le,21,V,Ue,(he,Re)=>{var Te=Fs(),Pe=s(Te,!0);t(Te),O(()=>E(Pe,e(Re))),g(he,Te)}),t(le),t(Q),t(H),O(he=>E(we,he),[te]),g(se,H)},Ie=se=>{var H=Xe(),de=Le(H);{var ie=ne=>{var Q=Ts();g(ne,Q)},we=ne=>{var Q=Gs();g(ne,Q)};A(de,ne=>{e(a)==="per-session"&&!e(h)?ne(ie):ne(we,!1)},!0)}g(se,H)};A(ue,se=>{(e(a)==="all-combined"||e(h))&&V().length>0?se(J):se(Ie,!1)})}var ce=o(ue,2),_e=s(ce);_e.__click=j;var be=o(_e,2);be.__click=()=>{confirm("Are you sure you want to clear all completed IDs from localStorage? This cannot be undone.")&&(localStorage.removeItem(n),j())},t(ce),O(()=>{Fe(B,1,`uno-r9todb ${e(a)==="per-session"?"uno-qv685z":"uno-7i144e"}`),Fe(fe,1,`uno-r9todb ${e(a)==="all-combined"?"uno-qv685z":"uno-7i144e"}`)}),g(N,S)};A($,N=>{e(Z)&&N(ve)})}t(L),g(x,L),nt()}ot(["click","change"]);var Os=f('<div class="uno-j48514"><p class="uno-5v04yw">No zip file selected. Use the tabs above to select a zip file to process.</p></div>'),Zs=f('<div class="uno-eeu1av"><!> <!></div>'),ks=f('<div class="uno-pb4e2u"><div class="uno-k0pcvl"><h1 class="uno-kryzyj">Guided Zip Manga Uploader</h1> <div class="uno-skt2gn"><button type="button" class="uno-q7l7gr">Simple Mode</button> <!></div></div> <a target="_blank" class="uno-6zhxse">Tutorial & Docs</a> <!> <!> <!></div>');function Ks(x,r){it(r,!0);const n=new ha,a=new ma;_t(_a,n),_t(St,a),_t(Dt,new pa);let h=F(null),Z=F(null);const d="completedWeebdexIds";let k=F(null);Rt(()=>{l(k,new Date().toISOString(),!0)});function j(){n.workflowStep=rt.SELECTING_MANGA_FOLDERS}function K(){if(n.workflowStep=rt.PROCESSING_MANGA,n.selectedZipFiles.length>0){const M=n.selectedZipFiles[0],oe=n.zipFiles.findIndex(ue=>ue.file===M);oe>=0&&(n.currentZipIndex=oe,l(h,M,!0))}}function Y(M){l(h,M,!0)}function V(M,oe){const ue=n.currentZip;if(ue)if(M==="success"){if(n.setZipStatus(ue.file,me.COMPLETED),oe&&e(k))try{const J=JSON.parse(localStorage.getItem(d)||"{}");J[e(k)]||(J[e(k)]=[]),J[e(k)].includes(oe)||(J[e(k)].push(oe),localStorage.setItem(d,JSON.stringify(J)))}catch(J){console.error("Failed to save weebdex ID to localStorage:",J)}}else M==="warning"?n.setZipStatus(ue.file,me.WARNING):M==="error"&&n.setZipStatus(ue.file,me.ERROR);if(n.moveToNextZip()){const J=n.currentZip;J&&l(h,J.file,!0)}else l(h,null)}function te(){e(Z)&&e(Z).startUpload()}const L=Ae(()=>n.workflowStep!==rt.PROCESSING_MANGA);var X=ks(),R=s(X),z=o(s(R),2),U=s(z);U.__click=()=>ga(At("/"));var W=o(U,2);ca(W,{}),t(z),t(R);var $=o(R,2),ve=o($,2);{var N=M=>{da(M,{})};A(ve,M=>{e(L)&&M(N)})}var S=o(ve,2);Cs(S,{});var ae=o(S,2);{var B=M=>{Ia(M,{get guidedState(){return n},onDone:j,class:"uno-zgouyr"})},fe=M=>{var oe=Xe(),ue=Le(oe);{var J=ce=>{ya(ce,{get guidedState(){return n},onDone:K,class:"uno-l0uum8"})},Ie=ce=>{var _e=Xe(),be=Le(_e);{var se=H=>{var de=Zs(),ie=s(de);za(ie,{get guidedState(){return n},onZipSelected:Y,onAutomationRequestUpload:te,get mangaProcessorRef(){return e(Z)},class:"uno-wgeun8"});var we=o(ie,2);{var ne=le=>{mt(Es(le,{get guidedState(){return n},get zipFile(){return e(h)},onProcessingComplete:V,class:"uno-wgeun8"}),he=>l(Z,he,!0),()=>e(Z))},Q=le=>{var he=Os();g(le,he)};A(we,le=>{e(h)?le(ne):le(Q,!1)})}t(de),g(H,de)};A(be,H=>{n.workflowStep===rt.PROCESSING_MANGA&&H(se)},!0)}g(ce,_e)};A(ue,ce=>{n.workflowStep===rt.SELECTING_MANGA_FOLDERS?ce(J):ce(Ie,!1)},!0)}g(M,oe)};A(ae,M=>{n.workflowStep===rt.SELECTING_ROOT_FOLDER?M(B):M(fe,!1)})}t(X),O(M=>Nt($,"href",M),[()=>At("/docs")]),g(x,X),nt()}ot(["click"]);export{Ks as component,Hs as universal};
