import{f as _,a as v,c as we}from"../chunks/CTHEc7mS.js";import{z as ot,A as M,B as t,C as g,D as Ge,E as he,I as r,K as o,J as a,G as U,H as me,aH as ne,aI as lt,u as fe,F as ge,aJ as He,aC as Oe,af as ct}from"../chunks/DpPdw_ub.js";import{p as pe,b as ut,i as G}from"../chunks/DxCQtHkc.js";import{s as N}from"../chunks/CI280J2U.js";import{d as Ee}from"../chunks/D_Kb6Vk8.js";import{s as ce,e as ye,i as Ne,D as pt,g as dt,a as vt,t as We,T as ft,c as gt,b as ht,d as mt,C as _t,f as St,h as xt,j as bt,k as Ve,l as Ft,m as Be,n as Ae,o as wt,S as yt,p as Nt,Z as Et,B as Zt,q as Ct,r as It,u as zt,U as Gt,v as Dt,w as kt}from"../chunks/DOAgZ4iK.js";import{r as Rt,a as Pt,s as Je}from"../chunks/DofntP01.js";import{b as Ke,A as Tt}from"../chunks/Cjq1WBUe.js";const At=!0,Aa=Object.freeze(Object.defineProperty({__proto__:null,prerender:At},Symbol.toStringTag,{value:"Module"}));var ve=(b=>(b.SELECTING_ROOT_FOLDER="SELECTING_ROOT_FOLDER",b.SELECTING_MANGA_FOLDERS="SELECTING_MANGA_FOLDERS",b.PROCESSING_MANGA="PROCESSING_MANGA",b))(ve||{}),oe=(b=>(b.PENDING="PENDING",b.PROCESSING="PROCESSING",b.COMPLETED="COMPLETED",b.ERROR="ERROR",b))(oe||{});class Ot{#e=M(null);get rootFolderFiles(){return t(this.#e)}set rootFolderFiles(s){g(this.#e,s,!0)}#t=M(Ge([]));get zipFiles(){return t(this.#t)}set zipFiles(s){g(this.#t,s,!0)}#a=M(Ge([]));get selectedZipFiles(){return t(this.#a)}set selectedZipFiles(s){g(this.#a,s,!0)}#s=M(-1);get currentZipIndex(){return t(this.#s)}set currentZipIndex(s){g(this.#s,s,!0)}#i=M("SELECTING_ROOT_FOLDER");get workflowStep(){return t(this.#i)}set workflowStep(s){g(this.#i,s,!0)}get currentZip(){return this.currentZipIndex<0||this.currentZipIndex>=this.zipFiles.length?null:this.zipFiles[this.currentZipIndex]}get unprocessedZips(){return this.zipFiles.filter(s=>this.selectedZipFiles.includes(s.file)&&s.status==="PENDING")}get nextZip(){const s=this.unprocessedZips;return s.length===0?null:s[0]}setZipStatus(s,e){const i=this.zipFiles.find(R=>R.file===s);i&&(i.status=e)}moveToNextZip(){const s=this.nextZip;if(!s)return!1;const e=this.zipFiles.findIndex(i=>i.file===s.file);return e>=0?(this.currentZipIndex=e,!0):!1}get zipFilesByMangaFolder(){const s=new Map;for(const e of this.zipFiles)s.has(e.mangaFolderName)||s.set(e.mangaFolderName,[]),s.get(e.mangaFolderName).push(e);return s}reset(){this.rootFolderFiles=null,this.zipFiles=[],this.selectedZipFiles=[],this.currentZipIndex=-1,this.workflowStep="SELECTING_ROOT_FOLDER"}}const Mt=ot();var Lt=_('<div class="uno-4maolu"><div class="uno-senp7v"></div> <p class="uno-l6h9uf">Scanning folder structure...</p></div>'),jt=_('<div class="uno-laclbo"><p class="uno-dl0t86"> </p></div>'),Ut=_('<div class="uno-tm086o"><button><h1 class="uno-brv6u2">Select Root Folder</h1> <p class="uno-l6h9uf">Select the folder containing manga subfolders with .zip files</p> <input class="uno-qya2ty" type="file"/></button> <!> <!></div>');function qt(b,s){he(s,!0);let e=pe(s,"guidedState",7),i=pe(s,"class",3,""),R=M(null),h=M(!1);async function q(E){g(h,!0);const k=E.target,m=Array.from(k.files??[]),F=[];for(const Z of m){const P=(Z.webkitRelativePath||Z.name).split("/").filter(Boolean);if(P.length>=2){const w=P[0],p=P[0],S=Z.name.split(".").pop()?.toLowerCase();(S==="zip"||S==="cbz")&&F.push({file:Z,mangaFolderName:w,mangaFolderPath:p})}}e().rootFolderFiles=m,e().zipFiles=F.map(Z=>({...Z,status:oe.PENDING})),g(h,!1),s.onDone()}function I(E){t(R)?.click()}var L=Ut(),y=r(L);y.__click=I;var z=o(r(y),4);z.webkitdirectory=!0,z.multiple=!0,z.__change=q,ut(z,E=>g(R,E),()=>t(R)),a(y);var A=o(y,2);{var Q=E=>{var k=Lt();v(E,k)};G(A,E=>{t(h)&&E(Q)})}var V=o(A,2);{var O=E=>{var k=jt(),m=r(k),F=r(m);a(m),a(k),U(()=>N(F,`Found ${e().zipFiles.length??""} zip file${e().zipFiles.length===1?"":"s"}`)),v(E,k)};G(V,E=>{e().zipFiles.length>0&&E(O)})}a(L),U(()=>{ce(y,1,`uno-a4tqjo ${i()??""}`),y.disabled=t(h)}),v(b,L),me()}Ee(["click","change"]);var Vt=_('<button type="button"><div class="uno-bpywdh"><p class="uno-98yf80"> </p> <p class="uno-42pivu"> </p></div> <input type="checkbox" class="uno-5onsv4"/></button>'),Bt=_('<div class="uno-o40niy"><div class="uno-iuhcpm"><h3 class="uno-0lb4rh"> </h3> <button type="button" class="uno-phh4jd"> </button></div> <div class="uno-fb55wk"></div></div>'),Ht=_('<div><div class="uno-iuhcpm"><h2 class="uno-iyer7g">Select Zip Files to Process</h2> <button type="button" class="uno-f45w65"> </button></div> <p class="uno-ok9xip"> </p> <div class="uno-yjimjk"></div> <button type="button" class="uno-3s4o5e"> </button></div>');function Wt(b,s){he(s,!0);let e=pe(s,"guidedState",7),i=pe(s,"class",3,"");function R(F){e().selectedZipFiles.indexOf(F)>=0?e().selectedZipFiles=e().selectedZipFiles.filter(K=>K!==F):e().selectedZipFiles=[...e().selectedZipFiles,F]}function h(F){const Z=Array.from(e().zipFilesByMangaFolder.get(F)??[]);if(Z.every(P=>e().selectedZipFiles.includes(P.file)))e().selectedZipFiles=e().selectedZipFiles.filter(P=>!Z.some(w=>w.file===P));else{const P=Z.map(w=>w.file).filter(w=>!e().selectedZipFiles.includes(w));e().selectedZipFiles=[...e().selectedZipFiles,...P]}}function q(){e().selectedZipFiles.length===e().zipFiles.length?e().selectedZipFiles=[]:e().selectedZipFiles=e().zipFiles.map(F=>F.file)}const I=ne(()=>e().zipFiles.length>0&&e().selectedZipFiles.length===e().zipFiles.length),L=ne(()=>e().zipFilesByMangaFolder);var y=Ht(),z=r(y),A=o(r(z),2);A.__click=q;var Q=r(A,!0);a(A),a(z);var V=o(z,2),O=r(V);a(V);var E=o(V,2);ye(E,21,()=>Array.from(t(L).entries()),Ne,(F,Z)=>{var K=ne(()=>lt(t(Z),2));let P=()=>t(K)[0],w=()=>t(K)[1];var p=Bt(),S=r(p),T=r(S),j=r(T,!0);a(T);var B=o(T,2);B.__click=()=>h(P());var X=r(B);a(B),a(S);var le=o(S,2);ye(le,21,w,Ne,(ee,$)=>{const H=ne(()=>e().selectedZipFiles.includes(t($).file));var n=Vt();n.__click=()=>R(t($).file);var d=r(n),c=r(d),f=r(c,!0);a(c);var x=o(c,2),l=r(x);a(x),a(d);var u=o(d,2);Rt(u),a(n),U(C=>{ce(n,1,`uno-ik4adi ${t(H)?"uno-1k75dk":""}`),N(f,t($).file.name),N(l,`Size: ${C??""} MB`),Pt(u,t(H))},[()=>(t($).file.size/(1024*1024)).toFixed(2)]),v(ee,n)}),a(le),a(p),U(ee=>{N(j,P()),N(X,`${ee??""} (${w().length??""})`)},[()=>w().every(ee=>e().selectedZipFiles.includes(ee.file))?"Deselect All":"Select All"]),v(F,p)}),a(E);var k=o(E,2);k.__click=function(...F){s.onDone?.apply(this,F)};var m=r(k);a(k),a(y),U(()=>{ce(y,1,`uno-grwdkw ${i()??""}`),N(Q,t(I)?"Deselect All":"Select All"),N(O,`${e().selectedZipFiles.length??""} of ${e().zipFiles.length??""} zip file${e().zipFiles.length===1?"":"s"} selected`),k.disabled=e().selectedZipFiles.length===0,N(m,`Continue to Processing (${e().selectedZipFiles.length??""} selected)`)}),v(b,y),me()}Ee(["click"]);var Jt=_('<p class="uno-a54tpo"> </p>'),Kt=_('<div class="uno-cqccui"><p class="uno-nsysfu"> </p> <span> </span></div> <!>',1),Xt=_('<p class="uno-b7m48p">No zip file selected</p>'),Yt=_('<button type="button" class="uno-qm31yq"> </button>'),Qt=_('<p class="uno-b7m48p">No more zip files to process</p>'),$t=_('<p class="uno-b7m48p">All zip files have been processed</p>'),ea=_('<div><div class="uno-2db0z0"><h3 class="uno-py45hl">Current Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Next Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Unprocessed Zip Files</h3> <!></div></div>');function ta(b,s){he(s,!0);let e=pe(s,"guidedState",7),i=pe(s,"class",3,"");function R(){if(e().moveToNextZip()){const p=e().currentZip;p&&s.onZipSelected(p.file)}}function h(p){const S=e().zipFiles.find(T=>T.file.name===p);if(S){const T=e().zipFiles.findIndex(j=>j.file===S.file);T>=0&&(e().currentZipIndex=T,s.onZipSelected(S.file))}}const q=ne(()=>e().currentZip?.file.name??null),I=ne(()=>e().unprocessedZips.map(p=>p.file.name)),L=ne(()=>e().nextZip?.file.name??null);let y=M(null);fe(()=>{g(y,e().currentZip?.file.name??null,!0)}),fe(()=>{const p=t(y);if(p){const S=e().currentZip?.file.name??null;p!==S&&h(p)}});var z=ea(),A=r(z),Q=o(r(A),2);{var V=p=>{var S=Kt(),T=ge(S),j=r(T),B=r(j,!0);a(j);var X=o(j,2),le=r(X,!0);a(X),a(T);var ee=o(T,2);{var $=H=>{var n=Jt(),d=r(n);a(n),U(()=>N(d,`Manga Folder: ${e().currentZip.mangaFolderName??""}`)),v(H,n)};G(ee,H=>{e().currentZip&&H($)})}U(()=>{N(B,t(q)),ce(X,1,`uno-ielryd ${e().currentZip?.status===oe.PROCESSING?"uno-kxa2ln":e().currentZip?.status===oe.COMPLETED?"uno-b1425w":e().currentZip?.status===oe.ERROR?"uno-isu16c":"uno-jwlzg2"}`),N(le,e().currentZip?.status??"UNKNOWN")}),v(p,S)},O=p=>{var S=Xt();v(p,S)};G(Q,p=>{t(q)?p(V):p(O,!1)})}a(A);var E=o(A,2),k=o(r(E),2);{var m=p=>{var S=Yt();S.__click=R;var T=r(S);a(S),U(()=>N(T,`Process: ${t(L)??""}`)),v(p,S)},F=p=>{var S=Qt();v(p,S)};G(k,p=>{t(L)?p(m):p(F,!1)})}a(E);var Z=o(E,2),K=o(r(Z),2);{var P=p=>{pt(p,{get items(){return t(I)},class:"uno-qbg2l1",get selectedItem(){return t(y)},set selectedItem(S){g(y,S,!0)}})},w=p=>{var S=$t();v(p,S)};G(K,p=>{t(I).length>0?p(P):p(w,!1)})}a(Z),a(z),U(()=>ce(z,1,`uno-s0eao9 ${i()??""}`)),v(b,z),me()}Ee(["click"]);function aa(b){const s=dt(b,0);return vt(b,s,0,[])}function sa(b,s="v(\\d+)"){const e=new RegExp(s,"i"),i=b.match(e);return i&&i[1]?i[1].replace(/^0+/,"")||"0":null}function ia(b,s="c(\\d+(?:\\.\\d+){0,2})"){const e=new RegExp(s,"i"),i=b.match(e);if(i&&i[1]){const R=i[1];if(R.includes(".")){const h=R.split(".");return[h[0].replace(/^0+/,"")||"0",...h.slice(1)].join(".")}else return R.replace(/^0+/,"")||"0"}return null}var ra=_('<span class="uno-lzl9l3">Removed</span>'),na=_('<div class="uno-7qt2lg"><div class="uno-m5mbjf"></div> <span>Restore</span></div>'),oa=_('<div class="uno-7qt2lg"><div class="uno-9z7ooq"></div> <span>Remove</span></div>'),la=_('<span class="uno-2et217"> </span>'),ca=_('<span class="uno-38wzts"> </span>'),ua=_('<div class="uno-zh7qvs"></div>'),pa=_('<span class="uno-2et217">No groups assigned</span>'),da=_('<div><div class="uno-rzokcw"><div class="uno-n4d6p5"><span class="uno-upv063"> </span> <!> <div class="uno-0yx623"><span class="uno-7f6l2t">Vol:</span> <span class="uno-4g5bui"> </span></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Ch:</span> <span class="uno-4g5bui"> </span></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Pages:</span> <span class="uno-4g5bui"> </span></div></div> <button type="button"><!></button></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Title:</span> <div class="uno-aqzn48"><!> <!></div></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Groups:</span> <!></div> <div class="uno-0yx623"><span class="uno-7f6l2t">Path:</span> <span class="uno-nggqeg"> </span></div></div>');function va(b,s){he(s,!0);const e=He(We);if(!e)throw new Error("GuidedChapterEditor must be used within a component that provides TargetingState context");let i=pe(s,"chapter",7),R=pe(s,"class",3,"");function h(){i().isDeleted=!i().isDeleted}var q=da(),I=r(q),L=r(I),y=r(L),z=r(y);a(y);var A=o(y,2);{var Q=l=>{var u=ra();v(l,u)};G(A,l=>{i().isDeleted&&l(Q)})}var V=o(A,2),O=o(r(V),2),E=r(O,!0);a(O),a(V);var k=o(V,2),m=o(r(k),2),F=r(m,!0);a(m),a(k);var Z=o(k,2),K=o(r(Z),2),P=r(K,!0);a(K),a(Z),a(L);var w=o(L,2);w.__click=h;var p=r(w);{var S=l=>{var u=na();v(l,u)},T=l=>{var u=oa();v(l,u)};G(p,l=>{i().isDeleted?l(S):l(T,!1)})}a(w),a(I);var j=o(I,2),B=o(r(j),2),X=r(B);ft(X,{textClass:"text-sm text-app font-medium",fieldName:"title",get chapter(){return i()},get value(){return i().chapterTitle},set value(l){i().chapterTitle=l}});var le=o(X,2);{var ee=l=>{var u=la(),C=r(u);a(u),U(()=>N(C,`(${(i().originalFolderPath||"Untitled")??""})`)),v(l,u)};G(le,l=>{i().chapterTitle||l(ee)})}a(B),a(j);var $=o(j,2),H=o(r($),2);{var n=l=>{var u=ua();ye(u,21,()=>i().associatedGroup.groupIds,Ne,(C,Y)=>{const te=ne(()=>e.availableScanGroups.find(W=>W.groupId===t(Y)));var D=ca(),ae=r(D,!0);a(D),U(()=>N(ae,t(te)?.groupName??t(Y))),v(C,D)}),a(u),v(l,u)},d=l=>{var u=pa();v(l,u)};G(H,l=>{i().associatedGroup.groupIds&&i().associatedGroup.groupIds.length>0?l(n):l(d,!1)})}a($);var c=o($,2),f=o(r(c),2),x=r(f,!0);a(f),a(c),a(q),U(()=>{ce(q,1,`uno-3rf4hu ${i().isDeleted?"uno-d3zfvr":""} ${R()??""}`),N(z,`#${s.index+1}`),N(E,i().chapterVolume??"N/A"),N(F,i().chapterNumber??"N/A"),N(P,i().pages.length),ce(w,1,`uno-lto8ne ${i().isDeleted?"uno-ld06wt":"uno-far8pd"}`),Je(w,"title",i().isDeleted?"Restore chapter":"Mark as removed"),N(x,i().originalFolderPath)}),v(b,q),me()}Ee(["click"]);var fa=_('<p class="uno-8520et"> </p>'),ga=_('<div class="uno-vsugad"><div class="uno-pj4440"></div> <p class="uno-hw2z5w"> </p> <!></div>'),ha=_('<div class="uno-f2o4wl"><p class="uno-hw2z5w">Loading chapter dump and applying groups/titles...</p></div>'),ma=_('<span class="uno-czmb1a">Removed</span>'),_a=_('<div class="uno-2umhxz"></div>'),Sa=_('<div class="uno-kp2ftc"></div>'),xa=_('<div><div class="uno-py2y93"><div class="uno-nxlaaf"><p class="uno-39vbxq"> </p> <!></div> <p class="uno-dsgwse"> </p></div> <button type="button"><!></button></div>'),ba=_(`<div class="uno-bi16xf"><div class="uno-nnnwwl"><div class="uno-djaa0e"><p class="uno-apr5a0"> </p> <p class="uno-lp9tww">The following chapters already exist on WeebDex with matching groups. You can mark
								them as removed to skip uploading.</p></div> <button type="button" class="uno-3jkjwc" title="Mark all duplicate chapters as removed">Removed duplicate chapters</button></div> <div class="uno-56cpuz"></div></div>`),Fa=_('<div class="uno-hemz07"><div class="uno-ns83sq"><p class="uno-0zsd1s"> </p></div> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Series Selection (Required)</h3> <!> <!> <!></div> <!> <!> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Detected Chapters</h3> <div class="uno-xqlxhl"></div></div> <button type="button" class="uno-d93lfx"> </button></div>'),wa=_('<div class="uno-6nb6x4"><p class="uno-dillda">✓ Upload completed successfully!</p></div>'),ya=_('<div><h2 class="uno-67n1yz"> </h2> <!></div>');function Na(b,s){he(s,!0),gt({useWebWorkers:!1});let e=pe(s,"class",3,"");const i=new ht;Oe(We,i);const R=He(Ke);if(!R)throw new Error("MangaProcessor must be used within a component that provides ApiAuthContext");let h=M("loading"),q=M(null),I=M(Ge([])),L=M(!1),y=M(!1),z=M(null),A=M(!1),Q=M(null),V=M(!1),O=M(Ge([]));const E=["jpg","jpeg","png","gif","webp","cbz","zip","xml"];fe(()=>{s.zipFile&&(g(A,!1),g(Q,null),g(O,[],!0),F())});async function k(n){const d=n.name.split(".").pop()?.toLowerCase();if(!(d==="cbz")&&!(d==="zip"))throw new Error(`Unsupported archive format: ${d}`);console.log(`Extracting ${d} file:`,n.name),g(z,n.name,!0);const x=new Et(new Zt(n)),l=await x.getEntries(),u=[],C=n.name.replace(/\.(cbz|zip)$/i,""),Y=n.webkitRelativePath||n.name;for(const te of l){if(!te.filename||te.directory)continue;const D=te.filename.split(".").pop()?.toLowerCase();if(!D||!E.includes(D))continue;const ae=new TransformStream,W=new Response(ae.readable).blob();await te.getData(ae.writable);let J=await W;if(!J.type){const Se=m(D);J=new Blob([J],{type:Se})}const ie=te.filename,_e=ie.split("/").pop()??ie,Ze=Y.includes("/")?`${Y.split("/").slice(0,-1).join("/")}/${C}/${ie}`:`${C}/${ie}`,Ce=new File([J],_e,{type:J.type});Object.defineProperty(Ce,"webkitRelativePath",{value:Ze,writable:!1,enumerable:!0,configurable:!0}),u.push(Ce)}return await x.close(),g(z,null),u}function m(n){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp"}[n]||"application/octet-stream"}async function F(){g(h,"loading"),i.reset(),g(h,"extracting");let n=[];try{n=await k(s.zipFile)}catch(c){console.error(`Error extracting ${s.zipFile.name}:`,c),s.guidedState.setZipStatus(s.zipFile,oe.ERROR);return}g(q,mt(n),!0);const d=aa(t(q));g(h,"extracting"),g(I,await Promise.all(d.map(async c=>{const f=sa(c.name),x=ia(c.name),l=c.files.filter(u=>u.type===_t.CHAPTER_PAGE).map((u,C)=>new St(u.file.name,C,u.file,xt.NOT_STARTED,0,null,null,!1,u.type));return new bt(c.path,c.name,f,x,new Ve,new Ft,l,Be.NOT_STARTED,0,null,null,c,!1,"en")})),!0),t(I).sort((c,f)=>{if(c.chapterVolume&&f.chapterVolume){const x=String(c.chapterVolume).localeCompare(String(f.chapterVolume),void 0,{numeric:!0,sensitivity:"base"});if(x!==0)return x}else{if(c.chapterVolume)return-1;if(f.chapterVolume)return 1}return c.chapterNumber&&f.chapterNumber?String(c.chapterNumber).localeCompare(String(f.chapterNumber),void 0,{numeric:!0,sensitivity:"base"}):c.chapterNumber?-1:f.chapterNumber?1:0}),i.chapterStates=t(I),g(h,"ready")}fe(()=>{i.seriesId!==null&&i.chapterStates.forEach(n=>{n.associatedSeries||(n.associatedSeries=new Ve),n.associatedSeries.seriesId=i.seriesId??""})}),fe(()=>{i.seriesId&&t(h)==="ready"&&(!t(A)||i.seriesId!==t(Q))&&(g(A,!0),g(Q,i.seriesId,!0),g(h,"series_lookup"),Z())});async function Z(){if(i.seriesId)try{await Ae.load();const n=await Ae.getAllGroupNames(i.seriesId);if(n.length===0){console.warn("No groups found in chapter dump");return}const d=[];for(const c of n)try{const f=await wt(c);if(f.data){const x=f.data.find(l=>l.name===c);if(x){const l=new yt;l.groupId=x.id,l.groupName=x.name,d.push(l)}}}catch(f){console.warn(`Failed to lookup group "${c}":`,f)}i.availableScanGroups=d,await K(),await P(),await w(),g(h,"ready")}catch(n){console.error("Error loading chapter dump:",n),g(h,"ready")}}async function K(){for(const n of i.chapterStates){if(!n.originalFolderPath)continue;const d=i.availableScanGroups.filter(c=>n.originalFolderPath?.includes(c.groupName)??!1);if(d.length>0){const c=n.associatedGroup.groupIds??[],f=new Set(c);for(const x of d)f.has(x.groupId)||f.add(x.groupId);n.associatedGroup.groupIds=Array.from(f)}}}async function P(){if(!i.seriesId)return;const n=new Map;for(const d of i.availableScanGroups)n.set(d.groupId,d.groupName);for(const d of i.chapterStates){const c=d.associatedGroup.groupIds??[];if(c.length===0)continue;const f=c.map(u=>n.get(u)).filter(u=>u!==void 0);if(f.length===0)continue;const x=await Ae.getChapterInfo(i.seriesId,d.chapterVolume,d.chapterNumber);if(!x)continue;f.some(u=>x.groupNames.includes(u))&&(d.chapterTitle=x.title)}}async function w(){if(i.seriesId)try{const n=await Nt(i.seriesId),d=[],c=new Map;for(const f of n.chapters){const x=f.volume||"none",l=f.chapter,u=`${x}:${l}`;c.set(u,f)}for(const f of i.chapterStates){const x=f.chapterVolume||"none",l=f.chapterNumber;if(!l)continue;const u=`${x}:${l}`,C=c.get(u);if(C&&C.entries&&Object.keys(C.entries).length>0){const Y=new Set;for(const W of Object.values(C.entries))for(const J of W.groups)Y.add(J);const te=f.associatedGroup.groupIds??[],D=[];for(const W of Y)if(n.groups&&n.groups[W]){const J=n.groups[W];D.push(`${J.name} (${J.id})`)}else D.push(`Unknown Group (index: ${W})`);const ae=te.some(W=>n.groups?.some(J=>J.id===W)??!1);d.push({chapter:f,existingGroups:D.length>0?D:["Unknown groups"]})}}g(O,d,!0)}catch(n){console.error("Error checking for duplicates:",n),g(O,[],!0)}}function p(){t(V)||(g(V,!0),g(L,!1),g(h,"completed"),s.guidedState.setZipStatus(s.zipFile,oe.COMPLETED),s.onProcessingComplete())}function S(){if(!R.apiToken){alert("Please set up API authentication first");return}if(!i.seriesId){alert("Please set a series ID first");return}if(i.chapterStates.length===0){alert("No chapters to upload");return}g(h,"uploading"),g(L,!0),g(V,!1),s.guidedState.setZipStatus(s.zipFile,oe.PROCESSING)}const T=ne(()=>t(h)==="ready"||t(h)==="series_lookup"),j=ne(()=>t(I).filter(n=>!n.isDeleted));fe(()=>{if(t(h)==="uploading"&&t(I).length>0){const n=t(I).every(c=>c.status===Be.COMPLETED||c.isDeleted),d=t(I).some(c=>!c.isDeleted);n&&d&&!t(L)&&(s.guidedState.setZipStatus(s.zipFile,oe.COMPLETED),p())}});var B=ya(),X=r(B),le=r(X);a(X);var ee=o(X,2);{var $=n=>{var d=ga(),c=o(r(d),2),f=r(c,!0);a(c);var x=o(c,2);{var l=u=>{var C=fa(),Y=r(C);a(C),U(()=>N(Y,`Processing: ${t(z)??""}`)),v(u,C)};G(x,u=>{t(z)&&u(l)})}a(d),U(()=>N(f,t(h)==="loading"?"Loading manga folder...":"Extracting zip files...")),v(n,d)},H=n=>{var d=we(),c=ge(d);{var f=l=>{var u=Fa(),C=r(u),Y=r(C),te=r(Y);a(Y),a(C);var D=o(C,2),ae=o(r(D),2);Ct(ae,{});var W=o(ae,2);It(W,{});var J=o(W,2);zt(J,{}),a(D);var ie=o(D,2);{var _e=ue=>{var de=ha();v(ue,de)};G(ie,ue=>{t(h)==="series_lookup"&&ue(_e)})}var Ze=o(ie,2);{var Ce=ue=>{var de=ba(),xe=r(de),De=r(xe),Le=r(De),Ye=r(Le);a(Le),ct(2),a(De);var Qe=o(De,2);Qe.__click=()=>{for(const{chapter:ke}of t(O))ke.isDeleted=!0},a(xe);var je=o(xe,2);ye(je,21,()=>t(O),Ne,(ke,Ue)=>{let re=()=>t(Ue).chapter,$e=()=>t(Ue).existingGroups;var ze=xa(),Re=r(ze),Pe=r(Re),Te=r(Pe),et=r(Te);a(Te);var tt=o(Te,2);{var at=se=>{var Fe=ma();v(se,Fe)};G(tt,se=>{re().isDeleted&&se(at)})}a(Pe);var qe=o(Pe,2),st=r(qe);a(qe),a(Re);var be=o(Re,2);be.__click=()=>{re().isDeleted=!re().isDeleted};var it=r(be);{var rt=se=>{var Fe=_a();v(se,Fe)},nt=se=>{var Fe=Sa();v(se,Fe)};G(it,se=>{re().isDeleted?se(rt):se(nt,!1)})}a(be),a(ze),U(se=>{ce(ze,1,`uno-ecxsrr ${re().isDeleted?"uno-1ya9ju":""}`),N(et,`Vol. ${re().chapterVolume??"N/A"??""} Ch. ${re().chapterNumber??"N/A"??""} - ${(re().chapterTitle||re().originalFolderPath||"Untitled")??""}`),N(st,`Existing groups: ${se??""}`),ce(be,1,`uno-v1bdur ${re().isDeleted?"uno-uigj71":"uno-8ta9ap"}`),Je(be,"title",re().isDeleted?"Restore chapter":"Mark as removed")},[()=>$e().join(", ")]),v(ke,ze)}),a(je),a(de),U(()=>N(Ye,`⚠️ Warning: ${t(O).length??""} duplicate chapter${t(O).length===1?"":"s"} detected`)),v(ue,de)};G(Ze,ue=>{t(O).length>0&&ue(Ce)})}var Se=o(Ze,2),Me=o(r(Se),2);ye(Me,21,()=>t(I),Ne,(ue,de,xe)=>{va(ue,{index:xe,get chapter(){return t(de)}})}),a(Me),a(Se);var Ie=o(Se,2);Ie.__click=S;var Xe=r(Ie);a(Ie),a(u),U(()=>{N(te,`Found ${t(I).length??""} chapter${t(I).length===1?"":"s"} from deepest folders`),Ie.disabled=!t(T)||!i.seriesId||t(j).length===0,N(Xe,`Start Upload (${t(j).length??""} of ${t(I).length??""} chapters)`)}),v(l,u)},x=l=>{var u=we(),C=ge(u);{var Y=D=>{Gt(D,{onDone:p,get busy(){return t(y)},set busy(ae){g(y,ae,!0)}})},te=D=>{var ae=we(),W=ge(ae);{var J=ie=>{var _e=wa();v(ie,_e)};G(W,ie=>{t(h)==="completed"&&ie(J)},!0)}v(D,ae)};G(C,D=>{t(h)==="uploading"?D(Y):D(te,!1)},!0)}v(l,u)};G(c,l=>{t(h)==="ready"||t(h)==="series_lookup"?l(f):l(x,!1)},!0)}v(n,d)};G(ee,n=>{t(h)==="loading"||t(h)==="extracting"?n($):n(H,!1)})}a(B),U(()=>{ce(B,1,`uno-hemz07 ${e()??""}`),N(le,`Processing: ${s.zipFile.name??""}`)}),v(b,B),me()}Ee(["click"]);var Ea=_('<div class="uno-j48514"><p class="uno-5v04yw">No zip file selected. Use the tabs above to select a zip file to process.</p></div>'),Za=_('<div class="uno-eeu1av"><!> <!></div>'),Ca=_('<div class="uno-pb4e2u"><div class="uno-k0pcvl"><h1 class="uno-kryzyj">Guided Zip Manga Uploader</h1> <!></div> <!> <!></div>');function Oa(b,s){he(s,!0);const e=new Ot;Oe(Mt,e),Oe(Ke,new Tt);let i=M(null);function R(){e.workflowStep=ve.SELECTING_MANGA_FOLDERS}function h(){if(e.workflowStep=ve.PROCESSING_MANGA,e.selectedZipFiles.length>0){const m=e.selectedZipFiles[0],F=e.zipFiles.findIndex(Z=>Z.file===m);F>=0&&(e.currentZipIndex=F,g(i,m,!0))}}function q(m){g(i,m,!0),e.setZipStatus(m,oe.PROCESSING)}function I(){if(e.moveToNextZip()){const m=e.currentZip;m&&(g(i,m.file,!0),e.setZipStatus(m.file,oe.PROCESSING))}else g(i,null)}const L=ne(()=>e.workflowStep!==ve.PROCESSING_MANGA);var y=Ca(),z=r(y),A=o(r(z),2);Dt(A,{}),a(z);var Q=o(z,2);{var V=m=>{kt(m,{})};G(Q,m=>{t(L)&&m(V)})}var O=o(Q,2);{var E=m=>{qt(m,{get guidedState(){return e},onDone:R,class:"uno-zgouyr"})},k=m=>{var F=we(),Z=ge(F);{var K=w=>{Wt(w,{get guidedState(){return e},onDone:h,class:"uno-l0uum8"})},P=w=>{var p=we(),S=ge(p);{var T=j=>{var B=Za(),X=r(B);ta(X,{get guidedState(){return e},onZipSelected:q,class:"uno-wgeun8"});var le=o(X,2);{var ee=H=>{Na(H,{get guidedState(){return e},get zipFile(){return t(i)},onProcessingComplete:I,class:"uno-wgeun8"})},$=H=>{var n=Ea();v(H,n)};G(le,H=>{t(i)?H(ee):H($,!1)})}a(B),v(j,B)};G(S,j=>{e.workflowStep===ve.PROCESSING_MANGA&&j(T)},!0)}v(w,p)};G(Z,w=>{e.workflowStep===ve.SELECTING_MANGA_FOLDERS?w(K):w(P,!1)},!0)}v(m,F)};G(O,m=>{e.workflowStep===ve.SELECTING_ROOT_FOLDER?m(E):m(k,!1)})}a(y),v(b,y),me()}export{Oa as component,Aa as universal};
