import{f as h,a as v,c as Ue}from"../chunks/CdXyPVf1.js";import{o as wt}from"../chunks/Bm5TXEI0.js";import{z as It,A as D,B as e,C as u,D as Ze,E as Ye,I as r,K as o,J as a,G as k,H as Ve,aH as Fe,aI as Dt,aJ as ut,u as Oe,F as Ce,aC as lt,af as Et}from"../chunks/CIcfCS9e.js";import{d as $e}from"../chunks/CMrQpYvR.js";import{p as Le,b as it,i as P}from"../chunks/Bp05Fg2P.js";import{r as Pt,a as Gt,s as ft}from"../chunks/DVberjZs.js";import{s as S}from"../chunks/BR9ubxrB.js";import{S as vt,s as Se,e as ke,i as ze,D as Tt,c as Ct,g as Ot,a as Zt,t as St,T as Lt,b as kt,d as zt,C as Je,p as Mt,f as Ut,h as Wt,j as jt,k as qt,l as Yt,m as Vt,n as $t,o as mt,q as Bt,r as pt,u as Ht,v as Kt,w as Xt,Z as Jt,B as Qt,x as es,y as ts,z as ss,U as as,A as is,E as rs}from"../chunks/BaOQz20K.js";import{b as xt,A as ns}from"../chunks/LF6JFb3L.js";import{a as os,r as _t}from"../chunks/DYCF5JE_.js";import{g as ls}from"../chunks/m9lK8jp6.js";const us=!0,za=Object.freeze(Object.defineProperty({__proto__:null,prerender:us},Symbol.toStringTag,{value:"Module"}));var qe=(b=>(b.SELECTING_ROOT_FOLDER="SELECTING_ROOT_FOLDER",b.SELECTING_MANGA_FOLDERS="SELECTING_MANGA_FOLDERS",b.PROCESSING_MANGA="PROCESSING_MANGA",b))(qe||{}),we=(b=>(b.PENDING="PENDING",b.PROCESSING="PROCESSING",b.COMPLETED="COMPLETED",b.ERROR="ERROR",b.WARNING="WARNING",b))(we||{}),I=(b=>(b.LOADING="LOADING",b.EXTRACTING="EXTRACTING",b.SERIES_LOOKUP="SERIES_LOOKUP",b.APPLYING_REGEX="APPLYING_REGEX",b.CHAPTER_LOOKUP="CHAPTER_LOOKUP",b.LOADING_GROUPS="LOADING_GROUPS",b.APPLYING_GROUPS="APPLYING_GROUPS",b.APPLYING_TITLES="APPLYING_TITLES",b.READY="READY",b.READY_WARNING="READY_WARNING",b.UPLOADING="UPLOADING",b.COMPLETED="COMPLETED",b))(I||{});class cs{#e=D(null);get rootFolderFiles(){return e(this.#e)}set rootFolderFiles(s){u(this.#e,s,!0)}#t=D(Ze([]));get zipFiles(){return e(this.#t)}set zipFiles(s){u(this.#t,s,!0)}#s=D(Ze([]));get selectedZipFiles(){return e(this.#s)}set selectedZipFiles(s){u(this.#s,s,!0)}#a=D(-1);get currentZipIndex(){return e(this.#a)}set currentZipIndex(s){u(this.#a,s,!0)}#i=D("SELECTING_ROOT_FOLDER");get workflowStep(){return e(this.#i)}set workflowStep(s){u(this.#i,s,!0)}get currentZip(){return this.currentZipIndex<0||this.currentZipIndex>=this.zipFiles.length?null:this.zipFiles[this.currentZipIndex]}get unprocessedZips(){return this.zipFiles.filter(s=>this.selectedZipFiles.includes(s.file)&&s.status!=="COMPLETED")}get pendingZips(){return this.zipFiles.filter(s=>this.selectedZipFiles.includes(s.file)&&s.status==="PENDING")}get warningZips(){return this.zipFiles.filter(s=>this.selectedZipFiles.includes(s.file)&&s.status==="WARNING")}get errorZips(){return this.zipFiles.filter(s=>this.selectedZipFiles.includes(s.file)&&s.status==="ERROR")}get completedZips(){return this.zipFiles.filter(s=>this.selectedZipFiles.includes(s.file)&&s.status==="COMPLETED")}get processingZips(){return this.zipFiles.filter(s=>this.selectedZipFiles.includes(s.file)&&s.status==="PROCESSING")}get nextZip(){const s=this.pendingZips;if(s.length===0)return null;const i=this.currentZip,t=i?s.filter(f=>f.file!==i.file):s;return t.length===0?null:t[0]}setZipStatus(s,i){const t=this.zipFiles.find(f=>f.file===s);t&&(t.status=i)}moveToNextZip(){const s=this.nextZip;if(!s)return!1;const i=this.zipFiles.findIndex(t=>t.file===s.file);return i>=0?(this.currentZipIndex=i,!0):!1}get zipFilesByMangaFolder(){const s=new vt;for(const i of this.zipFiles)s.has(i.mangaFolderName)||s.set(i.mangaFolderName,[]),s.get(i.mangaFolderName).push(i);return s}reset(){this.rootFolderFiles=null,this.zipFiles=[],this.selectedZipFiles=[],this.currentZipIndex=-1,this.workflowStep="SELECTING_ROOT_FOLDER"}}class ds{#e=D(!1);get enabled(){return e(this.#e)}set enabled(s){u(this.#e,s,!0)}get isActive(){return this.enabled}enable(){this.enabled=!0}disable(){this.enabled=!1}reset(){this.enabled=!1}}const ps=It(),gt=It();var vs=h('<div class="uno-4maolu"><div class="uno-senp7v"></div> <p class="uno-l6h9uf">Scanning folder structure...</p></div>'),fs=h('<div class="uno-laclbo"><p class="uno-dl0t86"> </p></div>'),gs=h('<div class="uno-tm086o"><button><h1 class="uno-brv6u2">Select Root Folder</h1> <p class="uno-l6h9uf">Select the folder containing manga subfolders with .zip files</p> <input class="uno-qya2ty" type="file"/></button> <!> <!></div>');function hs(b,s){Ye(s,!0);let i=Le(s,"guidedState",7),t=Le(s,"class",3,""),f=D(null),F=D(!1);async function c(y){u(F,!0);const L=y.target,le=Array.from(L.files??[]),q=[];for(const B of le){const E=(B.webkitRelativePath||B.name).split("/").filter(Boolean);if(E.length>=2){const N=E[0],J=E[0],H=B.name.split(".").pop()?.toLowerCase();(H==="zip"||H==="cbz")&&q.push({file:B,mangaFolderName:N,mangaFolderPath:J})}}i().rootFolderFiles=le,i().zipFiles=q.map(B=>({...B,status:we.PENDING})),u(F,!1),s.onDone()}function M(y){e(f)?.click()}var C=gs(),z=r(C);z.__click=M;var U=o(r(z),4);U.webkitdirectory=!0,U.multiple=!0,U.__change=c,it(U,y=>u(f,y),()=>e(f)),a(z);var X=o(z,2);{var fe=y=>{var L=vs();v(y,L)};P(X,y=>{e(F)&&y(fe)})}var W=o(X,2);{var V=y=>{var L=fs(),le=r(L),q=r(le);a(le),a(L),k(()=>S(q,`Found ${i().zipFiles.length??""} zip file${i().zipFiles.length===1?"":"s"}`)),v(y,L)};P(W,y=>{i().zipFiles.length>0&&y(V)})}a(C),k(()=>{Se(z,1,`uno-a4tqjo ${t()??""}`),z.disabled=e(F)}),v(b,C),Ve()}$e(["click","change"]);var ms=h('<button type="button"><div class="uno-bpywdh"><p class="uno-98yf80"> </p> <p class="uno-42pivu"> </p></div> <input type="checkbox" class="uno-5onsv4"/></button>'),_s=h('<div class="uno-o40niy"><div class="uno-iuhcpm"><h3 class="uno-0lb4rh"> </h3> <button type="button" class="uno-phh4jd"> </button></div> <div class="uno-fb55wk"></div></div>'),bs=h('<div><div class="uno-iuhcpm"><h2 class="uno-iyer7g">Select Zip Files to Process</h2> <button type="button" class="uno-f45w65"> </button></div> <p class="uno-ok9xip"> </p> <div class="uno-yjimjk"></div> <button type="button" class="uno-3s4o5e"> </button></div>');function ws(b,s){Ye(s,!0);let i=Le(s,"guidedState",7),t=Le(s,"class",3,"");function f(q){i().selectedZipFiles.indexOf(q)>=0?i().selectedZipFiles=i().selectedZipFiles.filter(ue=>ue!==q):i().selectedZipFiles=[...i().selectedZipFiles,q]}function F(q){const B=Array.from(i().zipFilesByMangaFolder.get(q)??[]);if(B.every(E=>i().selectedZipFiles.includes(E.file)))i().selectedZipFiles=i().selectedZipFiles.filter(E=>!B.some(N=>N.file===E));else{const E=B.map(N=>N.file).filter(N=>!i().selectedZipFiles.includes(N));i().selectedZipFiles=[...i().selectedZipFiles,...E]}}function c(){i().selectedZipFiles.length===i().zipFiles.length?i().selectedZipFiles=[]:i().selectedZipFiles=i().zipFiles.map(q=>q.file)}const M=Fe(()=>i().zipFiles.length>0&&i().selectedZipFiles.length===i().zipFiles.length),C=Fe(()=>i().zipFilesByMangaFolder);var z=bs(),U=r(z),X=o(r(U),2);X.__click=c;var fe=r(X,!0);a(X),a(U);var W=o(U,2),V=r(W);a(W);var y=o(W,2);ke(y,21,()=>Array.from(e(C).entries()),ze,(q,B)=>{var ue=Fe(()=>Dt(e(B),2));let E=()=>e(ue)[0],N=()=>e(ue)[1];var J=_s(),H=r(J),he=r(H),O=r(he,!0);a(he);var ee=o(he,2);ee.__click=()=>F(E());var ce=r(ee);a(ee),a(H);var te=o(H,2);ke(te,21,N,ze,(Ie,se)=>{const Ee=Fe(()=>i().selectedZipFiles.includes(e(se).file));var me=ms();me.__click=()=>f(e(se).file);var ae=r(me),K=r(ae),de=r(K,!0);a(K);var ie=o(K,2),re=r(ie);a(ie),a(ae);var $=o(ae,2);Pt($),a(me),k(oe=>{Se(me,1,`uno-ik4adi ${e(Ee)?"uno-1k75dk":""}`),S(de,e(se).file.name),S(re,`Size: ${oe??""} MB`),Gt($,e(Ee))},[()=>(e(se).file.size/(1024*1024)).toFixed(2)]),v(Ie,me)}),a(te),a(J),k(Ie=>{S(O,E()),S(ce,`${Ie??""} (${N().length??""})`)},[()=>N().every(Ie=>i().selectedZipFiles.includes(Ie.file))?"Deselect All":"Select All"]),v(q,J)}),a(y);var L=o(y,2);L.__click=function(...q){s.onDone?.apply(this,q)};var le=r(L);a(L),a(z),k(()=>{Se(z,1,`uno-grwdkw ${t()??""}`),S(fe,e(M)?"Deselect All":"Select All"),S(V,`${i().selectedZipFiles.length??""} of ${i().zipFiles.length??""} zip file${i().zipFiles.length===1?"":"s"} selected`),L.disabled=i().selectedZipFiles.length===0,S(le,`Continue to Processing (${i().selectedZipFiles.length??""} selected)`)}),v(b,z),Ve()}$e(["click"]);var Is=h('<p class="uno-a54tpo"> </p>'),Es=h('<div class="uno-cqccui"><p class="uno-nsysfu"> </p> <span> </span></div> <!>',1),Ss=h('<p class="uno-b7m48p">No zip file selected</p>'),xs=h('<button type="button" class="uno-qm31yq"> </button>'),ys=h('<p class="uno-b7m48p">No more zip files to process</p>'),Ns=h("<div><!></div>"),As=h('<p class="uno-b7m48p">All zip files have been completed</p>'),Fs=h('<button type="button" class="uno-4y4l6m"> </button>'),Rs=h('<div class="uno-2db0z0"><h3 class="uno-tniapq"> </h3> <div class="uno-ouywhe"></div></div>'),Ds=h('<button type="button" class="uno-qy4bc0"> </button>'),Ps=h('<div class="uno-2db0z0"><h3 class="uno-9iz2qs"> </h3> <div class="uno-ouywhe"></div></div>'),Gs=h('<div><div class="uno-0ia1w6 border-surface-hover"><h2 class="uno-1c2kr2">Zip Processing</h2> <div class="uno-cqccui"><span class="uno-d1zaof">Automation (experimental): <span> </span></span> <button type="button"> </button></div></div> <div class="uno-usvt4c"><div class="uno-cqccui"><span class="uno-4ezlml"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-1l1bmy"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-e545zy"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-mg1fk7"></span> <span class="uno-b7m48p"> </span></div> <div class="uno-cqccui"><span class="uno-ip18dj"></span> <span class="uno-b7m48p"> </span></div></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Current Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Next Zip File</h3> <!></div> <div class="uno-2db0z0"><h3 class="uno-py45hl">Select Zip File</h3> <!></div> <!> <!></div>');function Ts(b,s){Ye(s,!0);let i=Le(s,"guidedState",7),t=Le(s,"class",3,"");const f=ut(gt);if(!f)throw new Error("MangaProcessingTabs must be used within a component that provides AutomationState context");function F(){if(i().moveToNextZip()){const l=i().currentZip;l&&s.onZipSelected(l.file)}}function c(l){const d=i().zipFiles.find(w=>w.file.name===l);if(d){const w=i().zipFiles.findIndex(Z=>Z.file===d.file);w>=0&&(i().currentZipIndex=w,s.onZipSelected(d.file))}}function M(){f.enabled?f.disable():f.enable()}const C=Fe(()=>i().currentZip?.file.name??null),z=Fe(()=>i().warningZips.map(l=>l.file.name)),U=Fe(()=>i().errorZips.map(l=>l.file.name)),X=Fe(()=>i().unprocessedZips.map(l=>l.file.name)),fe=Fe(()=>i().nextZip?.file.name??null),W=Fe(()=>i().pendingZips.length===0&&(i().warningZips.length>0||i().errorZips.length>0));Oe(()=>{e(W)&&f.isActive&&f.disable()});let V=D(null);Oe(()=>{u(V,i().currentZip?.file.name??null,!0)}),Oe(()=>{const l=e(V);if(l){const d=i().currentZip?.file.name??null;l!==d&&c(l)}});const y=Fe(()=>({pending:i().pendingZips.length,warning:i().warningZips.length,error:i().errorZips.length,completed:i().completedZips.length,processing:i().processingZips.length}));var L=Gs(),le=r(L),q=o(r(le),2),B=r(q),ue=o(r(B)),E=r(ue,!0);a(ue),a(B);var N=o(B,2);N.__click=M;var J=r(N,!0);a(N),a(q),a(le);var H=o(le,2),he=r(H),O=o(r(he),2),ee=r(O);a(O),a(he);var ce=o(he,2),te=o(r(ce),2),Ie=r(te);a(te),a(ce);var se=o(ce,2),Ee=o(r(se),2),me=r(Ee);a(Ee),a(se);var ae=o(se,2),K=o(r(ae),2),de=r(K);a(K),a(ae);var ie=o(ae,2),re=o(r(ie),2),$=r(re);a(re),a(ie),a(H);var oe=o(H,2),ne=o(r(oe),2);{var ge=l=>{var d=Es(),w=Ce(d),Z=r(w),G=r(Z,!0);a(Z);var Y=o(Z,2),pe=r(Y,!0);a(Y),a(w);var j=o(w,2);{var _e=be=>{var Re=Is(),De=r(Re);a(Re),k(()=>S(De,`Manga Folder: ${i().currentZip.mangaFolderName??""}`)),v(be,Re)};P(j,be=>{i().currentZip&&be(_e)})}k(()=>{S(G,e(C)),Se(Y,1,`uno-ielryd ${i().currentZip?.status===we.PROCESSING?"uno-kxa2ln":i().currentZip?.status===we.COMPLETED?"uno-b1425w":i().currentZip?.status===we.ERROR?"uno-isu16c":i().currentZip?.status===we.WARNING?"uno-enplrj":"uno-jwlzg2"}`),S(pe,i().currentZip?.status??"UNKNOWN")}),v(l,d)},Ge=l=>{var d=Ss();v(l,d)};P(ne,l=>{e(C)?l(ge):l(Ge,!1)})}a(oe);var ye=o(oe,2),We=o(r(ye),2);{var Qe=l=>{var d=xs();d.__click=F;var w=r(d);a(d),k(()=>{d.disabled=f.enabled,S(w,`Process: ${e(fe)??""}`)}),v(l,d)},p=l=>{var d=ys();v(l,d)};P(We,l=>{e(fe)?l(Qe):l(p,!1)})}a(ye);var _=o(ye,2),g=o(r(_),2);{var R=l=>{var d=Ns(),w=r(d);Tt(w,{get items(){return e(X)},class:"uno-qbg2l1",get selectedItem(){return e(V)},set selectedItem(Z){u(V,Z,!0)}}),a(d),k(()=>Se(d,1,Ct(f.enabled?"opacity-50 pointer-events-none":""))),v(l,d)},T=l=>{var d=As();v(l,d)};P(g,l=>{e(X).length>0?l(R):l(T,!1)})}a(_);var A=o(_,2);{var x=l=>{var d=Rs(),w=r(d),Z=r(w);a(w);var G=o(w,2);ke(G,21,()=>e(z),ze,(Y,pe)=>{var j=Fs();j.__click=()=>c(e(pe));var _e=r(j,!0);a(j),k(()=>{j.disabled=f.enabled,S(_e,e(pe))}),v(Y,j)}),a(G),a(d),k(()=>S(Z,`‚ö†Ô∏è Warning Zips (${e(z).length??""})`)),v(l,d)};P(A,l=>{e(z).length>0&&l(x)})}var n=o(A,2);{var m=l=>{var d=Ps(),w=r(d),Z=r(w);a(w);var G=o(w,2);ke(G,21,()=>e(U),ze,(Y,pe)=>{var j=Ds();j.__click=()=>c(e(pe));var _e=r(j,!0);a(j),k(()=>{j.disabled=f.enabled,S(_e,e(pe))}),v(Y,j)}),a(G),a(d),k(()=>S(Z,`‚ùå Error Zips (${e(U).length??""})`)),v(l,d)};P(n,l=>{e(U).length>0&&l(m)})}a(L),k(()=>{Se(L,1,`uno-s0eao9 ${t()??""}`),Se(ue,1,`uno-cvk0wv ${f.enabled?"uno-ikj4sb":"uno-je1lgh"}`),S(E,f.enabled?"ON":"OFF"),Se(N,1,`uno-sv39f1 ${f.enabled?"uno-oxxvv6":"uno-dimr5c"}`),S(J,f.enabled?"üîÑ Turn OFF":"‚ñ∂Ô∏è Turn ON"),S(ee,`Pending: ${e(y).pending??""}`),S(Ie,`Processing: ${e(y).processing??""}`),S(me,`Warning: ${e(y).warning??""}`),S(de,`Error: ${e(y).error??""}`),S($,`Completed: ${e(y).completed??""}`)}),v(b,L),Ve()}$e(["click"]);function Cs(b){const s=Ot(b,0);return Zt(b,s,0,[])}function Os(b,s="v(\\d+)"){const i=new RegExp(s,"i"),t=b.match(i);return t&&t[1]?t[1].replace(/^0+/,"")||"0":null}function Zs(b,s="c(\\d+(?:\\.\\d+){0,2})"){const i=new RegExp(s,"i"),t=b.match(i);if(t&&t[1]){const f=t[1];if(f.includes(".")){const F=f.split(".");return[F[0].replace(/^0+/,"")||"0",...F.slice(1)].join(".")}else return f.replace(/^0+/,"")||"0"}return null}function Ls(b){const s=/MD-(\d+)/i,i=b.match(s);return i?i[1]:null}var ks=h('<span class="uno-lzl9l3 svelte-m4i47p">Removed</span>'),zs=h('<button type="button" class="uno-lj049g svelte-m4i47p" title="Edit volume and chapter" aria-label="Edit volume and chapter"><div class="uno-smkhzc svelte-m4i47p"></div></button>'),Ms=h('<div class="uno-7qt2lg svelte-m4i47p"><div class="uno-m5mbjf svelte-m4i47p"></div> <span class="svelte-m4i47p">Restore</span></div>'),Us=h('<div class="uno-7qt2lg svelte-m4i47p"><div class="uno-9z7ooq svelte-m4i47p"></div> <span class="svelte-m4i47p">Remove</span></div>'),Ws=h('<span class="uno-2et217 svelte-m4i47p"> </span>'),js=h('<div class="uno-58lieu svelte-m4i47p">Loading combinations...</div>'),qs=h('<div class="uno-58lieu svelte-m4i47p">No volume/chapter combinations available</div>'),Ys=h('<button type="button"><div class="uno-l6o6ga svelte-m4i47p"><span class="svelte-m4i47p"> </span></div></button>'),Vs=h('<div class="uno-iqadiw svelte-m4i47p" role="presentation"><div class="uno-k7cjbm svelte-m4i47p"><!></div></div>'),$s=h('<div><div class="uno-rzokcw svelte-m4i47p"><div class="uno-n4d6p5 svelte-m4i47p"><span class="uno-upv063 svelte-m4i47p"> </span> <!> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Vol:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Ch:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div> <!> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Pages:</span> <span class="uno-4g5bui svelte-m4i47p"> </span></div></div> <button type="button"><!></button></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Title:</span> <div class="uno-aqzn48 svelte-m4i47p"><!> <!></div></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Groups:</span> <!></div> <div class="uno-0yx623 svelte-m4i47p"><span class="uno-7f6l2t svelte-m4i47p">Path:</span> <span class="uno-nggqeg svelte-m4i47p"> </span></div></div> <!>',1);function Bs(b,s){if(Ye(s,!0),!ut(St))throw new Error("GuidedChapterEditor must be used within a component that provides TargetingState context");let t=Le(s,"chapter",7),f=Le(s,"class",3,""),F=D(!1),c=D(Ze([])),M=D(!1),C=D(null),z=D(null),U=D(null),X=D(null);function fe(){t().isDeleted=!t().isDeleted}async function W(){if(!e(F)){e(C)&&u(X,e(C).getBoundingClientRect(),!0),u(F,!0),u(M,!0);try{const n=t().associatedSeries?.seriesId;if(!n){console.warn("No series ID available for chapter"),u(F,!1);return}await Je.load(),u(c,await Je.getUniqueVolumeChapterCombinations(n),!0)}catch(n){console.error("Failed to load volume/chapter combinations:",n)}finally{u(M,!1)}}}function V(){u(F,!1),u(U,null),u(X,null)}function y(n,m){const l=m?.includes("[no group]")??!1;if(m&&!l){for(const w of Object.keys(n.groupTitles))if(m.includes(w)){const Z=n.groupTitles[w];if(Z&&Z.trim()!=="")return Z}}if(l&&n.ungroupedTitles.length>0||n.ungroupedTitles.length>0)return n.ungroupedTitles[0];const d=Object.keys(n.groupTitles);return d.length>0?n.groupTitles[d[0]]:null}function L(n){t().manuallyEditedFields.has("volume")||(t().originalFieldValues.has("volume")||t().originalFieldValues.set("volume",t().chapterVolume),t().manuallyEditedFields.add("volume")),t().manuallyEditedFields.has("chapter")||(t().originalFieldValues.has("chapter")||t().originalFieldValues.set("chapter",t().chapterNumber),t().manuallyEditedFields.add("chapter")),t().manuallyEditedFields.has("title")||(t().originalFieldValues.has("title")||t().originalFieldValues.set("title",t().chapterTitle),t().manuallyEditedFields.add("title")),t().chapterVolume=n.volume||null,t().chapterNumber=n.chapter||null,t().chapterTitle=y(n.info,t().originalFolderPath),V()}function le(n){const m=n.volume||"N/A",l=n.chapter||"N/A",d=y(n.info,t().originalFolderPath),w=d?` - ${d}`:"";return`Vol ${m}, Ch ${l}${w}`}function q(){if(!e(X))return;const n=e(X),m=window.innerHeight,l=window.innerWidth,d=4,w=256;let Z=w;if(e(z)){const et=e(z).getBoundingClientRect().height;Z=Math.min(et,w)}const G=m-n.bottom-d,Y=n.top-d,pe=G<w&&Y>G;let j;pe?(j=n.top-Z-d,j<d&&(j=d)):(j=n.bottom+d,j+Z>m&&(j=Math.max(d,m-Z-d)));let _e=n.left;const be=320,Re=Math.min(400,l-d*2),De=Math.max(be,Math.min(Re,n.width));_e+De>l-d&&(_e=l-De-d),_e<d&&(_e=d),u(U,{top:j,left:_e,width:De},!0)}Oe(()=>{if(e(F)){if(!e(X)){u(U,null);return}requestAnimationFrame(()=>{requestAnimationFrame(()=>{q()})});const n=()=>q(),m=d=>{const w=d.target;e(z)&&!e(z).contains(w)&&e(C)&&!e(C).contains(w)&&V()},l=setTimeout(()=>{window.addEventListener("resize",n),document.addEventListener("click",m,!0)},10);return()=>{clearTimeout(l),window.removeEventListener("resize",n),document.removeEventListener("click",m,!0)}}else u(U,null)}),Oe(()=>{e(F)&&e(z)&&requestAnimationFrame(()=>{q()})});var B=$s(),ue=Ce(B),E=r(ue),N=r(E),J=r(N),H=r(J);a(J);var he=o(J,2);{var O=n=>{var m=ks();v(n,m)};P(he,n=>{t().isDeleted&&n(O)})}var ee=o(he,2),ce=o(r(ee),2),te=r(ce,!0);a(ce),a(ee);var Ie=o(ee,2),se=o(r(Ie),2),Ee=r(se,!0);a(se),a(Ie);var me=o(Ie,2);{var ae=n=>{var m=zs();m.__click=l=>{l.stopPropagation(),W()},it(m,l=>u(C,l),()=>e(C)),v(n,m)};P(me,n=>{t().associatedSeries?.seriesId&&n(ae)})}var K=o(me,2),de=o(r(K),2),ie=r(de,!0);a(de),a(K),a(N);var re=o(N,2);re.__click=fe;var $=r(re);{var oe=n=>{var m=Ms();v(n,m)},ne=n=>{var m=Us();v(n,m)};P($,n=>{t().isDeleted?n(oe):n(ne,!1)})}a(re),a(E);var ge=o(E,2),Ge=o(r(ge),2),ye=r(Ge);Lt(ye,{textClass:"text-sm text-app font-medium",fieldName:"title",get chapter(){return t()},get value(){return t().chapterTitle},set value(n){t().chapterTitle=n}});var We=o(ye,2);{var Qe=n=>{var m=Ws(),l=r(m);a(m),k(()=>S(l,`(${(t().originalFolderPath||"Untitled")??""})`)),v(n,m)};P(We,n=>{t().chapterTitle||n(Qe)})}a(Ge),a(ge);var p=o(ge,2),_=o(r(p),2);kt(_,{fieldName:"groups",get chapter(){return t()},get groups(){return t().associatedGroup},set groups(n){t().associatedGroup=n}}),a(p);var g=o(p,2),R=o(r(g),2),T=r(R,!0);a(R),a(g),a(ue);var A=o(ue,2);{var x=n=>{var m=Vs();m.__click=G=>G.stopPropagation();var l=r(m),d=r(l);{var w=G=>{var Y=js();v(G,Y)},Z=G=>{var Y=Ue(),pe=Ce(Y);{var j=be=>{var Re=qs();v(be,Re)},_e=be=>{var Re=Ue(),De=Ce(Re);ke(De,17,()=>e(c),ze,(et,Ne)=>{var xe=Ys();xe.__click=()=>L(e(Ne));var Te=r(xe),Me=r(Te),Be=r(Me,!0);a(Me),a(Te),a(xe),k(He=>{Se(xe,1,`uno-ss9yjz ${t().chapterVolume===e(Ne).volume&&t().chapterNumber===e(Ne).chapter?"uno-eokg3r":""}`,"svelte-m4i47p"),S(Be,He)},[()=>le(e(Ne))]),v(et,xe)}),v(be,Re)};P(pe,be=>{e(c).length===0?be(j):be(_e,!1)},!0)}v(G,Y)};P(d,G=>{e(M)?G(w):G(Z,!1)})}a(l),a(m),it(m,G=>u(z,G),()=>e(z)),k(()=>zt(m,`top: ${e(U).top??""}px; left: ${e(U).left??""}px; width: ${e(U).width??""}px;`)),v(n,m)};P(A,n=>{e(F)&&e(U)&&n(x)})}k(()=>{Se(ue,1,`uno-3rf4hu ${t().isDeleted?"uno-d3zfvr":""} ${f()??""}`,"svelte-m4i47p"),S(H,`#${s.index+1}`),S(te,t().chapterVolume??"N/A"),S(Ee,t().chapterNumber??"N/A"),S(ie,t().pages.length),Se(re,1,`uno-lto8ne ${t().isDeleted?"uno-ld06wt":"uno-far8pd"}`,"svelte-m4i47p"),ft(re,"title",t().isDeleted?"Restore chapter":"Mark as removed"),S(T,t().originalFolderPath)}),v(b,B),Ve()}$e(["click"]);class Hs{#e=D(null);get legacyToWeebdexMap(){return e(this.#e)}set legacyToWeebdexMap(s){u(this.#e,s,!0)}#t=D(null);get weebdexToLegacyMap(){return e(this.#t)}set weebdexToLegacyMap(s){u(this.#t,s,!0)}#s=D(!1);get isLoading(){return e(this.#s)}set isLoading(s){u(this.#s,s,!0)}#a=D(null);get loadError(){return e(this.#a)}set loadError(s){u(this.#a,s,!0)}loadPromise=null;async load(){if(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)return;if(this.loadPromise)return this.loadPromise;this.isLoading=!0,this.loadError=null;let s,i;this.loadPromise=new Promise((t,f)=>{s=t,i=f});try{const t=os("/weebdex_lookup.csv"),f=await fetch(t);if(!f.ok)throw new Error(`Failed to fetch CSV: ${f.status} ${f.statusText}`);const F=await f.text(),{legacyToWeebdex:c,weebdexToLegacy:M}=this.parseCSV(F);this.legacyToWeebdexMap=c,this.weebdexToLegacyMap=M,s()}catch(t){this.loadError=t instanceof Error?t:new Error("Unknown error loading CSV"),i(this.loadError)}finally{this.isLoading=!1}return this.loadPromise}async ensureLoaded(){if(!(this.legacyToWeebdexMap!==null&&this.weebdexToLegacyMap!==null)){if(this.loadPromise){await this.loadPromise;return}await this.load()}}parseCSV(s){const i=Mt(s,{columns:!0,skip_empty_lines:!0,trim:!0}),t=new vt,f=new vt;for(const F of i){const c=F.weebdex_id?.trim()||"",M=F.legacy_id?.trim()||"";c&&M&&(t.set(M,c),f.set(c,M))}return{legacyToWeebdex:t,weebdexToLegacy:f}}async getWeebdexIdFromLegacyId(s){return await this.ensureLoaded(),this.legacyToWeebdexMap===null?null:this.legacyToWeebdexMap.get(s)||null}}const bt=new Hs;var Ks=h('<p class="uno-8520et"> </p>'),Xs=h('<div class="uno-vsugad"><div class="uno-pj4440"></div> <p class="uno-hw2z5w"> </p> <!></div>'),Js=h(`<p class="uno-stwt3u">‚ö†Ô∏è Waiting for series ID - Automation will skip this zip. Please select a series
							above.</p>`),Qs=h('<p class="uno-stwt3u">‚ö†Ô∏è Ready with warnings - Automation will skip this zip. You can still upload manually.</p>'),ea=h("<p> </p>"),ta=h("<p>‚Ä¢ Chapter dump lookup failed</p>"),sa=h("<p> </p>"),aa=h("<p> </p>"),ia=h('<div class="uno-hqujre"><!> <div class="uno-4ixn7j"><!> <!> <!> <!></div></div>'),ra=h('<span class="uno-czmb1a">Removed</span>'),na=h('<div class="uno-2umhxz"></div>'),oa=h('<div class="uno-kp2ftc"></div>'),la=h('<div><div class="uno-py2y93"><div class="uno-nxlaaf"><p class="uno-39vbxq"> </p> <!></div> <p class="uno-dsgwse"> </p></div> <button type="button"><!></button></div>'),ua=h(`<div class="uno-bi16xf"><div class="uno-nnnwwl"><div class="uno-djaa0e"><p class="uno-apr5a0"> </p> <p class="uno-lp9tww">The following chapters already exist on WeebDex with matching groups. You can mark
								them as removed to skip uploading.</p></div> <button type="button" class="uno-3jkjwc" title="Mark all duplicate chapters as removed">Removed duplicate chapters</button></div> <div class="uno-56cpuz"></div></div>`),ca=h('<div class="uno-hemz07"><div class="uno-ns83sq"><p class="uno-0zsd1s"> </p></div> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Series Selection (Required)</h3> <!> <!> <!></div> <!> <!> <div class="uno-f2o4wl"><h3 class="uno-otxjpc">Detected Chapters</h3> <div class="uno-xqlxhl"></div></div> <button type="button" class="uno-d93lfx"> </button></div>'),da=h('<div class="uno-6nb6x4"><p class="uno-dillda">‚úì Upload completed successfully!</p></div>'),pa=h('<div><h2 class="uno-67n1yz"> </h2> <!></div>');function va(b,s){Ye(s,!0),Ut({useWebWorkers:!1});let i=Le(s,"class",3,"");const t=new Wt;lt(St,t);const f=ut(xt);if(!f)throw new Error("MangaProcessor must be used within a component that provides ApiAuthContext");const F=ut(gt);let c=D(Ze(I.LOADING)),M=D(null),C=D(Ze([])),z=D(!1),U=D(null),X=D(null),fe=D(null),W=D(Ze([])),V=D(!1),y=D(Ze([])),L=D(0),le=D(null);const q=["jpg","jpeg","png","gif","webp","cbz","zip","xml"];Oe(()=>{s.zipFile&&(u(fe,null),u(W,[],!0),u(V,!1),u(y,[],!0),u(L,0),u(le,null),B())});async function B(){try{if(await N(),await J(),!t.seriesId){u(c,I.READY_WARNING,!0);return}u(c,I.APPLYING_REGEX,!0),await H(),await he(),await O(),await ee(),await se(),me()?u(c,I.READY_WARNING,!0):u(c,I.READY,!0)}catch(p){console.error("Error in processing pipeline:",p),u(le,p instanceof Error?p.message:"Processing failed",!0),s.guidedState.setZipStatus(s.zipFile,we.ERROR),u(c,I.READY_WARNING,!0),s.onProcessingComplete("error")}}async function ue(p){const _=p.name.split(".").pop()?.toLowerCase();if(!(_==="cbz")&&!(_==="zip"))throw new Error(`Unsupported archive format: ${_}`);console.log(`Extracting ${_} file:`,p.name),u(U,p.name,!0);const T=new Jt(new Qt(p)),A=await T.getEntries(),x=[],n=p.name.replace(/\.(cbz|zip)$/i,""),m=p.webkitRelativePath||p.name;for(const l of A){if(!l.filename||l.directory)continue;const d=l.filename.split(".").pop()?.toLowerCase();if(!d||!q.includes(d))continue;const w=new TransformStream,Z=new Response(w.readable).blob();await l.getData(w.writable);let G=await Z;if(!G.type){const be=E(d);G=new Blob([G],{type:be})}const Y=l.filename,pe=Y.split("/").pop()??Y,j=m.includes("/")?`${m.split("/").slice(0,-1).join("/")}/${n}/${Y}`:`${n}/${Y}`,_e=new File([G],pe,{type:G.type});Object.defineProperty(_e,"webkitRelativePath",{value:j,writable:!1,enumerable:!0,configurable:!0}),x.push(_e)}return await T.close(),u(U,null),x}function E(p){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp"}[p]||"application/octet-stream"}async function N(){u(c,I.LOADING,!0),t.reset(),u(c,I.EXTRACTING,!0);let p=[];try{p=await ue(s.zipFile)}catch(g){throw console.error(`Error extracting ${s.zipFile.name}:`,g),u(le,g instanceof Error?g.message:"Failed to extract archive",!0),g}u(M,jt(p),!0);const _=Cs(e(M));u(C,await Promise.all(_.map(async g=>{const R=Os(g.name),T=Zs(g.name),A=g.files.filter(x=>x.type===qt.CHAPTER_PAGE).map((x,n)=>new Yt(x.file.name,n,x.file,Vt.NOT_STARTED,0,null,null,!1,x.type));return new $t(g.path,g.name,R,T,new mt,new Bt,A,pt.NOT_STARTED,0,null,null,g,!1,"en")})),!0),e(C).sort((g,R)=>{if(g.chapterVolume&&R.chapterVolume){const T=String(g.chapterVolume).localeCompare(String(R.chapterVolume),void 0,{numeric:!0,sensitivity:"base"});if(T!==0)return T}else{if(g.chapterVolume)return-1;if(R.chapterVolume)return 1}return g.chapterNumber&&R.chapterNumber?String(g.chapterNumber).localeCompare(String(R.chapterNumber),void 0,{numeric:!0,sensitivity:"base"}):g.chapterNumber?-1:R.chapterNumber?1:0}),t.chapterStates=e(C)}async function J(){u(c,I.SERIES_LOOKUP,!0);const p=Ls(s.zipFile.name);if(p)try{await bt.load();const _=await bt.getWeebdexIdFromLegacyId(p);_?(t.seriesId=_,console.log(`Auto-detected series ID from MD-####: ${p} -> ${_}`)):console.log(`No WeebDex ID found for MangaDex ID: ${p}`)}catch(_){console.warn(`Failed to lookup WeebDex ID for MangaDex ID ${p}:`,_)}t.seriesId&&t.chapterStates.forEach(_=>{_.associatedSeries||(_.associatedSeries=new mt),_.associatedSeries.seriesId=t.seriesId??""})}async function H(){u(c,I.CHAPTER_LOOKUP,!0),t.seriesId&&await Je.load()}async function he(){if(u(c,I.LOADING_GROUPS,!0),!t.seriesId)return;if(!await Je.hasSeriesEntries(t.seriesId)){console.warn("No entries found in chapter dump for this series"),u(V,!0);return}const _=await Je.getAllGroupNames(t.seriesId);if(_.length===0){console.log("No groups found in chapter dump, but series has entries (likely all ungrouped)"),t.availableScanGroups=[];return}const g=[],R=[];for(const T of _)try{const A=await Ht(T);if(A.data){const x=A.data.find(n=>n.name===T);if(x){const n=new Kt;n.groupId=x.id,n.groupName=x.name,g.push(n)}else R.push(T)}else R.push(T)}catch(A){console.warn(`Failed to lookup group "${T}":`,A),R.push(T)}u(y,R,!0),R.length>0&&u(V,!0),t.availableScanGroups=g}async function O(){u(c,I.APPLYING_GROUPS,!0),await te()}async function ee(){if(u(c,I.APPLYING_TITLES,!0),!t.seriesId)return;const p=await Ie();u(L,p,!0),p>0&&u(V,!0)}Oe(()=>{t.seriesId&&(e(c)===I.READY||e(c)===I.READY_WARNING)&&t.seriesId!==e(fe)&&(u(fe,t.seriesId,!0),ce())});async function ce(){try{if(await J(),!t.seriesId)return;u(c,I.APPLYING_REGEX,!0),await H(),await he(),await O(),await ee(),await se(),me()?u(c,I.READY_WARNING,!0):u(c,I.READY,!0)}catch(p){console.error("Error in processing pipeline:",p),u(c,I.READY_WARNING,!0)}}async function te(){for(const p of t.chapterStates){if(!p.originalFolderPath)continue;const _=t.availableScanGroups.filter(g=>p.originalFolderPath?.includes(g.groupName)??!1);if(_.length>0){const g=p.associatedGroup.groupIds??[],R=new Set(g);for(const T of _)R.has(T.groupId)||R.add(T.groupId);p.associatedGroup.groupIds=Array.from(R)}}}async function Ie(){if(!t.seriesId)return 0;const p=new Map;for(const g of t.availableScanGroups)p.set(g.groupId,g.groupName);let _=0;for(const g of t.chapterStates){const R=g.originalFolderPath?.includes("[no group]")??!1,T=g.associatedGroup.groupIds??[];if(T.length===0&&!R){_++;continue}const A=T.map(l=>p.get(l)).filter(l=>l!==void 0);if(A.length===0&&!R){_++;continue}const x=await Je.getChapterInfo(t.seriesId,g.chapterVolume,g.chapterNumber);if(!x){_++;continue}let n=null,m=!1;for(const l of A)if(l in x.groupTitles){n=x.groupTitles[l],m=!0,console.log(`found group name match for group: ${l} with title: ${n??"null"}`);break}!m&&R&&x.ungroupedTitles.length>0&&(n=x.ungroupedTitles[0],m=!0,console.log(`found ungrouped title match for chapter: ${g.originalFolderPath} with title: ${n}`)),m?g.chapterTitle=n:_++}return _}async function se(){if(t.seriesId)try{const p=await Xt(t.seriesId),_=[],g=new Map;for(const A of p.chapters){const x=A.volume||"none",n=A.chapter,m=`${x}:${n}`;g.set(m,A)}const R=A=>{const x=new Set;if(p.groups)for(const n of A){const m=p.groups[n];m&&x.add(m.id)}return x},T=(A,x)=>{if(A.size!==x.size)return!1;for(const n of A)if(!x.has(n))return!1;return!0};for(const A of t.chapterStates){const x=A.chapterVolume||"none",n=A.chapterNumber;if(!n)continue;const m=`${x}:${n}`,l=g.get(m);if(l&&l.entries&&Object.keys(l.entries).length>0){const d=new Set(A.associatedGroup.groupIds??[]);if(d.size===0)continue;let w=null;for(const Z of Object.values(l.entries)){const G=R(Z.groups);if(T(d,G)){w=Z;break}}if(w){const Z=R(w.groups),G=[];for(const Y of Z){const pe=p.groups?.find(j=>j.id===Y);pe?G.push(`${pe.name} (${pe.id})`):G.push(`Unknown Group (${Y})`)}_.push({chapter:A,existingGroups:G.length>0?G:["Unknown groups"]})}}}u(W,_,!0)}catch(p){console.error("Error checking for duplicates:",p),u(W,[],!0)}}function Ee(p){if(e(c)!==I.UPLOADING)return;u(c,I.COMPLETED,!0);const _=p?"success":"error";s.guidedState.setZipStatus(s.zipFile,p?we.COMPLETED:we.ERROR),p&&t.seriesId?s.onProcessingComplete(_,t.seriesId):s.onProcessingComplete(_)}function me(){return e(W).length>0||e(V)||e(y).length>0||e(L)>0}function ae(){return{hasDuplicates:e(W).length>0,duplicateCount:e(W).length,dumpLookupFailed:e(V),failedGroups:e(y).length,failedTitles:e(L)}}function K(){return e(c)===I.READY&&(e(fe)===t.seriesId||!t.seriesId)}Oe(()=>{if(!F?.isActive)return;const _=e(c),g=t.seriesId,R=e(fe),T=_===I.READY||_===I.READY_WARNING;if(!T)return;console.log("Automation: Effect triggered, checking state",{step:_,seriesId:g,lastSeriesId:R,shouldCheck:T});const A=setTimeout(()=>{de()},500);return()=>clearTimeout(A)});async function de(){if(!F?.isActive){console.log("Automation: Not active");return}if(e(c)===I.READY_WARNING){console.log("Automation: READY_WARNING state detected, marking as warning and skipping"),s.guidedState.setZipStatus(s.zipFile,we.WARNING),s.onProcessingComplete("warning");return}if(!K()){console.log("Automation: Not ready",{step:e(c),seriesId:t.seriesId,lastProcessedSeriesId:e(fe)});return}console.log("Automation: Checking zip file",s.zipFile.name);const p=s.guidedState.pendingZips,_=s.guidedState.warningZips.length>0||s.guidedState.errorZips.length>0;if(p.length===0&&_){console.log("Automation: Disabling - only warnings/errors remain"),F.disable();return}console.log("Automation: No issues, starting upload",{canStartUpload:e(re),hasSeriesId:!!t.seriesId,nonDeletedChapters:e($).length}),e(re)&&t.seriesId&&e($).length>0?ie()?console.log("Automation: Upload started successfully"):(console.warn("Automation: Failed to start upload, marking as error"),s.guidedState.setZipStatus(s.zipFile,we.ERROR),s.onProcessingComplete("error")):(console.warn("Automation: Missing requirements for upload",{canStartUpload:e(re),hasSeriesId:!!t.seriesId,nonDeletedChapters:e($).length}),s.guidedState.setZipStatus(s.zipFile,we.WARNING),s.onProcessingComplete("warning"))}function ie(){return f.apiToken?t.seriesId?t.chapterStates.length===0?(alert("No chapters to upload"),!1):!e(re)||e($).length===0?!1:(u(c,I.UPLOADING,!0),s.guidedState.setZipStatus(s.zipFile,we.PROCESSING),!0):(alert("Please set a series ID first"),!1):(alert("Please set up API authentication first"),!1)}Oe(()=>{if(e(c)===I.UPLOADING&&F?.isActive&&e(X)){const p=setTimeout(()=>{console.log("Automation: Triggering upload via UploaderOrchestrator"),e(X)?.startUpload()},200);return()=>clearTimeout(p)}});const re=Fe(()=>e(c)===I.READY||e(c)===I.READY_WARNING),$=Fe(()=>e(C).filter(p=>!p.isDeleted));Oe(()=>{if(e(c)===I.UPLOADING&&e(C).length>0){const p=e(C).every(g=>g.status===pt.COMPLETED||g.isDeleted),_=e(C).some(g=>!g.isDeleted);if(p&&_){const R=!e(C).some(T=>!T.isDeleted&&T.status===pt.FAILED);s.guidedState.setZipStatus(s.zipFile,R?we.COMPLETED:we.ERROR),Ee(R)}}});var oe={hasIssues:me,getIssueDetails:ae,isReady:K,startUpload:ie},ne=pa(),ge=r(ne),Ge=r(ge);a(ge);var ye=o(ge,2);{var We=p=>{var _=Xs(),g=o(r(_),2),R=r(g,!0);a(g);var T=o(g,2);{var A=x=>{var n=Ks(),m=r(n);a(n),k(()=>S(m,`Processing: ${e(U)??""}`)),v(x,n)};P(T,x=>{e(U)&&x(A)})}a(_),k(()=>S(R,e(c)===I.LOADING?"Loading manga folder...":e(c)===I.EXTRACTING?"Extracting zip files...":e(c)===I.SERIES_LOOKUP?"Looking up series ID...":e(c)===I.APPLYING_REGEX?"Applying regex patterns...":e(c)===I.CHAPTER_LOOKUP?"Loading chapter dump...":e(c)===I.LOADING_GROUPS?"Loading groups...":e(c)===I.APPLYING_GROUPS?"Applying groups to chapters...":"Applying titles to chapters...")),v(p,_)},Qe=p=>{var _=Ue(),g=Ce(_);{var R=A=>{var x=ca(),n=r(x),m=r(n),l=r(m);a(m),a(n);var d=o(n,2),w=o(r(d),2);es(w,{});var Z=o(w,2);ts(Z,{});var G=o(Z,2);ss(G,{}),a(d);var Y=o(d,2);{var pe=Ne=>{var xe=ia(),Te=r(xe);{var Me=Q=>{var ve=Js();v(Q,ve)},Be=Q=>{var ve=Qs();v(Q,ve)};P(Te,Q=>{t.seriesId?Q(Be,!1):Q(Me)})}var He=o(Te,2),rt=r(He);{var nt=Q=>{var ve=ea(),je=r(ve);a(ve),k(()=>S(je,`‚Ä¢ ${e(W).length??""} duplicate chapter${e(W).length===1?"":"s"} detected`)),v(Q,ve)};P(rt,Q=>{e(W).length>0&&Q(nt)})}var Ke=o(rt,2);{var ot=Q=>{var ve=ta();v(Q,ve)};P(Ke,Q=>{e(V)&&e(y).length===0&&e(L)===0&&Q(ot)})}var Ae=o(Ke,2);{var ct=Q=>{var ve=sa(),je=r(ve);a(ve),k(dt=>S(je,`‚Ä¢ ${e(y).length??""} group${e(y).length===1?"":"s"} failed to lookup: ${dt??""}`),[()=>e(y).join(", ")]),v(Q,ve)};P(Ae,Q=>{e(y).length>0&&Q(ct)})}var Xe=o(Ae,2);{var tt=Q=>{var ve=aa(),je=r(ve);a(ve),k(()=>S(je,`‚Ä¢ ${e(L)??""} chapter title${e(L)===1?"":"s"} failed
								to resolve`)),v(Q,ve)};P(Xe,Q=>{e(L)>0&&Q(tt)})}a(He),a(xe),v(Ne,xe)};P(Y,Ne=>{e(c)===I.READY_WARNING&&Ne(pe)})}var j=o(Y,2);{var _e=Ne=>{var xe=ua(),Te=r(xe),Me=r(Te),Be=r(Me),He=r(Be);a(Be),Et(2),a(Me);var rt=o(Me,2);rt.__click=()=>{for(const{chapter:Ke}of e(W))Ke.isDeleted=!0},a(Te);var nt=o(Te,2);ke(nt,21,()=>e(W),ze,(Ke,ot)=>{let Ae=()=>e(ot).chapter,ct=()=>e(ot).existingGroups;var Xe=la(),tt=r(Xe),Q=r(tt),ve=r(Q),je=r(ve);a(ve);var dt=o(ve,2);{var yt=Pe=>{var at=ra();v(Pe,at)};P(dt,Pe=>{Ae().isDeleted&&Pe(yt)})}a(Q);var ht=o(Q,2),Nt=r(ht);a(ht),a(tt);var st=o(tt,2);st.__click=()=>{Ae().isDeleted=!Ae().isDeleted};var At=r(st);{var Ft=Pe=>{var at=na();v(Pe,at)},Rt=Pe=>{var at=oa();v(Pe,at)};P(At,Pe=>{Ae().isDeleted?Pe(Ft):Pe(Rt,!1)})}a(st),a(Xe),k(Pe=>{Se(Xe,1,`uno-ecxsrr ${Ae().isDeleted?"uno-1ya9ju":""}`),S(je,`Vol. ${Ae().chapterVolume??"N/A"??""} Ch. ${Ae().chapterNumber??"N/A"??""} - ${(Ae().chapterTitle||Ae().originalFolderPath||"Untitled")??""}`),S(Nt,`Existing groups: ${Pe??""}`),Se(st,1,`uno-v1bdur ${Ae().isDeleted?"uno-uigj71":"uno-8ta9ap"}`),ft(st,"title",Ae().isDeleted?"Restore chapter":"Mark as removed")},[()=>ct().join(", ")]),v(Ke,Xe)}),a(nt),a(xe),k(()=>S(He,`‚ö†Ô∏è Warning: ${e(W).length??""} duplicate chapter${e(W).length===1?"":"s"} detected`)),v(Ne,xe)};P(j,Ne=>{e(W).length>0&&Ne(_e)})}var be=o(j,2),Re=o(r(be),2);ke(Re,21,()=>e(C),ze,(Ne,xe,Te)=>{Bs(Ne,{index:Te,get chapter(){return e(xe)}})}),a(Re),a(be);var De=o(be,2);De.__click=ie;var et=r(De);a(De),a(x),k(()=>{S(l,`Found ${e(C).length??""} chapter${e(C).length===1?"":"s"} from deepest folders`),De.disabled=!e(re)||!t.seriesId||e($).length===0,S(et,`Start Upload (${e($).length??""} of ${e(C).length??""} chapters)`)}),v(A,x)},T=A=>{var x=Ue(),n=Ce(x);{var m=d=>{it(as(d,{onDone:Ee,get busy(){return e(z)},set busy(w){u(z,w,!0)}}),w=>u(X,w,!0),()=>e(X))},l=d=>{var w=Ue(),Z=Ce(w);{var G=Y=>{var pe=da();v(Y,pe)};P(Z,Y=>{e(c)===I.COMPLETED&&Y(G)},!0)}v(d,w)};P(n,d=>{e(c)===I.UPLOADING?d(m):d(l,!1)},!0)}v(A,x)};P(g,A=>{e(c)===I.READY||e(c)===I.READY_WARNING?A(R):A(T,!1)},!0)}v(p,_)};P(ye,p=>{e(c)===I.LOADING||e(c)===I.EXTRACTING||e(c)===I.SERIES_LOOKUP||e(c)===I.APPLYING_REGEX||e(c)===I.CHAPTER_LOOKUP||e(c)===I.LOADING_GROUPS||e(c)===I.APPLYING_GROUPS||e(c)===I.APPLYING_TITLES?p(We):p(Qe,!1)})}return a(ne),k(()=>{Se(ne,1,`uno-hemz07 ${i()??""}`),S(Ge,`Processing: ${s.zipFile.name??""}`)}),v(b,ne),Ve(oe)}$e(["click"]);var fa=h('<span class="uno-eibvyk"></span>'),ga=h('<span class="uno-wwd276"></span>'),ha=h("<option> </option>"),ma=h('<div class="uno-4n7jiu"><label for="session-selector" class="uno-q52u3c">Select Session:</label> <select class="uno-ggu5iv"><option>-- Select a session --</option><!></select></div>'),_a=h('<div class="uno-18xidu"> </div>'),ba=h('<div class="uno-4n7jiu"><div class="uno-y8jeae"><p class="uno-q52u3c"> </p> <button type="button" class="uno-m5t56d" title="Copy all IDs to clipboard">Copy IDs</button></div> <div class="uno-ky3e2b"><div class="uno-twa61r"></div></div></div>'),wa=h('<p class="uno-q4g9cd">Please select a session to view IDs</p>'),Ia=h('<p class="uno-q4g9cd">No completed IDs found</p>'),Ea=h('<div class="uno-pnwugo"><label for="view-mode" class="uno-q4g9cd">View Mode:</label> <button type="button">Per Session</button> <button type="button">All Combined</button></div> <!> <!> <div class="uno-w2kq3w"><button type="button" class="uno-m5t56d">Refresh</button> <button type="button" class="uno-ecwkht">Clear All</button></div>',1),Sa=h('<div class="uno-5pp2az"><button type="button" class="uno-vyqybb"><span class="uno-hus6d6"><!></span> <h3 class="uno-mg3nnt">Completed WeebDex IDs</h3></button> <!></div>');function xa(b,s){Ye(s,!0);const i="completedWeebdexIds";let t=D("per-session"),f=D(null),F=D(!1),c=D(Ze([])),M=D(Ze([]));function C(){if(!(typeof window>"u"))try{const E=JSON.parse(localStorage.getItem(i)||"{}");u(c,Object.entries(E).map(([J,H])=>({timestamp:J,ids:[...H]})).sort((J,H)=>H.timestamp.localeCompare(J.timestamp)),!0);const N=new Set;for(const J of e(c))for(const H of J.ids)N.add(H);u(M,Array.from(N).sort(),!0)}catch(E){console.error("Failed to load completed IDs from localStorage:",E),u(c,[],!0),u(M,[],!0)}}function z(E){try{return new Date(E).toLocaleString()}catch{return E}}function U(E){typeof navigator>"u"||!navigator.clipboard||navigator.clipboard.writeText(E).catch(N=>{console.error("Failed to copy to clipboard:",N)})}function X(){return e(t)==="all-combined"?e(M):e(f)?e(c).find(N=>N.timestamp===e(f))?.ids||[]:[]}function fe(){if(e(t)==="all-combined")return`All Combined IDs (${e(M).length} unique)`;if(e(f)){const E=e(c).find(N=>N.timestamp===e(f));return E?`${z(e(f))} (${E.ids.length} IDs)`:"No session selected"}return"Select a session"}wt(()=>{C()});var W=Sa(),V=r(W);V.__click=()=>{u(F,!e(F))};var y=r(V),L=r(y);{var le=E=>{var N=fa();v(E,N)},q=E=>{var N=ga();v(E,N)};P(L,E=>{e(F)?E(le):E(q,!1)})}a(y),Et(2),a(V);var B=o(V,2);{var ue=E=>{var N=Ea(),J=Ce(N),H=o(r(J),2);H.__click=()=>{u(t,"per-session"),u(f,null)};var he=o(H,2);he.__click=()=>{u(t,"all-combined"),u(f,null)},a(J);var O=o(J,2);{var ee=ae=>{var K=ma(),de=o(r(K),2);de.__change=$=>{u(f,$.target.value||null,!0)};var ie=r(de);ie.value=ie.__value="";var re=o(ie);ke(re,17,()=>e(c),ze,($,oe)=>{var ne=ha(),ge=r(ne);a(ne);var Ge={};k(ye=>{S(ge,`${ye??""} (${e(oe).ids.length??""} IDs)`),Ge!==(Ge=e(oe).timestamp)&&(ne.value=(ne.__value=e(oe).timestamp)??"")},[()=>z(e(oe).timestamp)]),v($,ne)}),a(de),a(K),v(ae,K)};P(O,ae=>{e(t)==="per-session"&&ae(ee)})}var ce=o(O,2);{var te=ae=>{var K=ba(),de=r(K),ie=r(de),re=r(ie,!0);a(ie);var $=o(ie,2);$.__click=()=>U(X().join(`
`)),a(de);var oe=o(de,2),ne=r(oe);ke(ne,21,X,ze,(ge,Ge)=>{var ye=_a(),We=r(ye,!0);a(ye),k(()=>S(We,e(Ge))),v(ge,ye)}),a(ne),a(oe),a(K),k(ge=>S(re,ge),[fe]),v(ae,K)},Ie=ae=>{var K=Ue(),de=Ce(K);{var ie=$=>{var oe=wa();v($,oe)},re=$=>{var oe=Ia();v($,oe)};P(de,$=>{e(t)==="per-session"&&!e(f)?$(ie):$(re,!1)},!0)}v(ae,K)};P(ce,ae=>{(e(t)==="all-combined"||e(f))&&X().length>0?ae(te):ae(Ie,!1)})}var se=o(ce,2),Ee=r(se);Ee.__click=C;var me=o(Ee,2);me.__click=()=>{confirm("Are you sure you want to clear all completed IDs from localStorage? This cannot be undone.")&&(localStorage.removeItem(i),C())},a(se),k(()=>{Se(H,1,`uno-r9todb ${e(t)==="per-session"?"uno-qv685z":"uno-7i144e"}`),Se(he,1,`uno-r9todb ${e(t)==="all-combined"?"uno-qv685z":"uno-7i144e"}`)}),v(E,N)};P(B,E=>{e(F)&&E(ue)})}a(W),v(b,W),Ve()}$e(["click","change"]);var ya=h('<div class="uno-j48514"><p class="uno-5v04yw">No zip file selected. Use the tabs above to select a zip file to process.</p></div>'),Na=h('<div class="uno-eeu1av"><!> <!></div>'),Aa=h('<div class="uno-pb4e2u"><div class="uno-k0pcvl"><h1 class="uno-kryzyj">Guided Zip Manga Uploader</h1> <div class="uno-skt2gn"><button type="button" class="uno-q7l7gr">Simple Mode</button> <!></div></div> <a target="_blank" class="uno-6zhxse">Tutorial & Docs</a> <!> <!> <!></div>');function Ma(b,s){Ye(s,!0);const i=new cs,t=new ds;lt(ps,i),lt(gt,t),lt(xt,new ns);let f=D(null),F=D(null);const c="completedWeebdexIds";let M=D(null);wt(()=>{u(M,new Date().toISOString(),!0)});function C(){i.workflowStep=qe.SELECTING_MANGA_FOLDERS}function z(){if(i.workflowStep=qe.PROCESSING_MANGA,i.selectedZipFiles.length>0){const O=i.selectedZipFiles[0],ee=i.zipFiles.findIndex(ce=>ce.file===O);ee>=0&&(i.currentZipIndex=ee,u(f,O,!0))}}function U(O){u(f,O,!0)}function X(O,ee){const ce=i.currentZip;if(ce)if(O==="success"){if(i.setZipStatus(ce.file,we.COMPLETED),ee&&e(M))try{const te=JSON.parse(localStorage.getItem(c)||"{}");te[e(M)]||(te[e(M)]=[]),te[e(M)].includes(ee)||(te[e(M)].push(ee),localStorage.setItem(c,JSON.stringify(te)))}catch(te){console.error("Failed to save weebdex ID to localStorage:",te)}}else O==="warning"?i.setZipStatus(ce.file,we.WARNING):O==="error"&&i.setZipStatus(ce.file,we.ERROR);if(i.moveToNextZip()){const te=i.currentZip;te&&u(f,te.file,!0)}else u(f,null)}function fe(){e(F)&&e(F).startUpload()}const W=Fe(()=>i.workflowStep!==qe.PROCESSING_MANGA);var V=Aa(),y=r(V),L=o(r(y),2),le=r(L);le.__click=()=>ls(_t("/"));var q=o(le,2);is(q,{}),a(L),a(y);var B=o(y,2),ue=o(B,2);{var E=O=>{rs(O,{})};P(ue,O=>{e(W)&&O(E)})}var N=o(ue,2);xa(N,{});var J=o(N,2);{var H=O=>{hs(O,{get guidedState(){return i},onDone:C,class:"uno-zgouyr"})},he=O=>{var ee=Ue(),ce=Ce(ee);{var te=se=>{ws(se,{get guidedState(){return i},onDone:z,class:"uno-l0uum8"})},Ie=se=>{var Ee=Ue(),me=Ce(Ee);{var ae=K=>{var de=Na(),ie=r(de);Ts(ie,{get guidedState(){return i},onZipSelected:U,onAutomationRequestUpload:fe,get mangaProcessorRef(){return e(F)},class:"uno-wgeun8"});var re=o(ie,2);{var $=ne=>{it(va(ne,{get guidedState(){return i},get zipFile(){return e(f)},onProcessingComplete:X,class:"uno-wgeun8"}),ge=>u(F,ge,!0),()=>e(F))},oe=ne=>{var ge=ya();v(ne,ge)};P(re,ne=>{e(f)?ne($):ne(oe,!1)})}a(de),v(K,de)};P(me,K=>{i.workflowStep===qe.PROCESSING_MANGA&&K(ae)},!0)}v(se,Ee)};P(ce,se=>{i.workflowStep===qe.SELECTING_MANGA_FOLDERS?se(te):se(Ie,!1)},!0)}v(O,ee)};P(J,O=>{i.workflowStep===qe.SELECTING_ROOT_FOLDER?O(H):O(he,!1)})}a(V),k(O=>ft(B,"href",O),[()=>_t("/docs")]),v(b,V),Ve()}$e(["click"]);export{Ma as component,za as universal};
